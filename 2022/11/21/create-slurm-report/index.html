<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=keyword content="ConfigMgr Microsoft Intune Windows WinAdmins"><meta name=viewport content="width=device-width"><meta name=description content="A community blog and subsidiary of WinAdmins.io"><link rel="shortcut icon" href=/img/favicon.ico><title>Get total job run time for your slurm cluster-SysManSquad | Systems Management Squad</title><link rel=canonical href=/2022/11/21/create-slurm-report/><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=https://sysmansquad.com/css/custom.css><script src=https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js></script>
<script src=https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js></script>
<script src=https://sysmansquad.com/js/jquery.slicknav.js></script>
<script src=https://sysmansquad.com/js/asd_SlickNav_Mobile.js></script>
<script src=https://sysmansquad.com/js/clipboard.js></script>
<script src=https://sysmansquad.com/js/custom.js></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XXZR1RSQYX"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XXZR1RSQYX",{anonymize_ip:!1})}</script><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://sysmansquad.com/83"><meta name=twitter:title content="Get total job run time for your slurm cluster"><meta name=twitter:description content="Every year, we have to produce a total of used hours on our compute cluster. The tools for interacting with slurm&rsquo;s accounting database are complex and the documentation is not very good, so this simple task is incredibly annoying. If you ever have to do this, hopefully you will have an easier time of it. This post is only an example of one way to do the job and there may be better ways."></head><body class="home blog"><div id=asd-container><div id=top-bar><div class=container><div id=nav-wrapper><ul class=menu id=menu-top-menu><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/>Home</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/about/><span>About</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=https://github.com/SysManSquad><span>GitHub</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/jointhesquad/><span>Join the Squad</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/meetthesquad/><span>Meet the Squad</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=#><span>MORE></span></a><ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/contact/>Contact</a></li></ul></li></ul></div><div id=top-search><a href=# class=search><i class="fa fa-search"></i></a><div class=show-search><form role=search method=get action=https://www.google.com/search id=searchform><input type=search placeholder="Search and hit enter..." name=q id=q title="Search and hit enter...">
<input type=hidden name=sitesearch value=https://sysmansquad.com>
<button type=submit value=Search class=searchbutton></form></div></div><div class=menu id=menu-mobile></div></div></div><header id=header class=noslider><div class=container><div id=logo><h1><a href=https://sysmansquad.com><img src=/img/SysManSquad-HorizontalColor-Logo.png alt="Systems Management Squad"></a></h1></div></div></header><div class=container><div id=content><div id=main class=fullwidth><article class="post type-post status-publish format-standard has-post-thumbnail hentry"><div class=post-header><h1>Get total job run time for your slurm cluster</h1><p class=p-meta><span class=post-author><a href=/authors/aaron>Aaron Glenn</a> /</span>
<span class=post-date>November 21, 2022</span>
<span class=post-categories>/ linux</span>
<span class=post-categories>/ hpc</span>
<span class=post-categories>/ slurm</span></p></div><div class=post-entry><p>Every year, we have to produce a total of used hours on our compute cluster. The tools for interacting with slurm&rsquo;s accounting database are complex and the documentation is not very good, so this simple task is incredibly annoying. If you ever have to do this, hopefully you will have an easier time of it. This post is only an example of one way to do the job and there may be better ways.</p><p>We start by having <code>sacct</code> dump statistics for all jobs from about a year ago:</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ps data-lang=ps><span style=display:flex><span><span style=color:#900;font-weight:700>sacct</span> <span style=color:#900;font-weight:700>--starttime</span> <span style=color:#900;font-weight:700>2021-11-11T00:00:00</span> <span style=color:#900;font-weight:700>--format</span> <span style=color:#900;font-weight:700>CPUTime</span> &gt; <span style=color:#900;font-weight:700>cputime.csv</span>
</span></span></code></pre></td></tr></table></div></div><p>Transport this file to anywhere you have powershell installed.</p><p>This file isn&rsquo;t incredibly helpful to begin with as the <code>sacct</code> command is primarily for human-readable reports. There are also json and yaml output options that would be a good start if you wanted to do this with less manual effort.</p><p>The first thing to do is edit the first two lines of the file to trim all the spaces from the column name, and delete the first row that just contains a bunch of <code>-</code> characters. You don&rsquo;t need to mess with any of the other values, even though they are also padded with spaces. You&rsquo;ll end up with something looking like this:</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-1>1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-2>2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-3>3</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-4>4</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-5>5</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-6>6</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span> CPUTime
</span></span><span style=display:flex><span>  00:00:00 
</span></span><span style=display:flex><span>  00:00:00 
</span></span><span style=display:flex><span>  22:00:20 
</span></span><span style=display:flex><span>  07:20:34 
</span></span><span style=display:flex><span>  00:20:00 
</span></span></code></pre></td></tr></table></div></div><p>Now all we need to do is write a little powershell to parse this into something useful. This script uses unix-style paths because it was written on a mac, swap the slashes out if you&rsquo;re running on windows.</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-1> 1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-2> 2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-3> 3</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-4> 4</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-5> 5</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-6> 6</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-7> 7</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-8> 8</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-9> 9</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-10>10</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-11>11</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-12>12</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-13>13</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ps data-lang=ps><span style=display:flex><span><span style=color:#900;font-weight:700>#</span> <span style=color:#900;font-weight:700>Import</span> <span style=color:#900;font-weight:700>the</span> <span style=color:#900;font-weight:700>csv</span> <span style=color:#900;font-weight:700>file</span>
</span></span><span style=display:flex><span><span style=color:#900;font-weight:700>$jobtimes</span> <span style=color:#900;font-weight:700>=</span> <span style=color:#900;font-weight:700>import-csv</span> <span style=color:#900;font-weight:700>.</span><span style=color:teal>/cputime.csv</span>
</span></span><span style=display:flex><span><span style=color:#900;font-weight:700>#</span> <span style=color:#900;font-weight:700>Initialize</span> <span style=color:#900;font-weight:700>an</span> <span style=color:#900;font-weight:700>empty</span> <span style=color:#900;font-weight:700>timespan</span>
</span></span><span style=display:flex><span><span style=color:#900;font-weight:700>$totals=</span>[<span style=color:#900;font-weight:700>timespan</span>]<span style=color:#900;font-weight:700>::parse</span><span style=color:#d14>(&#34;00:00:00&#34;)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#900;font-weight:700>#</span> <span style=color:#900;font-weight:700>Process</span> <span style=color:#900;font-weight:700>all</span> <span style=color:#900;font-weight:700>job</span> <span style=color:#900;font-weight:700>times</span>
</span></span><span style=display:flex><span><span style=color:#900;font-weight:700>$jobtimes</span> <span style=color:#900;font-weight:700>|</span> <span style=color:#998;font-style:italic>% { 
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span>    <span style=color:#900;font-weight:700>#</span> <span style=color:#900;font-weight:700>Slurm</span> <span style=color:#900;font-weight:700>uses</span> <span style=color:#900;font-weight:700>N-</span> <span style=color:#900;font-weight:700>to</span> <span style=color:#900;font-weight:700>indicate</span> <span style=color:#900;font-weight:700>how</span> <span style=color:#900;font-weight:700>many</span> <span style=color:#900;font-weight:700>days</span> <span style=color:#900;font-weight:700>the</span> <span style=color:#900;font-weight:700>job</span> <span style=color:#900;font-weight:700>ran,</span> <span style=color:#900;font-weight:700>we</span> <span style=color:#900;font-weight:700>need</span> <span style=color:#900;font-weight:700>to</span> <span style=color:#900;font-weight:700>replace</span> <span style=color:#900;font-weight:700>that</span> <span style=color:#900;font-weight:700>dash</span> <span style=color:#900;font-weight:700>with</span> <span style=color:#900;font-weight:700>a</span> <span style=color:#900;font-weight:700>:</span> <span style=color:#900;font-weight:700>to</span> <span style=color:#900;font-weight:700>make</span> <span style=color:#900;font-weight:700>powershell</span> <span style=color:#900;font-weight:700>recognize</span> <span style=color:#900;font-weight:700>the</span> <span style=color:#900;font-weight:700>format</span>
</span></span><span style=display:flex><span>    <span style=color:#900;font-weight:700>#</span> <span style=color:#900;font-weight:700>We</span> <span style=color:#900;font-weight:700>also</span> <span style=color:#900;font-weight:700>trim</span><span style=color:#d14>()</span> <span style=color:#900;font-weight:700>the</span> <span style=color:#900;font-weight:700>values</span> <span style=color:#900;font-weight:700>to</span> <span style=color:#900;font-weight:700>throw</span> <span style=color:#900;font-weight:700>away</span> <span style=color:#900;font-weight:700>all</span> <span style=color:#900;font-weight:700>the</span> <span style=color:#900;font-weight:700>space</span> <span style=color:#900;font-weight:700>padding.</span>
</span></span><span style=display:flex><span>    <span style=color:#900;font-weight:700>$runtime=$_.CPUTime.trim</span><span style=color:#d14>()</span><span style=color:#900;font-weight:700>.replace</span><span style=color:#d14>(&#34;-&#34;,&#34;:&#34;)</span>
</span></span><span style=display:flex><span>    <span style=color:#900;font-weight:700>$totals+=</span> [<span style=color:#900;font-weight:700>TimeSpan</span>]<span style=color:#900;font-weight:700>::Parse</span><span style=color:#d14>($runtime)</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#900;font-weight:700>$totals</span>
</span></span></code></pre></td></tr></table></div></div><p>This took a while for a cluster with over 300K jobs over the course of a year, and there&rsquo;s probably a more efficient way to do it, but I do this once a year so I don&rsquo;t care. You&rsquo;ll end up with a total amount of CPU time used:</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-1> 1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-2> 2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-3> 3</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-4> 4</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-5> 5</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-6> 6</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-7> 7</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-8> 8</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-9> 9</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-10>10</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-11>11</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>Days              : 4172
</span></span><span style=display:flex><span>Hours             : 8
</span></span><span style=display:flex><span>Minutes           : 59
</span></span><span style=display:flex><span>Seconds           : 52
</span></span><span style=display:flex><span>Milliseconds      : 0
</span></span><span style=display:flex><span>Ticks             : 3604931920000000
</span></span><span style=display:flex><span>TotalDays         : 4172.37490740741
</span></span><span style=display:flex><span>TotalHours        : 100136.997777778
</span></span><span style=display:flex><span>TotalMinutes      : 6008219.86666667
</span></span><span style=display:flex><span>TotalSeconds      : 360493192
</span></span><span style=display:flex><span>TotalMilliseconds : 360493192000
</span></span></code></pre></td></tr></table></div></div><p>That&rsquo;s it - quick, dirty, and satisfying.</p><img src=/authors/aaron/avatar.png alt="Photo of Aaron Glenn"><br><strong>Aaron Glenn</strong>
<em>Admin/Mentor</em><div><a href=https://www.linkedin.com/in/aaron-g-961b5359><img src=/img/social/linkedin.png></a></div><p>Aaron is a Sr. Systems Administrator from Tulsa, specializing in Microsoft technologies, with an emphasis on powershell.</p><hr></div><comments id=comments><script src=https://utteranc.es/client.js repo=SysManSquad/sysmansquadblog issue-term=title label="blog comment" theme=github-light crossorigin=anonymous async></script></comments></article></div></div></div><footer id=footer><div class=container><div id=footer-copyright><p class=copyright>&copy; 2023 WinAdmins - https://sysmansquad.com - Systems Management Squad</a></p></div></div></footer></div></body></html>