<!doctype html><html lang=en-us><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=keyword content="ConfigMgr Microsoft Intune Windows WinAdmins"><meta name=viewport content="width=device-width"><meta name=description content="A community blog and subsidiary of WinAdmins.io"><link rel="shortcut icon" href=/img/favicon.ico><title>Give your ADR a little boost with Status Filter Rules and PowerShell-SysManSquad | Systems Management Squad</title>
<link rel=canonical href=/2020/12/08/give-your-adr-a-little-boost-with-status-filter-rules-and-powershell/><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=https://sysmansquad.com/css/custom.css><script src=https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js></script><script src=https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js></script><script src=https://sysmansquad.com/js/jquery.slicknav.js></script><script src=https://sysmansquad.com/js/asd_SlickNav_Mobile.js></script><script src=https://sysmansquad.com/js/clipboard.js></script><script src=https://sysmansquad.com/js/custom.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-XXZR1RSQYX"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XXZR1RSQYX")}</script></head><body class="home blog"><div id=asd-container><div id=top-bar><div class=container><div id=nav-wrapper><ul class=menu id=menu-top-menu><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/>Home</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/about/><span>About</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=https://github.com/SysManSquad><span>GitHub</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/jointhesquad/><span>Join the Squad</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/meetthesquad/><span>Meet the Squad</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=#><span>MORE></span></a><ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/contact/>Contact</a></li></ul></li></ul></div><div id=top-search><a href=# class=search><i class="fa fa-search"></i></a><div class=show-search><form role=search method=get action=https://www.google.com/search id=searchform><input type=search placeholder="Search and hit enter..." name=q id=q title="Search and hit enter...">
<input type=hidden name=sitesearch value=https://sysmansquad.com/>
<button type=submit value=Search class=searchbutton></form></div></div><div class=menu id=menu-mobile></div></div></div><header id=header class=noslider><div class=container><div id=logo><h1><a href=https://sysmansquad.com/><img src=/img/SysManSquad-HorizontalColor-Logo.png alt="Systems Management Squad"></a></h1></div></div></header><div class=container><div id=content><div id=main class=fullwidth><article class="post type-post status-publish format-standard has-post-thumbnail hentry"><div class=post-header><h1>Give your ADR a little boost with Status Filter Rules and PowerShell</h1><p class=p-meta><span class=post-author><a href=/authors/michael-de-bona>MichaÃ«l De Bona</a> / </span><span class=post-date>December 8, 2020 </span><span class=post-categories>/ MECM/MEMCM/SCCM </span><span class=post-categories>/ Powershell</span></p></div><div class=post-entry><h2 id=introduction>Introduction</h2><p>MEMCM already offers a lot of features to help SysAdmins automate many processes and save them a lot of time to <del>drink more coffeeâ˜•</del> work on less mundane and more interesting tasks.</p><p>Among them, there are <strong>Automatic Deployment Rules</strong> (ADR) that let you automate patch management for your Windows devices. There are also <strong>Status Filter Rules</strong> that allow you to execute actions (Launch a program, execute a scriptâ€¦) when specific status messages are processed by the site server.</p><p>If we mix them and add a bit of <strong>PowerShell</strong> scripting on top of that, we can get even more done. So, letâ€™s go and give your ADR a little boost with Status Filter Rules and PowerShell!</p><h2 id=status-messages-and-status-filter-rules-what-are-they>Status Messages and Status Filter Rules, what are they?</h2><h3 id=status-messages>Status Messages</h3><p>Before looking at Status Filter Rules, itâ€™s good to know what <a href=https://docs.microsoft.com/mem/configmgr/develop/core/servers/manage/about-configuration-manager-status-messages>Status Messages</a> are in Configuration Manager. Status Messages are informational messages generated by the various MEMCM components to inform the administrator about their health and actions. They are similar to Windows events as they also have different attributes like a severity classification, an ID or a description.</p><p>For example, when a new application is created, a status message is generated. If a Distribution Point has failed to process some content, a status message is generated. Or if a collection has been deleted by someone, a status message is also generated. There are a few hundred different status message that can be generated in a MEMCM environment when something happens. To help you find the one you desire, a big list of the different status messages is available on <a href=https://github.com/KlausBilger/SCCM_MsgID>GitHub</a>.</p><h3 id=status-filter-rules>Status Filter Rules</h3><p>Status Filter Rules allow you to trigger an action each time a status message meets defined criteria that you have set with filters. Simple, yet really effective.</p><p>They are created from <strong>Administration > Overview > Site Configuration > Sites</strong>. Right click on the desired site and select Status Filter Rules to open the list of pre-existing rules and create, edit, or delete your own rules.</p><p><div class=image><figure><a href=Status-Filter-Rules.png target=_blank><img src=Status-Filter-Rules.png alt="Default Status Filter Rules list"></a></figure></div></p><p>From there, you need to give your rule a name and you can select different filters criteria that, when met, will trigger the rule&rsquo;s actions that you can select on the next window of the wizard. More on that later.</p><p>There are also many PowerShell cmdlets available to work with Status Filter rules. You can find more about them on the <a href="https://docs.microsoft.com/search/?terms=CMStatusFilterRules&amp;category=Reference">Microsoft Docs site</a>.</p><p>The last important bit of information is that Status Filter Rules allow you to use variable that you can pass as parameters when calling your program. For a complete list of all the existing variables, you can take a look at <a href=https://github.com/SysManSquad/BlogFiles/blob/master/mdebona/List%20of%20Status%20Filter%20Rules%20variables.md>this page</a>.</p><h2 id=getting-more-from-adr-with-powershell>Getting more from ADR with PowerShell</h2><p>Now that we have basic knowledge on status messages and Status Filter Rules, we can start to use them to get more from our Automatic Deployment Rules. To achieve this goal, we will do the following with PowerShell:</p><ul><li>Rename the created Software Update Group (SUG) to remove the time of execution (The date is enough);</li><li>Change the maximum allowed installation time for each update in the SUG if the updates are aimed at servers;</li><li>Generate an HTML report which contains some basic information on each updates that are part of the SUG.</li></ul><p>These are just examples of what can be done once the PowerShell script is kicking in action and you can come up with many other ideas. The complete script that will be shown in this post can be found in our <a href=https://github.com/SysManSquad/BlogFiles/blob/master/mdebona/OnADRCompletion.ps1>GitHub repository</a>. Below is a breakdown of its main sections.</p><p>Note that the script presented in this example assumes that the ADR is creating a new Software Update Group each time it is executed.</p><h3 id=prerequisites>Prerequisites</h3><p>The script will start with some kind of prerequisites. This is a part that could be common to many scripts used in Status Filter Rules and that will let the script kick into action by gathering a few needed variables and loading the mandatory PowerShell module.</p><p>First, we get two parameters that will be used to connect to the good MEMCM site. The third parameter is the text of the status message that has been trapped by the Status Filter Rule. Next, the ConfigurationManager PowerShell module is imported and the PSDrive linked to the MEMCM site is created if it has not been automatically when the module was imported (It happens sometimes). With all of that in place, the script is ready to execute some actions.</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-23>23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-24>24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-25>25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-26>26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-27>27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-28>28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-29>29</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-30>30</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-31>31</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-32>32</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-33>33</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-34>34</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-35>35</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>[<span style=color:#0086b3>CmdletBinding</span>()]
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>param</span>(
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># Name of the site server returned by the Status Filter Rule</span>
</span></span><span style=display:flex><span>[<span style=color:#0086b3>Parameter</span>(<span style=color:teal>Mandatory</span> = $true)]
</span></span><span style=display:flex><span>[<span style=color:teal>String</span>] <span style=color:teal>$SiteServer</span>,
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># Site code returned by the Status Filter Rule</span>
</span></span><span style=display:flex><span>[<span style=color:#0086b3>Parameter</span>(<span style=color:teal>Mandatory</span> = $true)]
</span></span><span style=display:flex><span>[<span style=color:teal>String</span>] <span style=color:teal>$SiteCode</span>,
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># Description of the Status Message returned by the Status Filter Rule</span>
</span></span><span style=display:flex><span>[<span style=color:#0086b3>Parameter</span>(<span style=color:teal>Mandatory</span> = $true)]
</span></span><span style=display:flex><span>[<span style=color:teal>String</span>] <span style=color:teal>$Description</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># Import the ConfigurationManager.psd1 module</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>if</span> (<span style=color:#000;font-weight:700>-not</span>(<span style=color:#0086b3>Get-Module</span> ConfigurationManager)) {
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>try</span> {
</span></span><span style=display:flex><span><span style=color:#0086b3>Import-Module</span> (<span style=color:#d14>&#34;{0}\..\ConfigurationManager.psd1&#34;</span> <span style=color:#000;font-weight:700>-f</span> <span style=color:teal>$ENV:SMS_ADMIN_UI_PATH</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>catch</span> {
</span></span><span style=display:flex><span>Exit <span style=color:#099>1</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># Create the site PSDrive if it has not been created automatically during the module importation</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>If</span>(<span style=color:#000;font-weight:700>-not</span>(<span style=color:#0086b3>Get-PSDrive</span> <span style=color:teal>$SiteCode</span>)) {
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>try</span> {
</span></span><span style=display:flex><span><span style=color:#0086b3>New-PSDrive</span> -Name <span style=color:teal>$SiteCode</span> -PSProvider <span style=color:#d14>&#34;AdminUI.PS.Provider\CMSite&#34;</span> -Root <span style=color:teal>$SiteServer</span> | <span style=color:#0086b3>Out-Null</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>catch</span> {
</span></span><span style=display:flex><span>Exit <span style=color:#099>1</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># Set the location to the Configuration Manager PSDrive to be able to use MEMCM Powershell commands</span>
</span></span><span style=display:flex><span><span style=color:#0086b3>Set-Location</span> <span style=color:#d14>&#34;</span>$(<span style=color:teal>$SiteCode</span>)<span style=color:#d14>:&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=actions>Actions</h3><p>For the next part, it is important to know what&rsquo;s the trapped message looking like because that will be the content of the <strong>Description</strong> variable. When an ADR is executed and a new Software Update Group is created, a status message with <strong>ID 5800</strong> is generated.</p><p><div class=image><figure><a href=Message-ID-5800.png target=_blank><img src=Message-ID-5800.png alt=screenshot></a></figure></div></p><p>The exact value of the Description field is the following:</p><blockquote><p>CI Assignment Manager successfully processed new CI Assignment %1.</p></blockquote><p>In this message, the <strong>%1</strong> variable will take the following pattern :</p><ul><li>&ldquo;<strong>ADR Name yyyy-MM-dd HH:mm:ss</strong>&rdquo; if the ADR is set to create a new Software Update Group upon each execution.</li><li>&ldquo;<strong>ADR Name</strong>&rdquo; if it is set to reuse the same SUG.</li></ul><p>Be careful with the renaming of your Software Update Group. If your ADR runs more than once a day, the second time it will run, the script will fail because the second SUG would have the same name as the first one. Indeed, each SUG needs to have a unique name.</p><p>With this new knowledge in mind, the next part of the script identifies if a Software Update Group exists with the name and creation date that have been extracted from the status message. If one is found (Hint: it should or you have a serious problem!) and that it&rsquo;s not a SUG containing Windows Defender definitions, then the SUG is renamed (To remove the time part of the complete name). Next, the maximum execution time for each update in the Software Update Group is changed to 120 minutes if it is aimed at servers.</p><p><strong>Note on maximum execution time:</strong> Be careful when changing the maximum execution time of your updates if you are using Maintenance Windows for updates deployment. If the cumulative execution time is longer than the length of the Maintenance Window, the updates won&rsquo;t apply. You will even get a status message to let you know that. ðŸ˜‰</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-23>23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-24>24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-25>25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-26>26</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#998;font-style:italic># Regex to capture the name of the created SUG and the creation date</span>
</span></span><span style=display:flex><span>[<span style=color:teal>regex</span>]<span style=color:teal>$Regex</span> = <span style=color:#d14>&#34;CI Assignment Manager successfully processed new CI Assignment\s+(?Name&gt;.*)\s(?Date&gt;\d{4}-\d{2}-\d{2})&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># Use the Regex on the Description variable to extract the SUG&#39;s name and creation date. Store the values in variables</span>
</span></span><span style=display:flex><span><span style=color:teal>$Description</span> | <span style=color:#0086b3>Select-String</span> -Pattern <span style=color:teal>$Regex</span> -AllMatches | <span style=color:#0086b3>ForEach-Object</span> {
</span></span><span style=display:flex><span>[<span style=color:teal>string</span>]<span style=color:teal>$DeploymentName</span> = <span style=color:teal>$_</span>.Matches.Groups[<span style=color:teal>$Regex</span>.GroupNumberFromName(<span style=color:#d14>&#34;Name&#34;</span>)].Value
</span></span><span style=display:flex><span>[<span style=color:teal>string</span>]<span style=color:teal>$DeploymentDate</span> = <span style=color:teal>$_</span>.Matches.Groups[<span style=color:teal>$Regex</span>.GroupNumberFromName(<span style=color:#d14>&#34;Date&#34;</span>)].Value
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># Check the SUG name. If it contains the word &#34;Definition&#34;, it is a SUG containing the Windows Defender definitionsso the script stops</span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># Can be changeg to whatever fits best your environment</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>If</span> (<span style=color:teal>$DeploymentName</span> <span style=color:#000;font-weight:700>-notlike</span> <span style=color:#d14>&#34;*Definition*&#34;</span>) {
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># Look for a SUG with the same name and creation date. If it exists, the script continues. Otherwise, it stops.</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>If</span> (<span style=color:teal>$SUG</span> = <span style=color:#0086b3>Get-CMSoftwareUpdateGroup</span> -Name <span style=color:#d14>&#34;</span>$(<span style=color:teal>$DeploymentName</span>)<span style=color:#d14>*&#34;</span> | <span style=color:#0086b3>Where-Object</span> {(<span style=color:#0086b3>Get-Date</span> <span style=color:teal>$_</span>.DateCreated -Format <span style=color:#d14>&#39;yyyy-MM-dd&#39;</span>) <span style=color:#000;font-weight:700>-eq</span> (<span style=color:#0086b3>Get-Date</span> <span style=color:teal>$DeploymentDate</span> -Format <span style=color:#d14>&#39;yyyy-MM-dd&#39;</span>)}) {
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># Create a new name without the SUG&#39;s creation time, keeping only the name and creation date. Then, rename the SUG</span>
</span></span><span style=display:flex><span><span style=color:teal>$NewSUGName</span> = <span style=color:#d14>&#34;</span><span style=color:teal>$DeploymentName</span><span style=color:#d14> </span><span style=color:teal>$DeploymentDate</span><span style=color:#d14>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#0086b3>Set-CMSoftwareUpdateGroup</span> -InputObject <span style=color:teal>$SUG</span> -NewName <span style=color:teal>$NewSUGName</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># If the SUG name matches a specific name, set the maximum execution time of each updates in the SUG to 120 minutes</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>If</span>(<span style=color:teal>$DeploymentName</span> <span style=color:#000;font-weight:700>-match</span> <span style=color:#d14>&#39;^ADR_WinServ&#39;</span>) {
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>ForEach</span> (<span style=color:teal>$Update</span> <span style=color:#000;font-weight:700>in</span> (<span style=color:#0086b3>Get-CMSoftwareUpdate</span> -UpdateGroupID <span style=color:teal>$SUG</span>.CI_ID -Fast)) {
</span></span><span style=display:flex><span><span style=color:#0086b3>Set-CMSoftwareUpdate</span> -InputObject <span style=color:teal>$Update</span> -MaximumExecutionMins <span style=color:#099>120</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h4 id=reporting>Reporting</h4><p>The following block of code should be placed within the two If blocks of the previous code block. It has been moved outside for the sole purpose of cutting the whole code in different sections.</p><p>Once all these actions are done, it&rsquo;s time for some reporting. There are multiple options available, from sending a mail to posting a message to Teams. For this example, I have decided to generate a simple HTML file that will look the same way an email would look.</p><p>First, a bit of CSS is added to make the HTML look prettier. Then, a table is created which contains some information on each updates that are part of the Software Update Group. Finally, the different pieces are stitched together and an HTML file is generated.</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-23>23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-24>24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-25>25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-26>26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-27>27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-28>28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-29>29</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-30>30</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-31>31</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-32>32</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-33>33</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-34>34</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-35>35</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-36>36</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-37>37</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-38>38</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-39>39</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-40><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-40>40</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-41><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-41>41</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-42><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-42>42</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-43><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-43>43</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-44><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-44>44</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-45><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-45>45</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-46><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-46>46</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-47><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-47>47</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-48><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-48>48</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-49><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-49>49</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-50><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-50>50</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-51><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-51>51</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-52><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-52>52</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-53><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-53>53</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-54><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-54>54</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-55><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-55>55</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-56><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-56>56</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-57><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-57>57</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#998;font-style:italic># Define some CSS style that will be added to the HTML report header</span>
</span></span><span style=display:flex><span><span style=color:teal>$HtmlHeader</span> = <span style=color:#d14>@&#34;
</span></span></span><span style=display:flex><span><span style=color:#d14>style&gt;
</span></span></span><span style=display:flex><span><span style=color:#d14>body {
</span></span></span><span style=display:flex><span><span style=color:#d14>font-size: 12px;
</span></span></span><span style=display:flex><span><span style=color:#d14>font-family: Arial, Helvetica, sans-serif;
</span></span></span><span style=display:flex><span><span style=color:#d14>}
</span></span></span><span style=display:flex><span><span style=color:#d14>table {
</span></span></span><span style=display:flex><span><span style=color:#d14>font-size: 12px;
</span></span></span><span style=display:flex><span><span style=color:#d14>border: 0px;
</span></span></span><span style=display:flex><span><span style=color:#d14>font-family: Arial, Helvetica, sans-serif;
</span></span></span><span style=display:flex><span><span style=color:#d14>}
</span></span></span><span style=display:flex><span><span style=color:#d14>
</span></span></span><span style=display:flex><span><span style=color:#d14>td {
</span></span></span><span style=display:flex><span><span style=color:#d14>padding: 4px;
</span></span></span><span style=display:flex><span><span style=color:#d14>margin: 0px;
</span></span></span><span style=display:flex><span><span style=color:#d14>border: 0;
</span></span></span><span style=display:flex><span><span style=color:#d14>}
</span></span></span><span style=display:flex><span><span style=color:#d14>
</span></span></span><span style=display:flex><span><span style=color:#d14>th {
</span></span></span><span style=display:flex><span><span style=color:#d14>background: #395870;
</span></span></span><span style=display:flex><span><span style=color:#d14>background: linear-gradient(#49708f, #293f50);
</span></span></span><span style=display:flex><span><span style=color:#d14>color: #fff;
</span></span></span><span style=display:flex><span><span style=color:#d14>font-size: 11px;
</span></span></span><span style=display:flex><span><span style=color:#d14>text-transform: uppercase;
</span></span></span><span style=display:flex><span><span style=color:#d14>padding: 10px 15px;
</span></span></span><span style=display:flex><span><span style=color:#d14>vertical-align: middle;
</span></span></span><span style=display:flex><span><span style=color:#d14>}
</span></span></span><span style=display:flex><span><span style=color:#d14>
</span></span></span><span style=display:flex><span><span style=color:#d14>tbody tr:nth-child(even) {
</span></span></span><span style=display:flex><span><span style=color:#d14>background: #f0f0f2;
</span></span></span><span style=display:flex><span><span style=color:#d14>}
</span></span></span><span style=display:flex><span><span style=color:#d14>/style&gt;
</span></span></span><span style=display:flex><span><span style=color:#d14>&#34;@</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># Define the text that will be part of the HTML report in a herestring. Be careful with &#34;@</span>
</span></span><span style=display:flex><span><span style=color:teal>$PreContent</span> = <span style=color:#d14>@&#34;
</span></span></span><span style=display:flex><span><span style=color:#d14>Hello, br/&gt;br/&gt;
</span></span></span><span style=display:flex><span><span style=color:#d14>
</span></span></span><span style=display:flex><span><span style=color:#d14>The </span><span style=color:teal>$NewSUGName</span><span style=color:#d14> Software Update Group has been created. It contains the following updates:br/&gt;br/&gt;
</span></span></span><span style=display:flex><span><span style=color:#d14>&#34;@</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># Build an array of PS Objects each containing the KB ID, KB Name and execution time</span>
</span></span><span style=display:flex><span><span style=color:teal>$Info</span> = @()
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>ForEach</span> (<span style=color:teal>$Update</span> <span style=color:#000;font-weight:700>in</span> (<span style=color:#0086b3>Get-CMSoftwareUpdate</span> -UpdateGroupID <span style=color:teal>$SUG</span>.CI_ID -Fast))
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span><span style=color:teal>$UpdateProperties</span> = [<span style=color:teal>PSCustomObject</span>]@{
</span></span><span style=display:flex><span>KB = <span style=color:teal>$Update</span>.ArticleID
</span></span><span style=display:flex><span>Titre = <span style=color:teal>$Update</span>.LocalizedDisplayName
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># Though it&#39;s set in minutes, the execution time is stored in seconds so we need to divide it by 60 to display the value in minutes</span>
</span></span><span style=display:flex><span><span style=color:#d14>&#34;Max execution time (mins)&#34;</span> = <span style=color:teal>$Update</span>.MaxExecutionTime / <span style=color:#099>60</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:teal>$Info</span> += <span style=color:teal>$UpdateProperties</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># Build an HTML table out of the previous array and add the header and precontent text</span>
</span></span><span style=display:flex><span><span style=color:teal>$Info</span> | <span style=color:#0086b3>ConvertTo-Html</span> <span style=color:#000;font-weight:700>-As</span> Table -PreContent <span style=color:teal>$PreContent</span> -Head <span style=color:teal>$HtmlHeader</span> | <span style=color:#0086b3>Out-File</span> <span style=color:#d14>&#34;C:\Temp\</span><span style=color:teal>$NewSUGName</span><span style=color:#d14>.html&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=using-status-filter-rule-to-execute-the-script-automatically>Using Status Filter Rule to execute the script automatically</h2><p>Now that the script is ready, let&rsquo;s hook it to a Status Filter Rule to automate its execution. Let&rsquo;s go back to <strong>Administration > Overview > Site Configuration > Sites</strong> and right click on the desired site where the Status Filter Rule should be created.</p><p>In the new window, follow this steps:</p><ul><li>Click the <strong>Create</strong> button and chose a name for your rule;</li><li>Check the <strong>Message ID</strong> box and type <strong>5800</strong> in the field next to it;</li><li>Click on the <strong>Next</strong> button.</li></ul><p>That&rsquo;s it for the filter, we don&rsquo;t need anything else. On the <strong>Actions</strong> page, check the <strong>Run a program</strong> checkbox and enter the following command line (See below). Then click <strong>Next</strong> to review your Status Filter Rule and complete the wizard.</p><p>This command line will call the PowerShell script with three parameters. As you can see, they are Status Filter Rules variables.</p><p><code>C:\Windows\system32\WindowsPowerShell\v1.0\powershell.exe -ExecutionPolicy Bypass -NoProfile -WindowStyle Hidden -File C:\Scripts\OnADRCompletion.ps1 -SiteServer %sitesvr -SiteCode %sc -Description "%msgdesc"</code></p><p><a href=SFR-Creation_Part-1.png><div class=image><figure><a href=SFR-Creation_Part-1.png target=_blank><img src=SFR-Creation_Part-1.png alt=screenshot></a></figure></div></a>Selecting filters
<a href=SFR-Creation_Part-2.png><div class=image><figure><a href=SFR-Creation_Part-2.png target=_blank><img src=SFR-Creation_Part-2.png alt=screenshot></a></figure></div></a>Setting actions</p><p>Your Status Filter Rule is now ready to work. All you have to do is to wait for your ADR to hit the next scheduled execution and see the result. Or if you don&rsquo;t want to wait, you can force one of your ADR to run.</p><h2 id=final-verification>Final verification</h2><p>Once it&rsquo;s completed, the Status Filter Rule should trap the status message corresponding to the Software Update Group creation and start the PowerShell script.</p><p>To check if anything was wrong, you can take a look at the <strong>statmgr.log</strong>. There should be a log line stating that the PowerShell process has been started with the arguments that you have set in the Status Filter Rule.</p><p><div class=image><figure><a href=statmgr.log_.png target=_blank><img src=statmgr.log_.png alt=screenshot></a></figure></div></p><img src=/authors/michael-de-bona/avatar.png alt="Photo of MichaÃ«l De Bona"><br><strong>MichaÃ«l De Bona</strong>
<em>Contributor</em><div></div><p>MichaÃ«l is a Windows and ConfigMgr admin who likes to automate all the things.</p><hr></div><comments id=comments><script src=https://utteranc.es/client.js repo=SysManSquad/sysmansquadblog issue-term=title label="blog comment" theme=github-light crossorigin=anonymous async></script></comments></article></div></div></div><footer id=footer><div class=container><div id=footer-copyright><p class=copyright>&copy; 2024 WinAdmins - https://sysmansquad.com/ - Systems Management Squad</a></p></div></div></footer></div></body></html>