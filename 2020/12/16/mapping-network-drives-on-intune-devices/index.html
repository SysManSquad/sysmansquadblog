<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=keyword content="ConfigMgr Microsoft Intune Windows WinAdmins">
<meta name=viewport content="width=device-width">
<meta name=description content="A community blog and subsidiary of WinAdmins.io">
<link rel="shortcut icon" href=/img/favicon.ico>
<title>Mapping Network Drives on Intune Devices-SysManSquad | Systems Management Squad</title>
<link rel=canonical href=/2020/12/16/mapping-network-drives-on-intune-devices/>
<link rel=stylesheet href=/css/style.css>
<link rel=stylesheet href=https://blog.sysmansquad.com/css/custom.css>
<script src=https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js></script>
<script src=https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js></script>
<script src=https://blog.sysmansquad.com/js/jquery.slicknav.js></script>
<script src=https://blog.sysmansquad.com/js/asd_SlickNav_Mobile.js></script>
<script src=https://blog.sysmansquad.com/js/custom.js></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XXZR1RSQYX"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-XXZR1RSQYX',{anonymize_ip:!1})}</script>
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://blog.sysmansquad.com/83">
<meta name=twitter:title content="Mapping Network Drives on Intune Devices">
<meta name=twitter:description content="This guide is part of a video series companion guide on setting up mapped drives on Intune devices - you can watch the video here S02E18 - How to Map Network Drives on Microsoft Intune Devices - (I.T) - YouTube! This is rather simple but I will be adding some useful bits of code for people who do not have an always on VPN solution for all those Work From Home scenarios.">
</head>
<body class="home blog">
<div id=asd-container>
<div id=top-bar>
<div class=container>
<div id=nav-wrapper>
<ul class=menu id=menu-top-menu>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/>Home</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/about/>
<span>About</span>
</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=https://github.com/SysManSquad>
<span>GitHub</span>
</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/jointhesquad/>
<span>Join the Squad</span>
</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/meetthesquad/>
<span>Meet the Squad</span>
</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=#>
<span>MORE></span>
</a>
<ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/contact/>Contact</a>
</li>
</ul>
</li>
</ul>
</div>
<div id=top-search>
<a href=# class=search><i class="fa fa-search"></i></a>
<div class=show-search>
<form role=search method=get action=https://www.google.com/search id=searchform>
<input type=search placeholder="Search and hit enter..." name=q id=q title="Search and hit enter...">
<input type=hidden name=sitesearch value=https://blog.sysmansquad.com>
<button type=submit value=Search>
</form>
</div>
</div>
<div class=menu id=menu-mobile></div>
</div>
</div>
<header id=header class=noslider>
<div class=container>
<div id=logo>
<h1><a href=https://blog.sysmansquad.com><img src=/img/SysManSquad-HorizontalColor-Logo.png alt="Systems Management Squad"></a></h1>
</div>
</div>
</header>
<div class=container>
<div id=content>
<div id=main class=fullwidth>
<article class="post type-post status-publish format-standard has-post-thumbnail hentry">
<div class=post-header>
<h1>Mapping Network Drives on Intune Devices</h1>
<span class=post-date>December 16, 2020</span>
</div>
<div class=post-entry>
<p>This guide is part of a video series companion guide on setting up mapped drives on Intune devices - you can watch the video here <a href="https://www.youtube.com/watch?v=hHtXFeuHkC4">S02E18 - How to Map Network Drives on Microsoft Intune Devices - (I.T) - YouTube</a>! This is rather simple but I will be adding some useful bits of code for people who do not have an always on VPN solution for all those Work From Home scenarios.</p>
<h2 id=creating-the-script>Creating the script</h2>
<p>Before we get started let me explain how this process works. We are going to create a script that we deploy via intune, which in turn will create a scheduled task to map the network drives at login. We will then be adding a few lines of code to also have it map on any network changes.</p>
<ol>
<li>Go to <a href=https://intunedrivemapping.azurewebsites.net/DriveMapping>https://intunedrivemapping.azurewebsites.net/DriveMapping</a></li>
<li>Follow the onscreen options to add/remove mapped drives as needed</li>
<li>Select <strong>Download Powershell Script</strong></li>
<li>Edit the powershell script, near the bottom you will see the following line<br>
<code>$trigger&amp;nbsp;=&amp;nbsp;New-ScheduledTaskTrigger&amp;nbsp;-AtLogOn</code></li>
<li>Remove everything below that point and add the following</li>
</ol>
<p>$class = cimclass MSFT_TaskEventTrigger root/Microsoft/Windows/TaskScheduler
$trigger2 = $class | New-CimInstance -ClientOnly
$trigger2.Enabled = $True
$trigger2.Subscription = &lsquo;&lt;QueryList>&lt;Query Id=&ldquo;0&rdquo; Path=&ldquo;Microsoft-Windows-NetworkProfile/Operational&rdquo;>&lt;Select Path=&ldquo;Microsoft-Windows-NetworkProfile/Operational&rdquo;>*[System[Provider[@Name=&lsquo;&lsquo;Microsoft-Windows-NetworkProfile&rsquo;'] and EventID=10002]]&lt;/Select>&lt;/Query>&lt;/QueryList>&rsquo;</p>
<p>$trigger3 = $class | New-CimInstance -ClientOnly
$trigger3.Enabled = $True
$trigger3.Subscription = &lsquo;&lt;QueryList>&lt;Query Id=&ldquo;0&rdquo; Path=&ldquo;Microsoft-Windows-NetworkProfile/Operational&rdquo;>&lt;Select Path=&ldquo;Microsoft-Windows-NetworkProfile/Operational&rdquo;>*[System[Provider[@Name=&lsquo;&lsquo;Microsoft-Windows-NetworkProfile&rsquo;'] and EventID=4004]]&lt;/Select>&lt;/Query>&lt;/QueryList>&rsquo;</p>
<p>#Execute task in users context
$principal= New-ScheduledTaskPrincipal -GroupId &ldquo;S-1-5-32-545&rdquo; -Id &ldquo;Author&rdquo;</p>
<p>#call the vbscript helper and pass the PosH script as argument
$action = New-ScheduledTaskAction -Execute $wscriptPath -Argument &ldquo;<code>"$dummyScriptPath</code>&rdquo; <code>"$scriptPath</code>""</p>
<p>$settings= New-ScheduledTaskSettingsSet -AllowStartIfOnBatteries -DontStopIfGoingOnBatteries</p>
<p>$null=Register-ScheduledTask -TaskName $schtaskName -Trigger $trigger,$trigger2,$trigger3 -Action $action -Principal $principal -Settings $settings -Description $schtaskDescription -Force</p>
<p>Start-ScheduledTask -TaskName $schtaskName
stop-Transcript
}</p>
<h2 id=upload-to-intune>Upload to Intune</h2>
<ol>
<li>Navigate to <a href=https://endpoint.microsoft.com/>https://endpoint.microsoft.com/</a></li>
<li>Select <strong>Devices</strong></li>
<li>Select <strong>Scripts</strong></li>
<li>Select <strong>Add - Windows 10</strong></li>
<li>Give it a Name and select <strong>Next</strong></li>
<li>Select your script file and <strong>Next</strong></li>
<li>Assign to the desired user group and <strong>Next</strong></li>
<li>Select <strong>Add</strong></li>
</ol>
<h2 id=verify-the-scheduled-task-exists>Verify the Scheduled Task Exists</h2>
<p>Once you have deployed the script to the selected group, you can sync Intune policies through Company Portal. Remember it can take up to 8 hours for this to appear. You should see a scheduled Task named <code>&lt;strong>IntuneDriveMapping&lt;/strong></code> and the triggers should look like the below.</p>
<p><div class=image>
<figure>
<a href=MicrosoftTeams-image-2-1024x439.png target=_blank>
<img src=MicrosoftTeams-image-2-1024x439.png alt>
</a>
</figure>
</div> </p>
</div>
<div class=post-share>
<div class="post-share-box share-comments">
hello
</div>
</div>
<div class=post-author>
</div>
<comments id=comments>
<script src=https://utteranc.es/client.js repo=SysManSquad/sysmansquadblog issue-term=title label="blog comment" theme=github-light crossorigin=anonymous async></script>
</comments>
</article>
</div>
</div>
</div>
<footer id=footer>
<div class=container>
<div id=footer-copyright>
<p class=copyright>&copy; 2021 WinAdmins - https://blog.sysmansquad.com - Systems Management Squad</a></p>
</div>
</div>
</footer>
</div>
</body>
</html>