<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=keyword content="ConfigMgr Microsoft Intune Windows WinAdmins"><meta name=viewport content="width=device-width"><meta name=description content="A community blog and subsidiary of WinAdmins.io"><link rel="shortcut icon" href=/img/favicon.ico><title>Mapping Network Drives on Intune Devices-SysManSquad | Systems Management Squad</title><link rel=canonical href=/2020/12/16/mapping-network-drives-on-intune-devices/><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=https://sysmansquad.com/css/custom.css><script src=https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js></script>
<script src=https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js></script>
<script src=https://sysmansquad.com/js/jquery.slicknav.js></script>
<script src=https://sysmansquad.com/js/asd_SlickNav_Mobile.js></script>
<script src=https://sysmansquad.com/js/clipboard.js></script>
<script src=https://sysmansquad.com/js/custom.js></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XXZR1RSQYX"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XXZR1RSQYX",{anonymize_ip:!1})}</script><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://sysmansquad.com/83"><meta name=twitter:title content="Mapping Network Drives on Intune Devices"><meta name=twitter:description content="This guide is part of a video series companion guide on setting up mapped drives on Intune devices - you can watch the video here S02E18 How to Map Network Drives on Microsoft Intune Devices - (I.T)! This is rather simple but I will be adding some useful bits of code for people who do not have an always on VPN solution for all those Work From Home scenarios.
Creating the script Before we get started let me explain how this process works."></head><body class="home blog"><div id=asd-container><div id=top-bar><div class=container><div id=nav-wrapper><ul class=menu id=menu-top-menu><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/>Home</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/about/><span>About</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=https://github.com/SysManSquad><span>GitHub</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/jointhesquad/><span>Join the Squad</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/meetthesquad/><span>Meet the Squad</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=#><span>MORE></span></a><ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/contact/>Contact</a></li></ul></li></ul></div><div id=top-search><a href=# class=search><i class="fa fa-search"></i></a><div class=show-search><form role=search method=get action=https://www.google.com/search id=searchform><input type=search placeholder="Search and hit enter..." name=q id=q title="Search and hit enter...">
<input type=hidden name=sitesearch value=https://sysmansquad.com>
<button type=submit value=Search class=searchbutton></form></div></div><div class=menu id=menu-mobile></div></div></div><header id=header class=noslider><div class=container><div id=logo><h1><a href=https://sysmansquad.com><img src=/img/SysManSquad-HorizontalColor-Logo.png alt="Systems Management Squad"></a></h1></div></div></header><div class=container><div id=content><div id=main class=fullwidth><article class="post type-post status-publish format-standard has-post-thumbnail hentry"><div class=post-header><h1>Mapping Network Drives on Intune Devices</h1><p class=p-meta><span class=post-author><a href=/authors/jake>Jake Shackelford</a> /</span>
<span class=post-date>December 16, 2020</span>
<span class=post-categories>/ Endpoint Management</span>
<span class=post-categories>/ How-To</span>
<span class=post-categories>/ Intune</span>
<span class=post-categories>/ Powershell</span>
<span class=post-categories>/ Proactive Remediation</span>
<span class=post-categories>/ Scripting</span></p></div><div class=post-entry><p>This guide is part of a video series companion guide on setting up mapped drives on Intune devices - you can watch the video here <a href="https://www.youtube.com/watch?v=hHtXFeuHkC4">S02E18 How to Map Network Drives on Microsoft Intune Devices - (I.T)</a>! This is rather simple but I will be adding some useful bits of code for people who do not have an always on VPN solution for all those Work From Home scenarios.</p><h2 id=creating-the-script>Creating the script</h2><p>Before we get started let me explain how this process works. We are going to create a script that we deploy via intune, which in turn will create a scheduled task to map the network drives at login. We will then be adding a few lines of code to also have it map on any network changes.</p><ol><li>Go to <a href=https://intunedrivemapping.azurewebsites.net/DriveMapping>https://intunedrivemapping.azurewebsites.net/DriveMapping</a></li><li>Follow the onscreen options to add/remove mapped drives as needed</li><li>Select <strong>Download Powershell Script</strong></li><li>Edit the powershell script, near the bottom you will see the following line<br><code>$trigger=New-ScheduledTaskTrigger-AtLogOn</code></li><li>Remove everything below that point and add the following</li></ol><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-1> 1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-2> 2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-3> 3</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-4> 4</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-5> 5</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-6> 6</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-7> 7</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-8> 8</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-9> 9</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-10>10</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-11>11</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-12>12</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-13>13</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-14>14</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-15>15</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-16>16</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-17>17</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-18>18</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-19>19</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-20>20</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-21>21</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-22>22</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-23>23</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-24>24</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:teal>$trigger</span> = <span style=color:#0086b3>New-ScheduledTaskTrigger</span> -AtLogOn
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:teal>$class</span> = cimclass MSFT_TaskEventTrigger root/Microsoft/Windows/TaskScheduler
</span></span><span style=display:flex><span><span style=color:teal>$trigger2</span> = <span style=color:teal>$class</span> | <span style=color:#0086b3>New-CimInstance</span> -ClientOnly
</span></span><span style=display:flex><span><span style=color:teal>$trigger2</span>.Enabled = <span style=color:teal>$True</span>
</span></span><span style=display:flex><span><span style=color:teal>$trigger2</span>.Subscription = <span style=color:#d14>&#39;QueryList&gt;Query Id=&#34;0&#34; Path=&#34;Microsoft-Windows-NetworkProfile/Operational&#34;&gt;Select Path=&#34;Microsoft-Windows-NetworkProfile/Operational&#34;&gt;*[System[Provider[@Name=&#39;&#39;Microsoft-Windows-NetworkProfile&#39;&#39;] and EventID=10002]]/Select&gt;/Query&gt;/QueryList&gt;&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:teal>$trigger3</span> = <span style=color:teal>$class</span> | <span style=color:#0086b3>New-CimInstance</span> -ClientOnly
</span></span><span style=display:flex><span><span style=color:teal>$trigger3</span>.Enabled = <span style=color:teal>$True</span>
</span></span><span style=display:flex><span><span style=color:teal>$trigger3</span>.Subscription = <span style=color:#d14>&#39;QueryList&gt;Query Id=&#34;0&#34; Path=&#34;Microsoft-Windows-NetworkProfile/Operational&#34;&gt;Select Path=&#34;Microsoft-Windows-NetworkProfile/Operational&#34;&gt;*[System[Provider[@Name=&#39;&#39;Microsoft-Windows-NetworkProfile&#39;&#39;] and EventID=4004]]/Select&gt;/Query&gt;/QueryList&gt;&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic>#Execute task in users context</span>
</span></span><span style=display:flex><span><span style=color:teal>$principal</span>= <span style=color:#0086b3>New-ScheduledTaskPrincipal</span> -GroupId <span style=color:#d14>&#34;S-1-5-32-545&#34;</span> -Id <span style=color:#d14>&#34;Author&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic>#call the vbscript helper and pass the PosH script as argument</span>
</span></span><span style=display:flex><span><span style=color:teal>$action</span> = <span style=color:#0086b3>New-ScheduledTaskAction</span> -Execute <span style=color:teal>$wscriptPath</span> -Argument <span style=color:#d14>&#34;</span><span style=color:#d14>`&#34;</span><span style=color:#d14>$dummyScriptPath</span><span style=color:#d14>`&#34;</span><span style=color:#d14> </span><span style=color:#d14>`&#34;</span><span style=color:#d14>$scriptPath</span><span style=color:#d14>`&#34;</span><span style=color:#d14>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:teal>$settings</span>= <span style=color:#0086b3>New-ScheduledTaskSettingsSet</span> -AllowStartIfOnBatteries -DontStopIfGoingOnBatteries
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:teal>$null</span>=<span style=color:#0086b3>Register-ScheduledTask</span> -TaskName <span style=color:teal>$schtaskName</span> -Trigger <span style=color:teal>$trigger</span>,<span style=color:teal>$trigger2</span>,<span style=color:teal>$trigger3</span> -Action <span style=color:teal>$action</span>  -Principal <span style=color:teal>$principal</span> -Settings <span style=color:teal>$settings</span> -Description <span style=color:teal>$schtaskDescription</span> -Force
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#0086b3>Start-ScheduledTask</span> -TaskName <span style=color:teal>$schtaskName</span>
</span></span><span style=display:flex><span><span style=color:#0086b3>stop-Transcript</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h2 id=upload-to-intune>Upload to Intune</h2><ol><li>Navigate to <a href=https://endpoint.microsoft.com/>https://endpoint.microsoft.com/</a></li><li>Select <strong>Devices</strong></li><li>Select <strong>Scripts</strong></li><li>Select <strong>Add - Windows 10</strong></li><li>Give it a Name and select <strong>Next</strong></li><li>Select your script file and <strong>Next</strong></li><li>Assign to the desired user group and <strong>Next</strong></li><li>Select <strong>Add</strong></li></ol><h2 id=verify-the-scheduled-task-exists>Verify the Scheduled Task Exists</h2><p>Once you have deployed the script to the selected group, you can sync Intune policies through Company Portal. Remember it can take up to 8 hours for this to appear. You should see a scheduled Task named <code>IntuneDriveMapping</code> and the triggers should look like the below.</p><p><div class=image><figure><a href=MicrosoftTeams-image-2-1024x439.png target=_blank><img src=MicrosoftTeams-image-2-1024x439.png alt=screenshot></a></figure></div></p><img src=/authors/jake/avatar.png alt="Photo of Jake Shackelford"><br><strong>Jake Shackelford</strong>
<em>Admin/Contributor</em><div><a href=https://twitter.com/shackelfjaco><img src=/img/social/twitter.png></a></div><p>Jake is one of our Admins but also our inaugural author and the main reason SysManSquad exists today.</p><hr></div><div class=post-share><div class="post-share-box share-comments"></div></div><comments id=comments><script src=https://utteranc.es/client.js repo=SysManSquad/sysmansquadblog issue-term=title label="blog comment" theme=github-light crossorigin=anonymous async></script></comments></article></div></div></div><footer id=footer><div class=container><div id=footer-copyright><p class=copyright>&copy; 2022 WinAdmins - https://sysmansquad.com - Systems Management Squad</a></p></div></div></footer></div></body></html>