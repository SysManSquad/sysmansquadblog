<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=keyword content="ConfigMgr Microsoft Intune Windows WinAdmins"><meta name=viewport content="width=device-width"><meta name=description content="A community blog and subsidiary of WinAdmins.io"><link rel="shortcut icon" href=/img/favicon.ico><title>VPN Boundary Type and Understanding Its Options-SysManSquad | Systems Management Squad</title><link rel=canonical href=/2020/09/14/vpn-boundary-type-and-understanding-its-options/><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=https://sysmansquad.com/css/custom.css><script src=https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js></script>
<script src=https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js></script>
<script src=https://sysmansquad.com/js/jquery.slicknav.js></script>
<script src=https://sysmansquad.com/js/asd_SlickNav_Mobile.js></script>
<script src=https://sysmansquad.com/js/clipboard.js></script>
<script src=https://sysmansquad.com/js/custom.js></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XXZR1RSQYX"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XXZR1RSQYX",{anonymize_ip:!1})}</script><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://sysmansquad.com/83"><meta name=twitter:title content="VPN Boundary Type and Understanding Its Options"><meta name=twitter:description content="Like many, I was very excited that the new Configuration Manager 2006 release included a huge improvement for remote devices by adding a new VPN Boundary type.
&ldquo;Finally! I don&rsquo;t have to constantly bug my Network Engineers as to which IP pools are being used for which VPN appliances.&rdquo;
Create A New Boundary In the Admin Console, navigate to the Administration Node and open up Hierarchy Configuration and right-click on Boundaries"></head><body class="home blog"><div id=asd-container><div id=top-bar><div class=container><div id=nav-wrapper><ul class=menu id=menu-top-menu><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/>Home</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/about/><span>About</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=https://github.com/SysManSquad><span>GitHub</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/jointhesquad/><span>Join the Squad</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/meetthesquad/><span>Meet the Squad</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=#><span>MORE></span></a><ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/contact/>Contact</a></li></ul></li></ul></div><div id=top-search><a href=# class=search><i class="fa fa-search"></i></a><div class=show-search><form role=search method=get action=https://www.google.com/search id=searchform><input type=search placeholder="Search and hit enter..." name=q id=q title="Search and hit enter...">
<input type=hidden name=sitesearch value=https://sysmansquad.com>
<button type=submit value=Search class=searchbutton></form></div></div><div class=menu id=menu-mobile></div></div></div><header id=header class=noslider><div class=container><div id=logo><h1><a href=https://sysmansquad.com><img src=/img/SysManSquad-HorizontalColor-Logo.png alt="Systems Management Squad"></a></h1></div></div></header><div class=container><div id=content><div id=main class=fullwidth><article class="post type-post status-publish format-standard has-post-thumbnail hentry"><div class=post-header><h1>VPN Boundary Type and Understanding Its Options</h1><p class=p-meta><span class=post-author><a href=/authors/nic>Nic Wendlowsky</a> /</span>
<span class=post-date>September 14, 2020</span>
<span class=post-categories>/ Endpoint Management</span>
<span class=post-categories>/ MECM/MEMCM/SCCM</span></p></div><div class=post-entry><p>Like many, I was <em>very</em> excited that the new <a href=https://docs.microsoft.com/mem/configmgr/core/plan-design/changes/whats-new-in-version-2006#vpn-boundary-type>Configuration Manager 2006</a> release included a huge improvement for remote devices by adding a new <a href=https://docs.microsoft.com/mem/configmgr/core/servers/deploy/configure/boundaries#vpn>VPN Boundary type</a>.</p><blockquote><p><em>&ldquo;Finally! I don&rsquo;t have to constantly bug my Network Engineers as to which IP pools are being used for which VPN appliances.&rdquo;</em></p></blockquote><h2 id=create-a-new-boundary>Create A New Boundary</h2><p>In the Admin Console, navigate to the Administration Node and open up Hierarchy Configuration and right-click on Boundaries</p><p><div class=image><figure><a href=image-2.png target=_blank><img src=image-2.png alt=screenshot></a></figure></div></p><p>Select the new VPN option in the Type drop-down</p><p><div class=image><figure><a href=image-3.png target=_blank><img src=image-3.png alt=screenshot></a></figure></div></p><h2 id=exploring-the-vpn-type-options>Exploring the VPN Type Options</h2><h3 id=types-defined>Types Defined</h3><p>From the <a href=https://docs.microsoft.com/mem/configmgr/core/servers/deploy/configure/boundaries#vpn>Define boundaries - Configuration Manager | Microsoft Docs</a>, these are the type options:</p><ul><li><strong>Auto detect VPN</strong>: Configuration Manager detects any VPN solution that uses the point-to-point tunneling protocol (PPTP). If it doesn&rsquo;t detect your VPN, use one of the other options. The boundary value in the console list will beAuto:On.</li><li><strong>Connection name</strong>: Specify the name of the VPN connection on the device. It&rsquo;s the name of the network adapter in Windows for the VPN connection. Configuration Manager matches the first 250 characters of the string, but doesn&rsquo;t support wildcard characters or partial strings. The boundary value in the console list will beName:&lt;name>, where&lt;name>is the connection name that you specify.<br>For example, you run theipconfigcommand on the device, and one of the sections starts with:PPP adapter ContosoVPN:. Use the stringContosoVPNas the<strong>Connection name</strong>. It displays in the list asName:CONTOSOVPN.</li><li><strong>Connection description</strong>: Specify the description of the VPN connection. Configuration Manager matches the first 243 characters of the string, <strong>but doesn&rsquo;t support wildcard characters or partial strings</strong>. The boundary value in the console list will be Description: &lt;description>, where&lt;description>is the connection description that you specify.</li></ul><p>For example, you run the <code>ipconfig /all</code> command on the device, and one of the connections includes the following line:</p><blockquote><p>Description . . . . . . . . . . . : Contoso MainVPN.</p></blockquote><p>Use the string <code>Contoso MainVPN</code> as the <strong>Connection description</strong>. It displays in the list as <code>Description:CONTOSOMAINVPN</code>.</p><h3 id=finding-the-best-fit>Finding the Best Fit</h3><table><thead><tr><th><strong>Type</strong></th><th><strong>Decision</strong></th><th><strong>Selected</strong></th></tr></thead><tbody><tr><td><strong>Auto detect VPN</strong></td><td>We don&rsquo;t use PPTP</td><td></td></tr><tr><td><strong>Connection name</strong></td><td>This won&rsquo;t work as our VPN client doesn&rsquo;t create a &ldquo;section&rdquo; with a title like <code>PPP adapter ContosoVPN</code></td><td></td></tr><tr><td><strong>Connection description</strong></td><td>Just need to copy the Description value from ipconfig/all and we&rsquo;re done!</td><td>X</td></tr></tbody></table><p>Obviously that didn&rsquo;t work, otherwise I&rsquo;d be enjoying a low-ball of Macallan 12 year instead of typing this blog post. (Who am I kidding, I still made the drink.)</p><h2 id=to-test-i-followed-the-instructions>To test, I followed the instructions</h2><p>On a machine connected to our VPN solution, Palo Alto Global Protect, I capture the specified information from the documentation.</p><p><a href="https://www.sysmansquad.com/?attachment_id=1747"><div class=image><figure><a href=2020-09-13_9-33-39.png target=_blank><img src=2020-09-13_9-33-39.png alt=screenshot></a></figure></div></a></p><p>Next, I went back to the Admin Console and my open Create Boundary window, and pasted the description from <code>ipconfig /all</code> into the Connection Description field.</p><p><div class=image><figure><a href=image-4.png target=_blank><img src=image-4.png alt=screenshot></a></figure></div></p><p>Then I added the new Boundary to my VPN Boundary Group.</p><h2 id=test-results>Test Results</h2><p>What happened next confused me. After forcing a few clients to update their Machine Policy, I saw VPN-connected devices drop <em>out</em> of the VPN Boundary Group that I added my newly-created Boundary to. I double-checked my own machine:</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#0086b3>Get-CimInstance</span> -Namespace <span style=color:#d14>&#34;rootccmLocationServices&#34;</span> -ClassName <span style=color:#d14>&#34;BoundaryGroupCache&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>The output revealed that my machine was no longer in my VPN Boundary Group, and instead was merely in the fallback Default Boundary Group.<br>But WHY?</p><p>Taking to Twitter, I posted a message&mldr;</p><blockquote><p>can you screenshot IPCONFIG /ALL on a device that is connected to that VPN
— Rob York (@robdotyork)
<a href="https://twitter.com/robdotyork/status/1298788226606329858?ref_src=twsrc%5Etfw">August 27, 2020</a></p></blockquote><p>and none other than Rob York responded, inadvertently leading me to answer my own question</p><blockquote><p>don’t know the answer to your specific question. Someone in the community likely will though. But what you saw is expected. This is evaluated client side. the info in the database is not used.
— Rob York (@robdotyork)
<a href="https://twitter.com/robdotyork/status/1298807830867111938?ref_src=twsrc%5Etfw">August 27, 2020</a></p></blockquote><h2 id=my-mistakes-were-two-fold>My mistakes were two-fold:</h2><ol><li>Some of you may have noticed above that the output from <code>ipconfig/all</code> in my image did not match what I typed into the <code>Connection Description</code> field in the Boundary properties window.<ol><li>The <a href=https://docs.microsoft.com/mem/configmgr/core/servers/deploy/configure/boundaries#vpn>docs</a> clearly state that the string must be exact and that wildcards are not supported (see red text in type definitions above).</li></ol></li><li>The second mistake I made was attempting to have forethought while also assuming I knew what I was doing.<ol><li>When I opened the Admin Console, I thought, &ldquo;Hey, there&rsquo;s a chance that there could be slight variations in the Description value among the 1k+ devices I have. Let&rsquo;s check the database first.&rdquo;</li><li>I ran this query and got the results shown in my Tweet above</li></ol></li></ol><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-1>1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-2>2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-3>3</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-4>4</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-5>5</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>select</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>Distinct</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>Description0<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>v_GS_NETWORK_ADAPTER<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> </span>Description0<span style=color:#bbb> </span><span style=color:#000;font-weight:700>LIKE</span><span style=color:#bbb> </span><span style=color:#d14>&#39;PANGP Virtual Ethernet Adapter%&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>ORDER</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>Description0<span style=color:#bbb>
</span></span></span></code></pre></td></tr></table></div></div><p>I assumed that the <code>Description</code> field populated in <code>win32_networkadapter</code> matched the <code>Description</code> field from <code>ipconfig/all</code>, but you already know that wasn&rsquo;t the case.</p><p><div class=image><figure><a href=Snag_2984151.png target=_blank><img src=Snag_2984151.png alt="Description Compare"></a></figure></div></p><h2 id=the-solution>The Solution</h2><p>Once I re-read Rob York&rsquo;s response, I realized I was looking at the wrong property and ninja-edited my SQL query:</p><blockquote><p><em>&ldquo;But what you saw is expected&rdquo;</em></p><p><strong>Rob york</strong></p></blockquote><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-1>1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-2>2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-3>3</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-4>4</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-5>5</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-6>6</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-7>7</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>select</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>Distinct</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>Name0<span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span><span style=color:#d14>&#39;VPN Boundary Description&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>,Description0<span style=color:#bbb> </span><span style=color:#000;font-weight:700>AS</span><span style=color:#bbb> </span><span style=color:#d14>&#39;win32_networkadapter description&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>FROM</span><span style=color:#bbb> </span>v_GS_NETWORK_ADAPTER<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>WHERE</span><span style=color:#bbb> </span>Name0<span style=color:#bbb> </span><span style=color:#000;font-weight:700>LIKE</span><span style=color:#bbb> </span><span style=color:#d14>&#39;PANGP Virtual Ethernet Adapter%&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>ORDER</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>BY</span><span style=color:#bbb> </span>Description0<span style=color:#bbb>
</span></span></span></code></pre></td></tr></table></div></div><p>This gave me more results and made me realize I needed a Boundary for each of these adapter Descriptions. Er&mldr; <em>Name0</em></p><p><div class=image><figure><a href=Snag_29cce99.png target=_blank><img src=Snag_29cce99.png alt="SQL adapter"></a></figure></div></p><p>And now my VPN Boundary Group looks like this and devices are where they need to be.</p><p><div class=image><figure><a href=Snag_2a0b39b.png target=_blank><img src=Snag_2a0b39b.png alt=BG></a></figure></div></p><img src=/authors/nic/avatar.png alt="Photo of Nic Wendlowsky"><br><strong>Nic Wendlowsky</strong>
<em>Contributor</em><div><a href=https://twitter.com/wendlowsky><img src=/img/social/twitter.png></a>
<a href=https://www.linkedin.com/in/nic-wendlowsky><img src=/img/social/linkedin.png></a></div><p>Nic is an IT professional of 12+ years, specializing in ConfigMgr over the last 5 with an MCTS for ConfigMgr 2012r2.</p><hr></div><comments id=comments><script src=https://utteranc.es/client.js repo=SysManSquad/sysmansquadblog issue-term=title label="blog comment" theme=github-light crossorigin=anonymous async></script></comments></article></div></div></div><footer id=footer><div class=container><div id=footer-copyright><p class=copyright>&copy; 2022 WinAdmins - https://sysmansquad.com - Systems Management Squad</a></p></div></div></footer></div></body></html>