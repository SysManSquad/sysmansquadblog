<!doctype html><html lang=en-us><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=keyword content="ConfigMgr Microsoft Intune Windows WinAdmins"><meta name=viewport content="width=device-width"><meta name=description content="A community blog and subsidiary of WinAdmins.io"><link rel="shortcut icon" href=/img/favicon.ico><title>Manage Distribution Point Content Using PSCMContentMgmt-SysManSquad | Systems Management Squad</title>
<link rel=canonical href=/2020/09/04/manage-distribution-point-content-using-pscmcontentmgmt/><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=https://sysmansquad.com/css/custom.css><script src=https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js></script><script src=https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js></script><script src=https://sysmansquad.com/js/jquery.slicknav.js></script><script src=https://sysmansquad.com/js/asd_SlickNav_Mobile.js></script><script src=https://sysmansquad.com/js/clipboard.js></script><script src=https://sysmansquad.com/js/custom.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-XXZR1RSQYX"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XXZR1RSQYX",{anonymize_ip:!1})}</script><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://sysmansquad.com/83"><meta name=twitter:title content="Manage Distribution Point Content Using PSCMContentMgmt"><meta name=twitter:description content="Introduction I recently wrote PSCMContentMgmt which provides a simple and effective workflow for managing your MEMCM distribution points. Here are some of the things you can do with it:
Query content objects which are distributed to distribution point(s) or distribution point group(s) Compare content objects distributed to distribution point(s) or distribution point group(s) Find content objects in a &ldquo;distribution failed&rdquo; state for all or selective distribution points Remove, distribute or redistribute content objects returned by any function to distribution point(s) Find an object in your site by searching on any arbitrary ID (useful when reading logs and want to know what object an ID resolves to) Migrate a distribution point&rsquo;s content to a new/different distribution point by exporting its content library to prestaged ."></head><body class="home blog"><div id=asd-container><div id=top-bar><div class=container><div id=nav-wrapper><ul class=menu id=menu-top-menu><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/>Home</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/about/><span>About</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=https://github.com/SysManSquad><span>GitHub</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/jointhesquad/><span>Join the Squad</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/meetthesquad/><span>Meet the Squad</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=#><span>MORE></span></a><ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/contact/>Contact</a></li></ul></li></ul></div><div id=top-search><a href=# class=search><i class="fa fa-search"></i></a><div class=show-search><form role=search method=get action=https://www.google.com/search id=searchform><input type=search placeholder="Search and hit enter..." name=q id=q title="Search and hit enter...">
<input type=hidden name=sitesearch value=https://sysmansquad.com>
<button type=submit value=Search class=searchbutton></form></div></div><div class=menu id=menu-mobile></div></div></div><header id=header class=noslider><div class=container><div id=logo><h1><a href=https://sysmansquad.com><img src=/img/SysManSquad-HorizontalColor-Logo.png alt="Systems Management Squad"></a></h1></div></div></header><div class=container><div id=content><div id=main class=fullwidth><article class="post type-post status-publish format-standard has-post-thumbnail hentry"><div class=post-header><h1>Manage Distribution Point Content Using PSCMContentMgmt</h1><p class=p-meta><span class=post-author><a href=/authors/acc>Adam Cook</a> / </span><span class=post-date>September 4, 2020 </span><span class=post-categories>/ Endpoint Management </span><span class=post-categories>/ MECM/MEMCM/SCCM </span><span class=post-categories>/ Powershell </span><span class=post-categories>/ Scripting</span></p></div><div class=post-entry><h2 id=introduction>Introduction</h2><p>I recently wrote <a href=https://github.com/codaamok/PSCMContentMgmt>PSCMContentMgmt</a> which provides a simple and effective workflow for managing your MEMCM distribution points. Here are some of the things you can do with it:</p><ul><li>Query content objects which are distributed to distribution point(s) or distribution point group(s)</li><li>Compare content objects distributed to distribution point(s) or distribution point group(s)</li><li>Find content objects in a &ldquo;distribution failed&rdquo; state for all or selective distribution points</li><li>Remove, distribute or redistribute content objects returned by any function to distribution point(s)</li><li>Find an object in your site by searching on any arbitrary ID (useful when reading logs and want to know what object an ID resolves to)</li><li>Migrate a distribution point&rsquo;s content to a new/different distribution point by exporting its content library to prestaged .pkgx files and importing the .pkgx files to the new distribution point</li><li>Invoke the ContentLibraryCleanup.exe tool</li></ul><p>PSCMContentMgmt is a mix of being no more than a wrapper for MEMCM cmdlets or native binaries. Some functions query WMI or invoke WMI methods.</p><p>PSCMContentMgmt does not intend to reinvent the wheel from already available cmdlets. Instead it provides a simpler workflow for managing your distribution points by offering:</p><ul><li>Easy to use pipeline support, so you can easily progress through the motions for tasks such as querying content on a distribution point or distribution point group - perhaps in a particular state (e.g. &ldquo;distribution failed&rdquo;) - and distributing, redistributing or removing it from another (or the same) distribution point or distribution point group.</li><li>Consistent property names when dealing with different types of content objects, i.e. the ObjectID property is always PackageID except for Applications/Deployment Types where it is CI_ID (same is true for the -ObjectID parameter on functions that offer it).</li><li>Functionality which the Configuration Manager console does not provide e.g. content redistribution or import .pkgx files.</li></ul><p>At the time of writing this, here are a list of functions in PSCMContentMgmt (be sure to check out the docs on the <a href=https://github.com/codaamok/PSCMContentMgmt>GitHub repository</a> in case there are changes):</p><ul><li><a href=https://github.com/codaamok/PSCMContentMgmt/blob/master/docs/Find-CMOBject.md>Find-CMObject</a></li><li><a href=https://github.com/codaamok/PSCMContentMgmt/blob/master/docs/Compare-DPContent.md>Compare-DPContent</a></li><li><a href=https://github.com/codaamok/PSCMContentMgmt/blob/master/docs/Compare-DPGroupContent.md>Compare-DPGroupContent</a></li><li><a href=https://github.com/codaamok/PSCMContentMgmt/blob/master/docs/Export-DPContent.md>Export-DPContent</a></li><li><a href=https://github.com/codaamok/PSCMContentMgmt/blob/master/docs/Get-DP.md>Get-DP</a></li><li><a href=https://github.com/codaamok/PSCMContentMgmt/blob/master/docs/Get-DPContent.md>Get-DPContent</a></li><li><a href=https://github.com/codaamok/PSCMContentMgmt/blob/master/docs/Get-DPDistributionStatus.md>Get-DPDistributionStatus</a></li><li><a href=https://github.com/codaamok/PSCMContentMgmt/blob/master/docs/Get-DPGroup.md>Get-DPGroup</a></li><li><a href=https://github.com/codaamok/PSCMContentMgmt/blob/master/docs/Get-DPGroupContent.md>Get-DPGroupContent</a></li><li><a href=https://github.com/codaamok/PSCMContentMgmt/blob/master/docs/Import-DPContent.md>Import-DPContent</a></li><li><a href=https://github.com/codaamok/PSCMContentMgmt/blob/master/docs/Invoke-DPContentLibraryCleanup.md>Invoke-DPContentLibraryCleanup</a></li><li><a href=https://github.com/codaamok/PSCMContentMgmt/blob/master/docs/Remove-DPContent.md>Remove-DPContent</a></li><li><a href=https://github.com/codaamok/PSCMContentMgmt/blob/master/docs/Remove-DPGroupContent.md>Remove-DPGroupContent</a></li><li><a href=https://github.com/codaamok/PSCMContentMgmt/blob/master/docs/Set-DPAllowPrestagedContent.md>Set-DPAllowPrestagedContent</a></li><li><a href=https://github.com/codaamok/PSCMContentMgmt/blob/master/docs/Start-DPContentDistribution.md>Start-DPContentDistribution</a></li><li><a href=https://github.com/codaamok/PSCMContentMgmt/blob/master/docs/Start-DPContentRedistribution.md>Start-DPContentRedistribution</a></li><li><a href=https://github.com/codaamok/PSCMContentMgmt/blob/master/docs/Start-DPGroupContentDistribution.md>Start-DPGroupContentDistribution</a></li></ul><h2 id=installing>Installing</h2><p>Install the module from the PowerShell gallery and import it to your session:</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-2>2</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#0086b3>PS </span>C:\&gt; <span style=color:#0086b3>Install-Module</span> PSCMContentMgmt -Scope CurrentUser
</span></span><span style=display:flex><span><span style=color:#0086b3>PS </span>C:\&gt; <span style=color:#0086b3>Import-Module</span> PSCMContentMgmt
</span></span></code></pre></td></tr></table></div></div><p>All functions of the module require use of <code>-SiteServer</code> or <code>-SiteCode</code> parameters. This can be tedious to repeatedly type out. Therefore upon importing the module, two variables will be set in your session:</p><ul><li><p><code>$CMSiteServer</code></p></li><li><p>Value determined by reading the <code>Server</code> registry value in the key <code>HKLM:\SOFTWARE\WOW6432Node\Microsoft\ConfigMgr10\AdminUI\Connection</code>.</p></li><li><p>This registry key is used by the Configuration Manager module, therefore it is assumed this is the site you want to work in.</p></li><li><p><code>$CMSiteCode</code></p></li><li><p>Value determined by reading the <code>SiteCode</code> property in the<code>SMS_ProviderLocation</code> WMI class on the server defined in <code>$CMSiteServer</code></p></li></ul><p>Overwriting these variables is OK and essential if you operate in a multi-site environment.</p><p>If you receive a warning along the lines of being unable to auto-populate variables<code>$CMSiteServer</code>or<code>$CMSiteCode</code>, that means the module failed to read the previously mentioned registry value or the<code>SMS_ProviderLocation</code>class on your site server.</p><p>If the reason why the module could not set these variables itself is not known, or there&rsquo;s no viable workaround for you, then you can set<code>$CMSiteServer</code>or<code>$CMSiteCode</code>yourself. Alternatively you can use the<code>-SiteServer</code>and<code>-SiteCode</code>parameters on an ad-hoc basis.</p><h2 id=examples>Examples</h2><p>I&rsquo;ll walk you through some key examples which I think most people will benefit from.</p><h2 id=comparing-distributed-content-objects-between-two-distribution-points-or-distribution-point-groups><strong>Comparing distributed content objects between two distribution points or distribution point groups</strong></h2><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-17>17</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#0086b3>PS </span>C:\&gt; <span style=color:#0086b3>Compare-DPContent</span> -Source <span style=color:#d14>&#34;dp1.contoso.com&#34;</span> -Target <span style=color:#d14>&#34;dp2.contoso.com&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ObjectName        <span style=color:#a61717;background-color:#e3d2d2>:</span> <span style=color:#099>2020</span>-<span style=color:#099>03</span>-<span style=color:#099>1809</span>
</span></span><span style=display:flex><span>Description       <span style=color:#a61717;background-color:#e3d2d2>:</span>
</span></span><span style=display:flex><span>ObjectType        <span style=color:#a61717;background-color:#e3d2d2>:</span> DeploymentPackage
</span></span><span style=display:flex><span>ObjectID          <span style=color:#a61717;background-color:#e3d2d2>:</span> ACC000F3
</span></span><span style=display:flex><span>SourceSize        <span style=color:#a61717;background-color:#e3d2d2>:</span> <span style=color:#099>324981</span>
</span></span><span style=display:flex><span>DistributionPoint <span style=color:#a61717;background-color:#e3d2d2>:</span> dp1.contoso.com
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ObjectName        <span style=color:#a61717;background-color:#e3d2d2>:</span> <span style=color:#099>2020</span>-<span style=color:#099>02</span>-<span style=color:#099>1809</span>
</span></span><span style=display:flex><span>Description       <span style=color:#a61717;background-color:#e3d2d2>:</span>
</span></span><span style=display:flex><span>ObjectType        <span style=color:#a61717;background-color:#e3d2d2>:</span> DeploymentPackage
</span></span><span style=display:flex><span>ObjectID          <span style=color:#a61717;background-color:#e3d2d2>:</span> ACC000F4
</span></span><span style=display:flex><span>SourceSize        <span style=color:#a61717;background-color:#e3d2d2>:</span> <span style=color:#099>292894</span>
</span></span><span style=display:flex><span>DistributionPoint <span style=color:#a61717;background-color:#e3d2d2>:</span> dp1.contoso.com
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>...
</span></span></code></pre></td></tr></table></div></div><p>Returns content objects which are on dp1.contoso.com but not dp2.contoso.com.</p><p>With this command, you can pipe it to other appropriate functions within PSCMContentMgmt, e.g. <code>Remove-DPContent</code> or <code>Start-DPContentDistribution</code>.</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-16>16</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#0086b3>PS </span>C:\&gt; <span style=color:#0086b3>Compare-DPContent</span> -Source <span style=color:#d14>&#34;dp1.contoso.com&#34;</span> -Target <span style=color:#d14>&#34;dp2.contoso.com&#34;</span> | <span style=color:#0086b3>Start-DPContentDistribution</span> -DistributionPoint <span style=color:#d14>&#34;dp2.contoso.com&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Result    ObjectId ObjectType               Message
</span></span><span style=display:flex><span>------    -------- ----------               -------
</span></span><span style=display:flex><span>Success   ACC00001 Package
</span></span><span style=display:flex><span>Success   ACC00004 BootImage
</span></span><span style=display:flex><span>Success   ACC00005 BootImage
</span></span><span style=display:flex><span>Success   ACC00007 Package
</span></span><span style=display:flex><span>Success   <span style=color:#099>16999742</span> Application
</span></span><span style=display:flex><span>Success   <span style=color:#099>16999646</span> Application
</span></span><span style=display:flex><span>Success   <span style=color:#099>16999674</span> Application
</span></span><span style=display:flex><span>Success   <span style=color:#099>16999752</span> Application
</span></span><span style=display:flex><span>Success   <span style=color:#099>16999720</span> Application
</span></span><span style=display:flex><span>Success   <span style=color:#099>17007034</span> Application
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>...
</span></span></code></pre></td></tr></table></div></div><h2 id=finding-content-objects-in-distribution-failed-state-and-initiating-redistribution-en-masse><strong>Finding content objects in &ldquo;distribution failed&rdquo; state and initiating redistribution en masse</strong></h2><p>This is the most practical function I like about PSCMContentMgmt. It is not uncommon for me to experience distribution failures in my environments and I wanted a way to quickly have a visual on those, and take action.</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-3>3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-4>4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-5>5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-6>6</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#0086b3>PS </span>C:\&gt; <span style=color:#0086b3>Get-DP</span> | <span style=color:#0086b3>Get-DPDistributionStatus</span> -DistributionFailed | <span style=color:#0086b3>Group-Object</span> -Property DistributionPoint
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Count Name                      <span style=color:#0086b3>Group
</span></span></span><span style=display:flex><span><span style=color:#0086b3></span>----- ----                      -----
</span></span><span style=display:flex><span><span style=color:#099>42</span> dp1.contoso.com           {@{ObjectID=<span style=color:#099>17099179</span>; ObjectType=Applicat...
</span></span><span style=display:flex><span><span style=color:#099>30</span> dp2.contoso.com	        {@{ObjectID=<span style=color:#099>17099179</span>; ObjectType=Applicat...
</span></span></code></pre></td></tr></table></div></div><p>Return all distribution points, their associated failed distribution tasks and group the results by distribution point name for an overview.</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#0086b3>PS </span>C:\&gt; <span style=color:#0086b3>Get-DPDistributionStatus</span> -DistributionPoint <span style=color:#d14>&#34;dp1.contoso.com&#34;</span> -DistributionFailed | <span style=color:#0086b3>Start-DPContentRedistribution</span>
</span></span></code></pre></td></tr></table></div></div><p>This is an example on taking action on those items. In this instance, I&rsquo;m initiating redistribution for all of the objects on dp1.contoso.com in a &ldquo;distribution failed&rdquo; state.</p><p>If you didn&rsquo;t want to redistribute, you could pipe to <code>Remove-DPContent</code> instead.</p><h2 id=finding-objects-in-your-environment-with-some-arbitrary-id><strong>Finding objects in your environment with some arbitrary ID</strong></h2><p>This is my favourite function. Do you ever look through log files, see some random ID that you know represents some object in console and just want to know what object that is?</p><p><code>Find-CMObject</code> accepts one parameter and that&rsquo;s <code>-ID</code>. Pass it anything and it&rsquo;ll do its best to find these objects for you:</p><ul><li>Applications</li><li>Deployment Types</li><li>Packages</li><li>Drivers</li><li>Driver Packages</li><li>Boot Images</li><li>Operating System Images</li><li>Operating System Upgrade Images</li><li>Task Sequences</li><li>Configuration Items</li><li>Configuration Baselines</li><li>User Collections</li><li>Device Collections</li><li>(Software Update) Deployment Packages</li></ul><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#0086b3>PS </span>C:\&gt; <span style=color:#0086b3>Find-CMObject</span> -ID <span style=color:#d14>&#34;ACC00048&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>Finds any object which has the PackageID &ldquo;ACC00048&rdquo;, this includes Applications, collections, driver packages, boot images, OS images, OS upgrade images, task sequences and deployment packages.</p><p>It searches for Applications by PackageID as a last resort if no match has been found yet by loading every Application&rsquo;s PackageID property which is a lazy property in WMI. This can be time consuming, depending on how many Applications you have in your site, hence why it is last in the list.</p><h2 id=migrating-a-distribution-point-to-another><strong>Migrating a distribution point to another</strong></h2><p>Do you need to stand up a new distribution point beside an existing one, but don&rsquo;t want to send content across the WAN?</p><p>This requirement was what originally inspired me to write the module. A couple of years ago I came across <a href=http://synack87.blogspot.com/2017/03/distribution-point-migration-tool-kit.html>this post</a> by someone with the handle SYN_ACK_87. The code offered on TechNet helped me hugely at the time for what I needed, but I felt like adding extra bits. I rolled my own and here we are.</p><p>Pull distribution points are undoubtedly a million miles easier than this. If you can, or do currently, use pull distribution points, don&rsquo;t follow this. Configure the new distribution point to pull from the old distribution point.</p><p>However if for whatever reason you can&rsquo;t or don&rsquo;t want to use the pull distribution point method, then this is for you.</p><h3 id=1-begin-by-exporting-your-oldsource-distribution-points-content-using-export-dpcontent>1. Begin by exporting your old/source distribution point&rsquo;s content using <code>Export-DPContent</code>.</h3><p>Preferably this server will be on the same LAN as the distribution point you intend to import the .pkgx files to.</p><p>If the server is remote across a slow link, it is recommended you copy the .pkgx files generated by <code>Export-DPContent</code> to your new/target distribution point.</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#0086b3>PS </span>C:\&gt; <span style=color:#0086b3>Get-DPContent</span> -DistributionPoint <span style=color:#d14>&#34;OldDP.contoso.com&#34;</span> | <span style=color:#0086b3>Export-DPContent</span> -Folder <span style=color:#d14>&#34;E:\exported&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=2-configure-your-newtarget-distribution-point-to-allow-prestaged-content-using-set-dpallowprestagedcontent>2. Configure your new/target distribution point to allow prestaged content using <code>Set-DPAllowPrestagedContent</code>.</h3><p>This will ensure when we use <code>Start-DPContentDistribution</code> in the next step that the content will not inadvertently transfer across an undesired route.</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#0086b3>PS </span>C:\&gt; <span style=color:#0086b3>Set-DPAllowPrestagedContent</span> -DistributionPoint <span style=color:#d14>&#34;NewDP.contoso.com&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=3-distribute-the-exported-content-from-step-1-using-start-dpcontentdistribution-using-its--folder-parameter>3. Distribute the exported content from step 1 using <code>Start-DPContentDistribution</code> using its <code>-Folder</code> parameter.</h3><p>This will walk through all .pkgx files in the given folder, identifying each object by the particular naming convention of the .pkgx files generated by <code>Export-DPContent</code>, and distribute each of the objects they represent in console to your new/target distribution point.</p><p>This will put the content objects in console in a &ldquo;Pending&rdquo; state; waiting to be imported on your new/target distribution point.</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#0086b3>Start-DPContentDistribution</span> -Folder <span style=color:#d14>&#34;E:\exported&#34;</span> -DistributionPoint <span style=color:#d14>&#34;NewDP.contoso.com&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=4-log-on-locally-or-enter-a-powershell-session-to-your-newtarget-distribution-point-and-import-pscmcontentmgmt-to-run-import-dpcontent>4. Log on locally or enter a PowerShell session to your new/target distribution point and import PSCMContentMgmt to run <code>Import-DPContent</code>.</h3><p>This step must be executed locally to your new/target distribution point. This is because <code>Import-DPContent</code> simply invokes ExtractContent.exe.</p><p>Use Import-DPContent and the -Folder parameter (which is preferably a local drive path, or a UNC path where the host is on the same LAN) to begin importing content.</p><p>Similar to step 3, <code>Import-DPContent</code> depends on the particular naming convention of .pkgx files generated by <code>Export-DPContent</code> to successfully import the content.</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#0086b3>PS </span>C:\&gt; <span style=color:#0086b3>Import-DPContent</span> -Folder <span style=color:#d14>&#34;\\OldDP.contoso.com\e$\exported&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=5-unconfigure-your-newtarget-distribution-point-to-only-allow-prestaged-content>5. Unconfigure your new/target distribution point to only allow prestaged content.</h3><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-10-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#0086b3>PS </span>C:\&gt; <span style=color:#0086b3>Set-DPAllowPrestagedContent</span> -DistributionPoint <span style=color:#d14>&#34;NewDP.contoso.com&#34;</span> -State $false
</span></span></code></pre></td></tr></table></div></div><h2 id=getting-help>Getting help</h2><p>If you&rsquo;re seeing or hearing things, I recommend you drink more rum.</p><p>I encourage you to read the documentation on the <a href=https://github.com/codaamok/PSCMContentMgmt>GitHub repository page</a> and the <code>Get-Help</code> material. I wrote several &ldquo;About&rdquo; help topics , filling all functions with examples and detailed descriptions for parameters.</p><p>To view the help material for a particular function:</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-11-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-11-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#0086b3>PS </span>C:\&gt; <span style=color:#0086b3>Get-Help</span> <span style=color:#0086b3>Compare-DPContent</span> -Detailed
</span></span></code></pre></td></tr></table></div></div><p>To see all of the &ldquo;About&rdquo; help topics available for PSCMContentMgmt:</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-12-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#0086b3>PS </span>C:\&gt; <span style=color:#0086b3>Get-Help</span> about_PSCMContentMgmt*
</span></span></code></pre></td></tr></table></div></div><p>To read one of the &ldquo;About&rdquo; help topics:</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-13-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-13-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#0086b3>PS </span>C:\&gt; <span style=color:#0086b3>Get-Help</span> about_PSCMContentMgmt_Query
</span></span></code></pre></td></tr></table></div></div><p>Failing that:</p><ul><li>If you think you&rsquo;re experiencing, or have found, a bug in PSCMContentMgmt, please open an issue on its <a href=https://github.com/codaamok/PSCMContentMgmt>GitHub repository</a>.</li><li>Ping me on Twitter <a href=https://twitter.com/codaamok>@codaamok</a>.</li><li>Come to the <a href=https://winadmins.io/>WinAdmins Discord</a> and bug me there, my handle is @acc.</li></ul><p>The Configuration Manager module notoriously returns generic error messages (if any) for most of its cmdlets/functions. Since this module is mostly nothing more than a wrapper for most cmdlets/functions, I just forward those messages on to you so please bear that in mind.</p><img src=/authors/acc/avatar.png alt="Photo of Adam Cook"><br><strong>Adam Cook</strong>
<em>Admin/Contributor</em><div><a href=https://twitter.com/codaamok><img src=/img/social/twitter.png></a>
<a href=https://www.linkedin.com/in/adamcharlescook><img src=/img/social/linkedin.png></a></div><p>Adam loves technology and helping people, focusing on PowerShell, Azure, ConfigMgr, and Linux.</p><hr></div><div class=post-share><div class="post-share-box share-comments"></div></div><comments id=comments><script src=https://utteranc.es/client.js repo=SysManSquad/sysmansquadblog issue-term=title label="blog comment" theme=github-light crossorigin=anonymous async></script></comments></article></div></div></div><footer id=footer><div class=container><div id=footer-copyright><p class=copyright>&copy; 2023 WinAdmins - https://sysmansquad.com - Systems Management Squad</a></p></div></div></footer></div></body></html>