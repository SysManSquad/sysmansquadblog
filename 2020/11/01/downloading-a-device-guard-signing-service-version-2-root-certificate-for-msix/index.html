<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=keyword content="ConfigMgr Microsoft Intune Windows WinAdmins">
<meta name=viewport content="width=device-width">
<meta name=description content="A community blog and subsidiary of WinAdmins.io">
<link rel="shortcut icon" href=/img/favicon.ico>
<title>Downloading a Device Guard Signing Service version 2 Root Certificate for MSIX-SysManSquad | Systems Management Squad</title>
<link rel=canonical href=/2020/11/01/downloading-a-device-guard-signing-service-version-2-root-certificate-for-msix/>
<link rel=stylesheet href=/css/style.css>
<link rel=stylesheet href=https://blog.sysmansquad.com/css/custom.css>
<script src=https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js></script>
<script src=https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js></script>
<script src=https://blog.sysmansquad.com/js/jquery.slicknav.js></script>
<script src=https://blog.sysmansquad.com/js/asd_SlickNav_Mobile.js></script>
<script src=https://blog.sysmansquad.com/js/custom.js></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XXZR1RSQYX"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-XXZR1RSQYX',{anonymize_ip:!1})}</script>
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://blog.sysmansquad.com/83">
<meta name=twitter:title content="Downloading a Device Guard Signing Service version 2 Root Certificate for MSIX">
<meta name=twitter:description content="Howdy y&rsquo;all
In this post I will show you how to get the Device Guard Signing Service v2 root certificate.
Device Guard Signing Services v1 (DGSS) is being deprecated at the end of December 2020, so we need to migrate to DGSSv2, and it just so happens that the means to download the DGSSv2 root cert is a little bit more complex than the DGSSv1.
MSIX crash course While MSIX is generally marketed as a replacement for MSI for developers, there are scenarios that can benefit systems administrators.">
</head>
<body class="home blog">
<div id=asd-container>
<div id=top-bar>
<div class=container>
<div id=nav-wrapper>
<ul class=menu id=menu-top-menu>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/>Home</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/about/>
<span>About</span>
</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=https://github.com/SysManSquad>
<span>GitHub</span>
</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/jointhesquad/>
<span>Join the Squad</span>
</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/meetthesquad/>
<span>Meet the Squad</span>
</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=#>
<span>MORE></span>
</a>
<ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/contact/>Contact</a>
</li>
</ul>
</li>
</ul>
</div>
<div id=top-search>
<a href=# class=search><i class="fa fa-search"></i></a>
<div class=show-search>
<form role=search method=get action=https://www.google.com/search id=searchform>
<input type=search placeholder="Search and hit enter..." name=q id=q title="Search and hit enter...">
<input type=hidden name=sitesearch value=https://blog.sysmansquad.com>
<button type=submit value=Search>
</form>
</div>
</div>
<div class=menu id=menu-mobile></div>
</div>
</div>
<header id=header class=noslider>
<div class=container>
<div id=logo>
<h1><a href=https://blog.sysmansquad.com><img src=/img/SysManSquad-HorizontalColor-Logo.png alt="Systems Management Squad"></a></h1>
</div>
</div>
</header>
<div class=container>
<div id=content>
<div id=main class=fullwidth>
<article class="post type-post status-publish format-standard has-post-thumbnail hentry">
<div class=post-header>
<h1>Downloading a Device Guard Signing Service version 2 Root Certificate for MSIX</h1>
<p class=p-meta>
<span class=post-date>November 2, 2020 / </span>
<span class=post-categories>Endpoint Management / </span>
</p>
</div>
<div class=post-entry>
<p>Howdy y&rsquo;all<br>
In this post I will show you how to get the Device Guard Signing Service v2 root certificate.</p>
<p>Device Guard Signing Services v1 (DGSS) is being deprecated at the end of December 2020, so we need to migrate to DGSSv2, and it just so happens that the means to download the DGSSv2 root cert is a little bit more complex than the DGSSv1.</p>
<h2 id=msix-crash-course>MSIX crash course</h2>
<p>While MSIX is generally marketed as a replacement for MSI for developers, there are scenarios that can benefit systems administrators.</p>
<ul>
<li>A means to install an app that has no silent installation</li>
<li>Capture installs of apps that require manual setup as part of the post install setup</li>
<li>MSIX apps are easy to uninstall, which is not always possible/reliable for some Win32 apps</li>
<li>MSIX apps are containerized, you can install multiple versions of the same app at the same time, for example: Office 2010 and M365A/O365 running at the same time</li>
<li>MSIX app attach for Windows Virtual Desktops</li>
<li>MSIX apps can be installed per user or provisioned for all users on a device</li>
</ul>
<p>So what does this have to do with certificates?<br>
The MSIX packaging format has a strict signing requirement. While you can always buy a code signing certificate, you can use a free DGSSv2 certificate from Microsoft.</p>
<p>If you want to know how MSIX apps are setup and deployed, check out <a href=https://sysmansquad.com/2020/09/15/signing-and-deploying-applications-via-msix-with-intune/>Jake&rsquo;s blog post on MSIX</a>.</p>
<h2 id=registering-the-azuread-app>Registering the AzureAD app</h2>
<p>First we need to setup an AzureAd Application, <a href=https://docs.microsoft.com/en-us/windows/msix/package/signing-package-device-guard-signing>this is mostly covered in the official docs</a> but it&rsquo;s not very user friendly and when this post was written (31.10.2020), it was missing a crucial step.</p>
<p>For those of you who have done this sort of thing before, here is the quick overview:</p>
<ul>
<li>Sign into AzureAd and start registering an app</li>
<li>Under Redirect URI, select &ldquo;Public client (mobile & desktop)&rdquo;. and set <a href=https://dgss.microsoft.com>https://dgss.microsoft.com</a> as the URI</li>
<li>In the API permissions, select the &ldquo;Windows Store for Business API&rdquo;, Delegated permissions and select <strong>user_impersonation</strong></li>
<li>Go to the overview and copy the Application (client) ID, and head to the <strong>Get-DGSSv2RootCert</strong> part of this post</li>
</ul>
<p>For those of you who have never done this before, here are the detailed steps with screenshots.</p>
<p>Sign into Azure AD and register a new application.</p>
<p><div class=image>
<figure>
<a href=1-app-registration-1024x573.png target=_blank>
<img src=1-app-registration-1024x573.png alt>
</a>
</figure>
</div> </p>
<p>Give it a descriptive name.<br>
Under Redirect URI, select &ldquo;Public client (mobile & desktop)&rdquo;, and set <a href=https://dgss.microsoft.com>https://dgss.microsoft.com</a> as the URI.</p>
<p><div class=image>
<figure>
<a href=2-replyurl.png target=_blank>
<img src=2-replyurl.png alt>
</a>
</figure>
</div> </p>
<p>Once the app has been created, click on <strong>API permissions</strong>.<br>
<strong>Add permissions</strong>.<br>
Click on <strong>APIs my organization uses</strong>.<br>
Search for &ldquo;windows store&rdquo;.<br>
And click on it.</p>
<p><div class=image>
<figure>
<a href=3-api-permissions-1024x342.png target=_blank>
<img src=3-api-permissions-1024x342.png alt>
</a>
</figure>
</div> </p>
<p>Click on <strong>Delegated permissions</strong>.<br>
And select <strong>user_impresonation</strong>.</p>
<p><div class=image>
<figure>
<a href=4-delegate-access.png target=_blank>
<img src=4-delegate-access.png alt>
</a>
</figure>
</div> </p>
<p>Click on <strong>Grant consent for&mldr;</strong> otherwise the app will not work.</p>
<p><div class=image>
<figure>
<a href=5-consent-1024x494.png target=_blank>
<img src=5-consent-1024x494.png alt>
</a>
</figure>
</div> </p>
<p>Now head back to the application overview and copy the GUID that&rsquo;s next to <strong>Application (client) ID</strong>, this is used in a script that is featured in this blog post.</p>
<p><div class=image>
<figure>
<a href=6-appid.png target=_blank>
<img src=6-appid.png alt>
</a>
</figure>
</div> </p>
<h2 id=get-dgssv2rootcert>Get-DGSSv2RootCert</h2>
<p>Since for most people, downloading the root certificate is a one time operation, I elected to run this this in a <a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/windows-sandbox/windows-sandbox-overview>windows sandbox</a>. but that is 100% optional.</p>
<p>Paste the application GUID into the $AppID variable and you should be ready to go.</p>
<div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1><a style=outline:none;text-decoration:none;color:inherit href=#1> 1</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2><a style=outline:none;text-decoration:none;color:inherit href=#2> 2</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3><a style=outline:none;text-decoration:none;color:inherit href=#3> 3</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4><a style=outline:none;text-decoration:none;color:inherit href=#4> 4</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=5><a style=outline:none;text-decoration:none;color:inherit href=#5> 5</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=6><a style=outline:none;text-decoration:none;color:inherit href=#6> 6</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=7><a style=outline:none;text-decoration:none;color:inherit href=#7> 7</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=8><a style=outline:none;text-decoration:none;color:inherit href=#8> 8</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=9><a style=outline:none;text-decoration:none;color:inherit href=#9> 9</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=10><a style=outline:none;text-decoration:none;color:inherit href=#10>10</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=11><a style=outline:none;text-decoration:none;color:inherit href=#11>11</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=12><a style=outline:none;text-decoration:none;color:inherit href=#12>12</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=13><a style=outline:none;text-decoration:none;color:inherit href=#13>13</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=14><a style=outline:none;text-decoration:none;color:inherit href=#14>14</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=15><a style=outline:none;text-decoration:none;color:inherit href=#15>15</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=16><a style=outline:none;text-decoration:none;color:inherit href=#16>16</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=17><a style=outline:none;text-decoration:none;color:inherit href=#17>17</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=18><a style=outline:none;text-decoration:none;color:inherit href=#18>18</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=19><a style=outline:none;text-decoration:none;color:inherit href=#19>19</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=20><a style=outline:none;text-decoration:none;color:inherit href=#20>20</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=21><a style=outline:none;text-decoration:none;color:inherit href=#21>21</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=22><a style=outline:none;text-decoration:none;color:inherit href=#22>22</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=23><a style=outline:none;text-decoration:none;color:inherit href=#23>23</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=24><a style=outline:none;text-decoration:none;color:inherit href=#24>24</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=25><a style=outline:none;text-decoration:none;color:inherit href=#25>25</a>
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=color:#998;font-style:italic># This simple script is used to download the Device Guard Signing Service v2 Root Certificate</span>


<span style=color:#998;font-style:italic># please add your own App ID</span>
<span style=color:teal>$AppID</span> = <span style=color:#d14>&#34;PUT YOUR GUID HERE&#34;</span>



<span style=color:#998;font-style:italic># we need to add nuget as a package source first</span>
<span style=color:#0086b3>Register-PackageSource</span> -Name MyNuGet -Location https<span style=color:#a61717;background-color:#e3d2d2>:</span>//www.nuget.org/api/v2 -ProviderName NuGet -Confirm<span style=color:#a61717;background-color:#e3d2d2>:</span><span style=color:teal>$false</span> -Force

<span style=color:#998;font-style:italic># installing the package</span>
<span style=color:#0086b3>Install-Package</span> Microsoft.Acs.Dgss.Client -Source mynuget -Confirm<span style=color:#a61717;background-color:#e3d2d2>:</span><span style=color:teal>$false</span> -Force -Verbose

<span style=color:#998;font-style:italic># importing the module</span>
<span style=color:#0086b3>Import-Module</span> <span style=color:#d14>&#34;C:\Program Files\PackageManagement\NuGet\Packages\Microsoft.Acs.Dgss.Client.1.0.11\PowerShell\Microsoft.Acs.Dgss.Client.dll&#34;</span>

<span style=color:#998;font-style:italic># just for convenience</span>
<span style=color:#0086b3>New-Item</span> -Path c:\ -Name <span style=color:#d14>&#34;DGCertv2&#34;</span> -ItemType Directory -Force

<span style=color:#998;font-style:italic># downloading the cert to the folder specified above, this step is not instant, ive seen it take a while</span>
<span style=color:#0086b3>Get-RootCertificate</span> -PassThru -OutFile C:\DGCertv2\DGSSv2root.cer -AppId <span style=color:teal>$AppID</span>

<span style=color:#998;font-style:italic># voila! the cert appears before your eyes</span>
<span style=color:#0086b3>start </span>C:\DGCertv2\
</code></pre></td></tr></table>
</div>
</div><p>Congrats, you now have a Device Guard Signing Service v2 Root Certificate in your possession.</p>
<p>Now you can deploy the cert to your clients using your delivery mechanism of choice.</p>
</div>
<comments id=comments>
<script src=https://utteranc.es/client.js repo=SysManSquad/sysmansquadblog issue-term=title label="blog comment" theme=github-light crossorigin=anonymous async></script>
</comments>
</article>
</div>
</div>
</div>
<footer id=footer>
<div class=container>
<div id=footer-copyright>
<p class=copyright>&copy; 2022 WinAdmins - https://blog.sysmansquad.com - Systems Management Squad</a></p>
</div>
</div>
</footer>
</div>
</body>
</html>