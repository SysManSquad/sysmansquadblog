<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=keyword content="ConfigMgr Microsoft Intune Windows WinAdmins"><meta name=viewport content="width=device-width"><meta name=description content="A community blog and subsidiary of WinAdmins.io"><link rel="shortcut icon" href=/img/favicon.ico><title>Teams Channel Notification when OSD Fails-SysManSquad | Systems Management Squad</title><link rel=canonical href=/2020/04/22/teams-channel-notification-when-osd-fails/><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=https://blog.sysmansquad.com/css/custom.css><script src=https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js></script>
<script src=https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js></script>
<script src=https://blog.sysmansquad.com/js/jquery.slicknav.js></script>
<script src=https://blog.sysmansquad.com/js/asd_SlickNav_Mobile.js></script>
<script src=https://blog.sysmansquad.com/js/custom.js></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XXZR1RSQYX"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XXZR1RSQYX",{anonymize_ip:!1})}</script><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.sysmansquad.com/83"><meta name=twitter:title content="Teams Channel Notification when OSD Fails"><meta name=twitter:description content="How would you like this lovely notification appearing within MS Teams every time a build failed? Better than getting a helpdesk ticket or not finding out at all.
Well, now you can!
 Removed broken screenshot - editor
 Step 1 - Configure Teams You need to make sure your O365 Administrator has enabled Incoming webhooks connectors in your O365 Tenant.
 Open Teams. Select a channel, or create a new channel specific for these notifications (This is best practice so normal channels are not spammed) Click the &mldr; Next to the channel name and choose Connectors   Removed broken screenshot - editor"></head><body class="home blog"><div id=asd-container><div id=top-bar><div class=container><div id=nav-wrapper><ul class=menu id=menu-top-menu><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/>Home</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/about/><span>About</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=https://github.com/SysManSquad><span>GitHub</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/jointhesquad/><span>Join the Squad</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/meetthesquad/><span>Meet the Squad</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=#><span>MORE></span></a><ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/contact/>Contact</a></li></ul></li></ul></div><div id=top-search><a href=# class=search><i class="fa fa-search"></i></a><div class=show-search><form role=search method=get action=https://www.google.com/search id=searchform><input type=search placeholder="Search and hit enter..." name=q id=q title="Search and hit enter...">
<input type=hidden name=sitesearch value=https://blog.sysmansquad.com>
<button type=submit value=Search></form></div></div><div class=menu id=menu-mobile></div></div></div><header id=header class=noslider><div class=container><div id=logo><h1><a href=https://blog.sysmansquad.com><img src=/img/SysManSquad-HorizontalColor-Logo.png alt="Systems Management Squad"></a></h1></div></div></header><div class=container><div id=content><div id=main class=fullwidth><article class="post type-post status-publish format-standard has-post-thumbnail hentry"><div class=post-header><h1>Teams Channel Notification when OSD Fails</h1><p class=p-meta><span class=post-author><a href=/authors/grant>Grant Dickins</a> /</span>
<span class=post-date>April 22, 2020</span>
<span class=post-categories>/ Endpoint Management</span>
<span class=post-categories>/ How-To</span>
<span class=post-categories>/ MECM/MEMCM/SCCM</span>
<span class=post-categories>/ Office</span>
<span class=post-categories>/ Powershell</span>
<span class=post-categories>/ Scripting</span></p></div><div class=post-entry><p>How would you like this lovely notification appearing within MS Teams every time a build failed? Better than getting a helpdesk ticket or not finding out at all.</p><p>Well, now you can!</p><blockquote><p><em>Removed broken screenshot - editor</em></p></blockquote><h2 id=step-1>Step 1 - Configure Teams</h2><p><em>You need to make sure your O365 Administrator has enabled Incoming webhooks connectors in your O365 Tenant.</em></p><ul><li>Open Teams.</li><li>Select a channel, or create a new channel specific for these notifications (This is best practice so normal channels are not spammed)</li><li>Click the <strong>&mldr;</strong> Next to the channel name and choose Connectors</li></ul><blockquote><p><em>Removed broken screenshot - editor</em></p></blockquote><ul><li>Click Add / Configure</li></ul><blockquote><p><em>Removed broken screenshot - editor</em></p></blockquote><ul><li>Give your Connector an appropriate name and custom image.</li></ul><blockquote><p><em>Removed broken screenshot - editor</em></p></blockquote><ul><li>It will then generate a unique API code for you to use later. Copy this URI and keep it safe!</li></ul><blockquote><p><em>Removed broken screenshot - editor</em></p></blockquote><h2 id=step-2>Step 2 - PowerShell Script</h2><p>I have modified the PowerShell script created by Terence Beggs from <a href=https://www.scconfigmgr.com/2017/10/06/configmgr-osd-notification-service-teams/>https://www.scconfigmgr.com/2017/10/06/configmgr-osd-notification-service-teams/</a></p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-1>  1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-2>  2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-3>  3</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-4>  4</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-5>  5</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-6>  6</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-7>  7</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-8>  8</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-9>  9</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-10> 10</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-11> 11</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-12> 12</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-13> 13</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-14> 14</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-15> 15</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-16> 16</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-17> 17</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-18> 18</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-19> 19</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-20> 20</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-21> 21</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-22> 22</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-23> 23</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-24> 24</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-25> 25</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-26> 26</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-27> 27</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-28> 28</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-29> 29</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-30> 30</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-31> 31</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-32> 32</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-33> 33</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-34> 34</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-35> 35</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-36> 36</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-37> 37</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-38> 38</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-39> 39</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-40><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-40> 40</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-41><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-41> 41</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-42><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-42> 42</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-43><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-43> 43</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-44><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-44> 44</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-45><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-45> 45</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-46><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-46> 46</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-47><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-47> 47</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-48><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-48> 48</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-49><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-49> 49</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-50><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-50> 50</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-51><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-51> 51</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-52><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-52> 52</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-53><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-53> 53</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-54><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-54> 54</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-55><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-55> 55</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-56><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-56> 56</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-57><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-57> 57</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-58><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-58> 58</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-59><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-59> 59</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-60><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-60> 60</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-61><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-61> 61</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-62><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-62> 62</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-63><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-63> 63</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-64><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-64> 64</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-65><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-65> 65</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-66><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-66> 66</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-67><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-67> 67</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-68><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-68> 68</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-69><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-69> 69</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-70><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-70> 70</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-71><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-71> 71</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-72><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-72> 72</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-73><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-73> 73</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-74><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-74> 74</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-75><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-75> 75</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-76><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-76> 76</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-77><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-77> 77</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-78><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-78> 78</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-79><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-79> 79</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-80><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-80> 80</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-81><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-81> 81</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-82><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-82> 82</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-83><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-83> 83</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-84><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-84> 84</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-85><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-85> 85</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-86><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-86> 86</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-87><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-87> 87</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-88><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-88> 88</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-89><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-89> 89</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-90><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-90> 90</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-91><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-91> 91</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-92><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-92> 92</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-93><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-93> 93</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-94><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-94> 94</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-95><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-95> 95</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-96><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-96> 96</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-97><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-97> 97</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-98><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-98> 98</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-99><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-99> 99</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-100><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-100>100</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-101><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-101>101</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-102><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-102>102</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-103><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-103>103</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-104><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-104>104</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-105><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-105>105</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#998;font-style:italic>#
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic>    </span><span style=color:#d14>.NOTES</span>
</span></span><span style=display:flex><span>    ==================================================================
</span></span><span style=display:flex><span>    Originally Created by<span style=color:#a61717;background-color:#e3d2d2>:</span>     Terence Beggs (https<span style=color:#a61717;background-color:#e3d2d2>:</span>//www.scconfigmgr.com)
</span></span><span style=display:flex><span>    Modified by<span style=color:#a61717;background-color:#e3d2d2>:</span>    Grant Dickins
</span></span><span style=display:flex><span>    ==================================================================
</span></span><span style=display:flex><span>    .DESCRIPTION
</span></span><span style=display:flex><span>    This script uses Microsoft Teams to notify when a OSD task sequence has failed.
</span></span><span style=display:flex><span>    .REFERENCE
</span></span><span style=display:flex><span>    https<span style=color:#a61717;background-color:#e3d2d2>:</span>//docs.microsoft.com/outlook/<span style=color:#0086b3>actionable-messages</span>/<span style=color:#0086b3>message-card</span>-reference
</span></span><span style=display:flex><span>    https<span style=color:#a61717;background-color:#e3d2d2>:</span>//www.scconfigmgr.com/2017/10/06/<span style=color:#0086b3>configmgr-osd</span>-notification-service-teams/
</span></span><span style=display:flex><span>    https<span style=color:#a61717;background-color:#e3d2d2>:</span>//messagecardplayground.azurewebsites.net/
</span></span><span style=display:flex><span>    ==================================================================
</span></span><span style=display:flex><span>    .TODO
</span></span><span style=display:flex><span>    - Add Error codes to MessageCard
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic>#&gt;</span>
</span></span><span style=display:flex><span><span style=color:teal>$uri</span> = <span style=color:#d14>&#39;INSERT URI HERE&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># Open TSEnv for use.</span>
</span></span><span style=display:flex><span><span style=color:teal>$TSenv</span> = <span style=color:#0086b3>New-Object</span> -COMObject Microsoft.SMS.TSEnvironment -ErrorAction SilentlyContinue
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># Date and Time</span>
</span></span><span style=display:flex><span><span style=color:teal>$DateTime</span> = <span style=color:#0086b3>Get-Date</span> -Format <span style=color:#d14>&#34;dddd dd/MM/yyyy HH:mm&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># Computer Make</span>
</span></span><span style=display:flex><span><span style=color:teal>$Make</span> = (<span style=color:#0086b3>Get-WmiObject</span> -Class Win32_BIOS).Manufacturer
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># Computer Model</span>
</span></span><span style=display:flex><span><span style=color:teal>$Model</span> = (<span style=color:#0086b3>Get-WmiObject</span> -Class Win32_ComputerSystem).Model
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># Computer Name</span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic>#DEBUG# $Name = (Get-WmiObject -Class Win32_ComputerSystem).Name</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>if</span> (<span style=color:teal>$TSenv</span>.Value(<span style=color:#d14>&#34;_SMSTSPackageName&#34;</span>) <span style=color:#000;font-weight:700>-ne</span> <span style=color:#d14>&#34;&#34;</span>) { <span style=color:teal>$Name</span> = <span style=color:teal>$TSenv</span>.value(<span style=color:#d14>&#34;OSDComputerName&#34;</span>) } <span style=color:#000;font-weight:700>else</span> { <span style=color:teal>$Name</span> = (<span style=color:#0086b3>Get-WmiObject</span> -Class Win32_ComputerSystem).Name }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># Computer Serial Number</span>
</span></span><span style=display:flex><span><span style=color:teal>[string]</span><span style=color:teal>$SerialNumber</span> = (<span style=color:#0086b3>Get-WmiObject</span> win32_bios).SerialNumber
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># IP Address of the Computer</span>
</span></span><span style=display:flex><span><span style=color:teal>$IPAddress</span> = (<span style=color:#0086b3>Get-WmiObject</span> win32_Networkadapterconfiguration | <span style=color:#0086b3>Where-Object</span> { <span style=color:teal>$_</span>.ipaddress <span style=color:#000;font-weight:700>-notlike</span> <span style=color:teal>$null</span> }).IPaddress | <span style=color:#0086b3>Select-Object</span> -First 1
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic>#$TS Name</span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic>#DEBUG# $TSName = &#34;TSName&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>if</span> (<span style=color:teal>$TSenv</span>.Value(<span style=color:#d14>&#34;_SMSTSPackageName&#34;</span>) <span style=color:#000;font-weight:700>-ne</span> <span style=color:#d14>&#34;&#34;</span>) { <span style=color:teal>$TSName</span> = <span style=color:teal>$TSenv</span>.value(<span style=color:#d14>&#34;_SMSTSPackageName&#34;</span>) } <span style=color:#000;font-weight:700>else</span> { <span style=color:teal>$TSName</span> = <span style=color:#d14>&#34;Unknown Task Sequence&#34;</span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic>#Error Code</span>
</span></span><span style=display:flex><span><span style=color:teal>$TSLastError</span> = (<span style=color:teal>$TSenv</span>.Value(<span style=color:#d14>&#34;ErrorReturnCode&#34;</span>))
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>If</span>(<span style=color:teal>[string]</span>::IsNullOrEmpty(<span style=color:teal>$TSLastError</span>)){<span style=color:teal>$TSLastError</span> = <span style=color:#d14>&#34;Unknown Error. Check Logs.&#34;</span>}
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># JSON for the Teams MessageCard (LEGACY)</span>
</span></span><span style=display:flex><span><span style=color:teal>$body</span> = <span style=color:#d14>@&#34;
</span></span></span><span style=display:flex><span><span style=color:#d14>    {
</span></span></span><span style=display:flex><span><span style=color:#d14>        &#34;@type&#34;: &#34;MessageCard&#34;,
</span></span></span><span style=display:flex><span><span style=color:#d14>        &#34;@context&#34;: &#34;https://schema.org/extensions&#34;,
</span></span></span><span style=display:flex><span><span style=color:#d14>        &#34;summary&#34;: &#34;OSD Failure Card&#34;,
</span></span></span><span style=display:flex><span><span style=color:#d14>        &#34;themeColor&#34;: &#34;0078D7&#34;,
</span></span></span><span style=display:flex><span><span style=color:#d14>        &#34;title&#34;: &#34;$Name Failed to build&#34;,
</span></span></span><span style=display:flex><span><span style=color:#d14>        &#34;text&#34;: &#34;&#34;,
</span></span></span><span style=display:flex><span><span style=color:#d14>        &#34;sections&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#d14>            {
</span></span></span><span style=display:flex><span><span style=color:#d14>                &#34;activityTitle&#34;: &#34;Task Sequence&#34;,
</span></span></span><span style=display:flex><span><span style=color:#d14>                &#34;activitySubtitle&#34;: &#34;$TSName&#34;,
</span></span></span><span style=display:flex><span><span style=color:#d14>                &#34;activityImage&#34;: &#34;https://media.giphy.com/media/27EhcDHnlkw1O/giphy.gif&#34;
</span></span></span><span style=display:flex><span><span style=color:#d14>            },
</span></span></span><span style=display:flex><span><span style=color:#d14>            {
</span></span></span><span style=display:flex><span><span style=color:#d14>                &#34;title&#34;: &#34;## Deployment Details&#34;,
</span></span></span><span style=display:flex><span><span style=color:#d14>                &#34;facts&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#d14>                    {
</span></span></span><span style=display:flex><span><span style=color:#d14>                        &#34;name&#34;: &#34;Name:&#34;,
</span></span></span><span style=display:flex><span><span style=color:#d14>                        &#34;value&#34;: &#34;$Name&#34;
</span></span></span><span style=display:flex><span><span style=color:#d14>                    },
</span></span></span><span style=display:flex><span><span style=color:#d14>                    {
</span></span></span><span style=display:flex><span><span style=color:#d14>                        &#34;name&#34;: &#34;Date Time:&#34;,
</span></span></span><span style=display:flex><span><span style=color:#d14>                        &#34;value&#34;: &#34;$DateTime&#34;
</span></span></span><span style=display:flex><span><span style=color:#d14>                    },
</span></span></span><span style=display:flex><span><span style=color:#d14>                    {
</span></span></span><span style=display:flex><span><span style=color:#d14>                        &#34;name&#34;: &#34;IP Number:&#34;,
</span></span></span><span style=display:flex><span><span style=color:#d14>                        &#34;value&#34;: &#34;$IPAddress&#34;
</span></span></span><span style=display:flex><span><span style=color:#d14>                    },
</span></span></span><span style=display:flex><span><span style=color:#d14>                    {
</span></span></span><span style=display:flex><span><span style=color:#d14>                        &#34;name&#34;: &#34;Make:&#34;,
</span></span></span><span style=display:flex><span><span style=color:#d14>                        &#34;value&#34;: &#34;$Make&#34;
</span></span></span><span style=display:flex><span><span style=color:#d14>                    },
</span></span></span><span style=display:flex><span><span style=color:#d14>                    {
</span></span></span><span style=display:flex><span><span style=color:#d14>                        &#34;name&#34;: &#34;Model:&#34;,
</span></span></span><span style=display:flex><span><span style=color:#d14>                        &#34;value&#34;: &#34;$Model&#34;
</span></span></span><span style=display:flex><span><span style=color:#d14>                    },
</span></span></span><span style=display:flex><span><span style=color:#d14>                    {
</span></span></span><span style=display:flex><span><span style=color:#d14>                        &#34;name&#34;: &#34;Serial:&#34;,
</span></span></span><span style=display:flex><span><span style=color:#d14>                        &#34;value&#34;: &#34;$SerialNumber&#34;
</span></span></span><span style=display:flex><span><span style=color:#d14>                    },
</span></span></span><span style=display:flex><span><span style=color:#d14>                    {
</span></span></span><span style=display:flex><span><span style=color:#d14>                        &#34;name&#34;: &#34;Last Error&#34;,
</span></span></span><span style=display:flex><span><span style=color:#d14>                        &#34;value&#34;: &#34;$TSLastError&#34;
</span></span></span><span style=display:flex><span><span style=color:#d14>                    }
</span></span></span><span style=display:flex><span><span style=color:#d14>                ]
</span></span></span><span style=display:flex><span><span style=color:#d14>            },
</span></span></span><span style=display:flex><span><span style=color:#d14>            {
</span></span></span><span style=display:flex><span><span style=color:#d14>                &#34;title&#34;: &#34;## Log Location&#34;,
</span></span></span><span style=display:flex><span><span style=color:#d14>                &#34;text&#34;: &#34;\\\\\\SERVER\\Logs\\OSD\\&#34;
</span></span></span><span style=display:flex><span><span style=color:#d14>            }
</span></span></span><span style=display:flex><span><span style=color:#d14>        ]
</span></span></span><span style=display:flex><span><span style=color:#d14>    }
</span></span></span><span style=display:flex><span><span style=color:#d14>&#34;@</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#0086b3>Invoke-RestMethod</span> -uri <span style=color:teal>$uri</span> -Method Post -body <span style=color:teal>$body</span> -ContentType <span style=color:#d14>&#39;application/json&#39;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=customizing-the-messagecard>Customizing the MessageCard</h3><p>If you want to change the JSON, there is a reference guide here: <a href=https://docs.microsoft.com/en-us/outlook/actionable-messages/message-card-reference>https://docs.microsoft.com/en-us/outlook/actionable-messages/message-card-reference</a></p><p>And a Playground site: <a href=https://messagecardplayground.azurewebsites.net/>https://messagecardplayground.azurewebsites.net/</a></p><p>This modification of the PowerShell script means you can just copy/paste the JSON as long as it&rsquo;s wrapped inside $body = @" &mldr; &ldquo;@</p><p><strong>NB: Incoming Webconnectors only support the Legacy MessageCard format at this time.</strong></p><h2 id=step-3>Step 3 - Create Package for Script</h2><ul><li>Copy the PowerShell script to your Config Manager package source share.</li><li>In Config Manager Console, create a new Package.</li><li>Give it a <strong>Name</strong>, <strong>Description</strong>, and specify the <strong>source share</strong></li></ul><blockquote><p><em>Removed broken screenshot - editor</em></p></blockquote><ul><li>Select <strong>Do not create a program</strong></li></ul><blockquote><p><em>Removed broken screenshot - editor</em></p></blockquote><ul><li>Complete the wizard.</li><li>Distribute the Package contents.</li></ul><h2 id=step-4>Step 4 - Task Sequence</h2><p>Edit the task sequence for OSD.</p><p>Our TS is set up with logic and a section to run if the task sequence encounters an error. This is where we will put the OSD Failure notification script.</p><p><em>For more information on how to set up Error Handling in OSD Task Sequence, see <a href=https://ccmexec.com/author/jonil/>JÃ¶rgen Nilsson&rsquo;s</a> post about it here: <a href=https://ccmexec.com/2016/12/error-handling-in-ts-without-mdt-using-osdbackground/>https://ccmexec.com/2016/12/error-handling-in-ts-without-mdt-using-osdbackground/</a></em></p><blockquote><p><em>Removed broken screenshot - editor</em></p></blockquote><ul><li>After the Gather step, we want to add a Run PowerShell Script task.</li><li>Select the package with our Script.</li><li>Change the PowerShell execution policy to Bypass</li></ul><blockquote><p><em>Removed broken screenshot - editor</em></p></blockquote><ul><li>Click OK and that&rsquo;s it set up!</li></ul><p>If you want to try emulating a failure, create a <strong>Run Command Line</strong> task somewhere in your Task Sequence that runs the following:</p><p>cmd /c exit 8008135</p><blockquote><p><em>Removed broken screenshot - editor</em></p></blockquote><p>So now, if your task sequence runs into an error, you will now get a lovely message straight into your Teams channel:</p><blockquote><p><em>Removed broken screenshot - editor</em></p></blockquote><img src=/authors/grant/avatar.png alt="Photo of Grant Dickins"><br><strong>Grant Dickins</strong>
<em>Contributor</em><div><a href=https://twitter.com/_G_rant><img src=/img/social/twitter.png></a></div><p>Grant has worked supporting IT in the Oil & Gas industry for 10 years, has a keen interest in Config Manager and trying to bring the industry kicking and screaming into the modern cloud-based world.</p><hr></div><div class=post-share><div class="post-share-box share-comments">hello</div></div><comments id=comments><script src=https://utteranc.es/client.js repo=SysManSquad/sysmansquadblog issue-term=title label="blog comment" theme=github-light crossorigin=anonymous async></script></comments></article></div></div></div><footer id=footer><div class=container><div id=footer-copyright><p class=copyright>&copy; 2022 WinAdmins - https://blog.sysmansquad.com - Systems Management Squad</a></p></div></div></footer></div></body></html>