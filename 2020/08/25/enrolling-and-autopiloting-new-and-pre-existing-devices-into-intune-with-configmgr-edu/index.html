<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=keyword content="ConfigMgr Microsoft Intune Windows WinAdmins"><meta name=viewport content="width=device-width"><meta name=description content="A community blog and subsidiary of WinAdmins.io"><link rel="shortcut icon" href=/img/favicon.ico><title>Enrolling and Autopiloting New and Pre-existing Devices into Intune with ConfigMgr – EDU-SysManSquad | Systems Management Squad</title><link rel=canonical href=/2020/08/25/enrolling-and-autopiloting-new-and-pre-existing-devices-into-intune-with-configmgr-edu/><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=https://sysmansquad.com/css/custom.css><script src=https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js></script>
<script src=https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js></script>
<script src=https://sysmansquad.com/js/jquery.slicknav.js></script>
<script src=https://sysmansquad.com/js/asd_SlickNav_Mobile.js></script>
<script src=https://sysmansquad.com/js/custom.js></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XXZR1RSQYX"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XXZR1RSQYX",{anonymize_ip:!1})}</script><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://sysmansquad.com/83"><meta name=twitter:title content="Enrolling and Autopiloting New and Pre-existing Devices into Intune with ConfigMgr – EDU"><meta name=twitter:description content="Months after we issued students and faculty 600+ unmanaged off the shelf laptops (no AD, no Azure AD, no Intune, no ConfigMgr) to get them off and running temporarily during this pandemic, my co-worker and I were tasked with figuring out how to bring these machines under some form of management. We did not have these machines in ConfigMgr or have the hardware hashes uploaded into Intune, so we had some work ahead of us."></head><body class="home blog"><div id=asd-container><div id=top-bar><div class=container><div id=nav-wrapper><ul class=menu id=menu-top-menu><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/>Home</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/about/><span>About</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=https://github.com/SysManSquad><span>GitHub</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/jointhesquad/><span>Join the Squad</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/meetthesquad/><span>Meet the Squad</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=#><span>MORE></span></a><ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/contact/>Contact</a></li></ul></li></ul></div><div id=top-search><a href=# class=search><i class="fa fa-search"></i></a><div class=show-search><form role=search method=get action=https://www.google.com/search id=searchform><input type=search placeholder="Search and hit enter..." name=q id=q title="Search and hit enter...">
<input type=hidden name=sitesearch value=https://sysmansquad.com>
<button type=submit value=Search></form></div></div><div class=menu id=menu-mobile></div></div></div><header id=header class=noslider><div class=container><div id=logo><h1><a href=https://sysmansquad.com><img src=/img/SysManSquad-HorizontalColor-Logo.png alt="Systems Management Squad"></a></h1></div></div></header><div class=container><div id=content><div id=main class=fullwidth><article class="post type-post status-publish format-standard has-post-thumbnail hentry"><div class=post-header><h1>Enrolling and Autopiloting New and Pre-existing Devices into Intune with ConfigMgr – EDU</h1><p class=p-meta><span class=post-author><a href=/authors/andrew>Andrew Arsenault</a> /</span>
<span class=post-date>August 25, 2020</span>
<span class=post-categories>/ Endpoint Management</span></p></div><div class=post-entry><p>Months after we issued students and faculty 600+ unmanaged off the shelf laptops (no AD, no Azure AD, no Intune, no ConfigMgr) to get them off and running temporarily during this pandemic, my co-worker and I were tasked with figuring out how to bring these machines under some form of management. We did not have these machines in ConfigMgr or have the hardware hashes uploaded into Intune, so we had some work ahead of us. Ultimately, we decided to re-image the devices using a ConfigMgr task sequence which also enrolls them into Autopilot. This allows us to remotely manage the device and wipe it after being used by a student.</p><p>I created a ConfigMgr PXE task sequence that with minimal intervention, will &ldquo;reimage&rdquo; the device to whatever version of Win 10 you choose (we use 1909 for now). It copies the AutopilotConfigurationFile.JSON and then resets the machine, ultimately bringing you to a login screen where any user with permissions can provision the device. The device will then bring down any policies and convert to Autopilot and you are off and running with an Intune managed device. Let&rsquo;s walk through the steps!</p><p><strong>Disclaimer:</strong> This blog assumes you have a working knowledge of ConfigMgr and Endpoint Manager Admin Center (MEMAC), and have administrative rights to your Intune Tenant.</p><p>First off we will prepare the Autopilot Profile and download the config JSON</p><p>In MEMAC, navigate to the &ldquo;Windows Autopilot deployment profiles&rdquo; blade, and create a new Autopilot profile, call this whatever you want. The only basic setting we are worried about is the &ldquo;Convert all targeted devices to Autopilot&rdquo;, set this to Yes. Next we will set the OOBE settings to the following (Note: the &ldquo;Enter a name&rdquo; option can be whatever you want to name your devices, this is important as we will use this to target the Autopilot profile post image):</p><p><div class=image><figure><a href=image.png target=_blank><img src=image.png alt=screenshot></a></figure></div></p><p>For now we will not assign this to a group, this comes later.</p><p>Next we are going to pull down this config into a file called AutopilotConfigurationFile.JSON. In powershell run the following commands:</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-1>1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-2>2</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#0086b3>Install-Module</span> WindowsAutopilotIntune -Force
</span></span><span style=display:flex><span><span style=color:#0086b3>Connect-MSGraph</span>
</span></span></code></pre></td></tr></table></div></div><p>Sign into your tenant here and back in powershell run the following command:</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#0086b3>Get-AutopilotProfile</span> | <span style=color:#0086b3>ConvertTo-AutopilotConfigurationJSON</span> | <span style=color:#0086b3>Out-File</span> c:\Autopilot\AutopilotConfigurationFile.json -Encoding ASCII
</span></span></code></pre></td></tr></table></div></div><p>Save this file in a folder by itself on a share somewhere that ConfigMgr has access to.</p><p>Next we head into ConfigMgr and create a new package, this package can have any name, but make sure you check the box &ldquo;This package contains source files&rdquo; and point it to the folder that houses your config file. On the following page, select &ldquo;Do not create a program&rdquo;. Distribute this package to any DP&rsquo;s you will use.</p><p>Now, create a new task sequence and select the option for &ldquo;Deploy Windows Autopilot for Existing Devices&rdquo;. The rest of these options can be default, just select your Windows image you want to use and on the Prepare System for Windows Autopilot screen, select the package that you just created that contains your JSON.</p><p>Once the TS is created it should look something like this:</p><p><div class=image><figure><a href=image-1.png target=_blank><img src=image-1.png alt=screenshot></a></figure></div></p><p>We are going to make some small changes to this task sequence, when completed, it should look like this:</p><p><div class=image><figure><a href=image-3.png target=_blank><img src=image-3.png alt=screenshot></a></figure></div>The final reboot step reboots to the currently installed operation system</p><p>The step we added &ldquo;Autopilot for existing devices config file&rdquo; is a &ldquo;Run Command Line&rdquo; and will copy the config JSON from the package we created earlier and place it in the C:\Windows\Provisioning\Autopilot\ folder. It should look something like this:</p><p><div class=image><figure><a href=image-9.png target=_blank><img src=image-9.png alt=screenshot></a></figure></div></p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>cmd.exe /c xcopy AutopilotConfigurationFile.json %OSDTargetSystemDrive%\windows\provisioning\Autopilot\ /c
</span></span></code></pre></td></tr></table></div></div><p>Distribute this content to your DP.</p><p>At this point lets head back to MEMAC and create our dynamic device security group that we will be targeting with our AP profile. The dynamic membership rules will be as follows (This is based on my computer naming convention that is in the Autopilot Profile)</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>  (device.displayName -startsWith <span style=color:#d14>&#34;LLP&#34;</span>)
</span></span></code></pre></td></tr></table></div></div><p>Once this group is created, navigate to the Deployment Profiles blade that we linked at the beginning of the blog, select your AP profile and under properties, edit the assignments and assign the profile to the newly created dynamic group.</p><p>Congrats! Most of the setup is complete at this point, we only have to deploy the new Task Sequence and run it! Back in ConfigMgr deploy your Provisioning TS to &ldquo;All Unknown Computers&rdquo; or to a collection if you want to convert already managed machines (there is an easier way to do this that I may blog about later) and PXE boot your device, run the task sequence! After some time (usually 20 min or so) you should be presented with the following screen:</p><p><div class=image><figure><a href=image-4-1024x767.png target=_blank><img src=image-4-1024x767.png alt=screenshot></a></figure></div>Choose any options for all of these screens as they will be handled by AutoPilot going forward</p><p>After selecting your defaults, the final screen you should see is your Org login screen.</p><p><div class=image><figure><a href=ap-1024x773.jpg target=_blank><img src=ap-1024x773.jpg alt=screenshot></a></figure></div></p><p>After another couple of minutes of setup, the provisioning process begins! At this point it will apply any settings that were configured as a part of that Autopilot Profile we set up earlier.</p><p>If you check MEMAC at this stage you should see your newly created device but it won&rsquo;t be named properly yet, and is missing some info.</p><p><div class=image><figure><a href=image-5-1024x29.png target=_blank><img src=image-5-1024x29.png alt=screenshot></a></figure></div></p><p>At this point the machine still isn&rsquo;t completely converted, that comes a little later, for now, let the device provision and send you to your desktop.</p><p>Once we are at the desktop, take a look in MEMAC, TA-DA!</p><p><div class=image><figure><a href=image-7-1024x24.png target=_blank><img src=image-7-1024x24.png alt=screenshot></a></figure></div></p><p>The new device is named according to our AP config file, and is now managed by Intune. If we check the Autopiloted Devices blade we see the following:</p><p><div class=image><figure><a href=complete-1.png target=_blank><img src=complete-1.png alt=screenshot></a></figure></div></p><p>Your device is now Autopiloted and managed by Intune! You can now reset this device and it will come up with the settings configured in the AP Config JSON.</p><img src=/authors/andrew/avatar.png alt="Photo of Andrew Arsenault"><br><strong>Andrew Arsenault</strong>
<em>Contributor</em><div><a href=https://twitter.com/aarsenault1984><img src=/img/social/twitter.png></a></div><p>Andrew is an endpoint engineer based out of Canada bringing some education sector experience to the blog.</p><hr></div><comments id=comments><script src=https://utteranc.es/client.js repo=SysManSquad/sysmansquadblog issue-term=title label="blog comment" theme=github-light crossorigin=anonymous async></script></comments></article></div></div></div><footer id=footer><div class=container><div id=footer-copyright><p class=copyright>&copy; 2022 WinAdmins - https://sysmansquad.com - Systems Management Squad</a></p></div></div></footer></div></body></html>