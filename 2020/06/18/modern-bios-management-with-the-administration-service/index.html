<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=keyword content="ConfigMgr Microsoft Intune Windows WinAdmins">
<meta name=viewport content="width=device-width">
<meta name=description content="A community blog and subsidiary of WinAdmins.io">
<link rel="shortcut icon" href=/img/favicon.ico>
<title>Modern BIOS Management with the Administration Service-SysManSquad | Systems Management Squad</title>
<link rel=canonical href=/2020/06/18/modern-bios-management-with-the-administration-service/>
<link rel=stylesheet href=/css/style.css>
<link rel=stylesheet href=https://blog.sysmansquad.com/css/custom.css>
<script src=https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js></script>
<script src=https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js></script>
<script src=https://blog.sysmansquad.com/js/jquery.slicknav.js></script>
<script src=https://blog.sysmansquad.com/js/asd_SlickNav_Mobile.js></script>
<script src=https://blog.sysmansquad.com/js/custom.js></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XXZR1RSQYX"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-XXZR1RSQYX',{anonymize_ip:!1})}</script>
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://blog.sysmansquad.com/83">
<meta name=twitter:title content="Modern BIOS Management with the Administration Service">
<meta name=twitter:description content="2021-04-27 update: The solution now works over CMG. Please see this post for details.
If you haven&rsquo;t seen my first blog post about modern driver management, the quick summary is that the solution uses packages created with the [Driver Automation Tool][2] and the administration service to retrieve information on these packages and identify the most suitable driver package to apply in a task sequence.
In this second part, I&rsquo;ll be discussing the changes and improvements done to the existing solution to also dynamically retrieve and filter and apply BIOS updates.">
</head>
<body class="home blog">
<div id=asd-container>
<div id=top-bar>
<div class=container>
<div id=nav-wrapper>
<ul class=menu id=menu-top-menu>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/>Home</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/about/>
<span>About</span>
</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=https://github.com/SysManSquad>
<span>GitHub</span>
</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/jointhesquad/>
<span>Join the Squad</span>
</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/meetthesquad/>
<span>Meet the Squad</span>
</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=#>
<span>MORE></span>
</a>
<ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/contact/>Contact</a>
</li>
</ul>
</li>
</ul>
</div>
<div id=top-search>
<a href=# class=search><i class="fa fa-search"></i></a>
<div class=show-search>
<form role=search method=get action=https://www.google.com/search id=searchform>
<input type=search placeholder="Search and hit enter..." name=q id=q title="Search and hit enter...">
<input type=hidden name=sitesearch value=https://blog.sysmansquad.com>
<button type=submit value=Search>
</form>
</div>
</div>
<div class=menu id=menu-mobile></div>
</div>
</div>
<header id=header class=noslider>
<div class=container>
<div id=logo>
<h1><a href=https://blog.sysmansquad.com><img src=/img/SysManSquad-HorizontalColor-Logo.png alt="Systems Management Squad"></a></h1>
</div>
</div>
</header>
<div class=container>
<div id=content>
<div id=main class=fullwidth>
<article class="post type-post status-publish format-standard has-post-thumbnail hentry">
<div class=post-header>
<h1>Modern BIOS Management with the Administration Service</h1>
<p class=p-meta>
<span class=post-date>June 18, 2020 / </span>
<span class=post-categories>Endpoint Management / </span>
</p>
</div>
<div class=post-entry>
<p><strong>2021-04-27 update: The solution now works over CMG. Please see this <a href=https://sysmansquad.com/2021/04/27/updated-modern-driver-bios-management-with-cmg-support/>post</a> for details.</strong></p>
<p>If you haven&rsquo;t seen my first blog post about <a href=https://www.sysmansquad.com/2020/05/15/modern-driver-management-with-the-administration-service/>modern driver management</a>, the quick summary is that the solution uses packages created with the [Driver Automation Tool][2] and the <a href=https://docs.microsoft.com/en-us/mem/configmgr/develop/adminservice/overview>administration service</a> to retrieve information on these packages and identify the most suitable driver package to apply in a task sequence.</p>
<p>In this second part, I&rsquo;ll be discussing the changes and improvements done to the existing solution to also dynamically retrieve and filter and apply BIOS updates.</p>
<p>Note: Download link for the task sequence exports is located at the end of the blog post.</p>
<h3 id=invoke-getpackageidfromadminservice-improvements>Invoke-GetPackageIDFromAdminService improvements</h3>
<p>When I initially wrote the script that queries the AdminService, I wanted to make sure I could reuse the same script to return both BIOS and Driver packages. But when it was time to actually design the task sequence for applying BIOS packages, I found out that I forgot something to determine the system&rsquo;s current BIOS version and filter out any BIOS packages which were not an upgrade to the current system.</p>
<h4 id=new-parameters-for-bios-information>New parameters for BIOS information</h4>
<p>I needed to provide more information to the script as a parameter regarding the system BIOS. The 2 following parameters were added to the script:</p>
<ul>
<li>CurrentBIOSVersion</li>
<li>CurrentBIOSReleaseDate</li>
</ul>
<p><strong><em>Why do you need the release date of the BIOS?</em></strong><br>
Good question! The original solution by the Nickolaj Andersen and Maurice Daly of <a href=https://msendpointmgr.com/modern-bios-management/>MSEndPointMgr</a> uses the BIOS release date for Lenovo systems to determine if the BIOS package is an update or not. Now why exactly? I&rsquo;m guessing Lenovo was not very good at keeping some sort of standard naming or versioning for their BIOS versions.</p>
<p><div class=image>
<figure>
<a href=image-2-1024x584.png target=_blank>
<img src=image-2-1024x584.png alt>
</a>
</figure>
</div> Example of a Lenovo BIOS package created with the Driver Automation Tool</p>
<h4 id=bios-filtering>BIOS filtering</h4>
<p>Now that we have the current BIOS version and release date, we need to evaluate and filter out older BIOS package versions. We only want the script to return a package ID if the package is actually an upgrade for the device.</p>
<p>For this part, I had to dig into the <a href=https://github.com/MSEndpointMgr/ConfigMgr/blob/master/Operating%20System%20Deployment/BIOS/Invoke-CMDownloadBIOSPackage.ps1>Invoke-CMDownloadBIOSPackage.ps1</a> script and in the script of the <a href=https://github.com/maurice-daly/DriverAutomationTool/blob/master/Content/DriverAutomationTool.ps1>Driver Automation Tool</a> to see how they were filtering and extracting version information for the different vendors. I ended up with the following code to compare BIOS versions.</p>
<div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1><a style=outline:none;text-decoration:none;color:inherit href=#1> 1</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2><a style=outline:none;text-decoration:none;color:inherit href=#2> 2</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3><a style=outline:none;text-decoration:none;color:inherit href=#3> 3</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4><a style=outline:none;text-decoration:none;color:inherit href=#4> 4</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=5><a style=outline:none;text-decoration:none;color:inherit href=#5> 5</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=6><a style=outline:none;text-decoration:none;color:inherit href=#6> 6</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=7><a style=outline:none;text-decoration:none;color:inherit href=#7> 7</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=8><a style=outline:none;text-decoration:none;color:inherit href=#8> 8</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=9><a style=outline:none;text-decoration:none;color:inherit href=#9> 9</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=10><a style=outline:none;text-decoration:none;color:inherit href=#10>10</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=11><a style=outline:none;text-decoration:none;color:inherit href=#11>11</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=12><a style=outline:none;text-decoration:none;color:inherit href=#12>12</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=13><a style=outline:none;text-decoration:none;color:inherit href=#13>13</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=14><a style=outline:none;text-decoration:none;color:inherit href=#14>14</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=15><a style=outline:none;text-decoration:none;color:inherit href=#15>15</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=16><a style=outline:none;text-decoration:none;color:inherit href=#16>16</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=17><a style=outline:none;text-decoration:none;color:inherit href=#17>17</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=18><a style=outline:none;text-decoration:none;color:inherit href=#18>18</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=19><a style=outline:none;text-decoration:none;color:inherit href=#19>19</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=20><a style=outline:none;text-decoration:none;color:inherit href=#20>20</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=21><a style=outline:none;text-decoration:none;color:inherit href=#21>21</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=22><a style=outline:none;text-decoration:none;color:inherit href=#22>22</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=23><a style=outline:none;text-decoration:none;color:inherit href=#23>23</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=24><a style=outline:none;text-decoration:none;color:inherit href=#24>24</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=25><a style=outline:none;text-decoration:none;color:inherit href=#25>25</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=26><a style=outline:none;text-decoration:none;color:inherit href=#26>26</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=27><a style=outline:none;text-decoration:none;color:inherit href=#27>27</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=28><a style=outline:none;text-decoration:none;color:inherit href=#28>28</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=29><a style=outline:none;text-decoration:none;color:inherit href=#29>29</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=30><a style=outline:none;text-decoration:none;color:inherit href=#30>30</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=31><a style=outline:none;text-decoration:none;color:inherit href=#31>31</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=32><a style=outline:none;text-decoration:none;color:inherit href=#32>32</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=33><a style=outline:none;text-decoration:none;color:inherit href=#33>33</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=34><a style=outline:none;text-decoration:none;color:inherit href=#34>34</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=35><a style=outline:none;text-decoration:none;color:inherit href=#35>35</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=36><a style=outline:none;text-decoration:none;color:inherit href=#36>36</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=37><a style=outline:none;text-decoration:none;color:inherit href=#37>37</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=38><a style=outline:none;text-decoration:none;color:inherit href=#38>38</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=39><a style=outline:none;text-decoration:none;color:inherit href=#39>39</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=40><a style=outline:none;text-decoration:none;color:inherit href=#40>40</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=41><a style=outline:none;text-decoration:none;color:inherit href=#41>41</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=42><a style=outline:none;text-decoration:none;color:inherit href=#42>42</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=43><a style=outline:none;text-decoration:none;color:inherit href=#43>43</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=44><a style=outline:none;text-decoration:none;color:inherit href=#44>44</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=45><a style=outline:none;text-decoration:none;color:inherit href=#45>45</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=46><a style=outline:none;text-decoration:none;color:inherit href=#46>46</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=47><a style=outline:none;text-decoration:none;color:inherit href=#47>47</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=48><a style=outline:none;text-decoration:none;color:inherit href=#48>48</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=49><a style=outline:none;text-decoration:none;color:inherit href=#49>49</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=50><a style=outline:none;text-decoration:none;color:inherit href=#50>50</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=51><a style=outline:none;text-decoration:none;color:inherit href=#51>51</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=52><a style=outline:none;text-decoration:none;color:inherit href=#52>52</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=53><a style=outline:none;text-decoration:none;color:inherit href=#53>53</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=54><a style=outline:none;text-decoration:none;color:inherit href=#54>54</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=55><a style=outline:none;text-decoration:none;color:inherit href=#55>55</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=56><a style=outline:none;text-decoration:none;color:inherit href=#56>56</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=57><a style=outline:none;text-decoration:none;color:inherit href=#57>57</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=58><a style=outline:none;text-decoration:none;color:inherit href=#58>58</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=59><a style=outline:none;text-decoration:none;color:inherit href=#59>59</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=60><a style=outline:none;text-decoration:none;color:inherit href=#60>60</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=61><a style=outline:none;text-decoration:none;color:inherit href=#61>61</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=62><a style=outline:none;text-decoration:none;color:inherit href=#62>62</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=63><a style=outline:none;text-decoration:none;color:inherit href=#63>63</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=64><a style=outline:none;text-decoration:none;color:inherit href=#64>64</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=65><a style=outline:none;text-decoration:none;color:inherit href=#65>65</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=66><a style=outline:none;text-decoration:none;color:inherit href=#66>66</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=67><a style=outline:none;text-decoration:none;color:inherit href=#67>67</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=68><a style=outline:none;text-decoration:none;color:inherit href=#68>68</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=69><a style=outline:none;text-decoration:none;color:inherit href=#69>69</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=70><a style=outline:none;text-decoration:none;color:inherit href=#70>70</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=71><a style=outline:none;text-decoration:none;color:inherit href=#71>71</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=72><a style=outline:none;text-decoration:none;color:inherit href=#72>72</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=73><a style=outline:none;text-decoration:none;color:inherit href=#73>73</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=74><a style=outline:none;text-decoration:none;color:inherit href=#74>74</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=75><a style=outline:none;text-decoration:none;color:inherit href=#75>75</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=76><a style=outline:none;text-decoration:none;color:inherit href=#76>76</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=77><a style=outline:none;text-decoration:none;color:inherit href=#77>77</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=78><a style=outline:none;text-decoration:none;color:inherit href=#78>78</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=79><a style=outline:none;text-decoration:none;color:inherit href=#79>79</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=80><a style=outline:none;text-decoration:none;color:inherit href=#80>80</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=81><a style=outline:none;text-decoration:none;color:inherit href=#81>81</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=82><a style=outline:none;text-decoration:none;color:inherit href=#82>82</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=83><a style=outline:none;text-decoration:none;color:inherit href=#83>83</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=84><a style=outline:none;text-decoration:none;color:inherit href=#84>84</a>
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=color:#0086b3>Add-TextToCMLog</span> <span style=color:teal>$LogFile</span>  <span style=color:#d14>&#34;Filtering package results to only BIOS packages that would be an upgrade to the current BIOS.&#34;</span> <span style=color:teal>$component</span> 1
<span style=color:teal>$ApplicableBIOSPackages</span> = <span style=color:#0086b3>New-Object</span> System.Collections.ArrayList
<span style=color:#000;font-weight:700>If</span>(<span style=color:teal>$Manufacturer</span> <span style=color:#000;font-weight:700>-ne</span> <span style=color:#d14>&#34;Lenovo&#34;</span>){
	<span style=color:#998;font-style:italic>#Check if any of the packages has a BIOS version higher than the current BIOS version</span>
	<span style=color:#000;font-weight:700>If</span>(<span style=color:teal>$CurrentBIOSVersion</span> <span style=color:#000;font-weight:700>-and</span> <span style=color:teal>$CurrentBIOSVersion</span> <span style=color:#000;font-weight:700>-ne</span> <span style=color:#d14>&#34;Unknown&#34;</span>){
		<span style=color:#0086b3>Add-TextToCMLog</span> <span style=color:teal>$LogFile</span>  <span style=color:#d14>&#34;Filtering package results to only packages that have a BIOS version higher than  </span><span style=color:#d14>`&#34;</span>$(<span style=color:teal>$CurrentBIOSVersion</span>)<span style=color:#d14>`&#34;</span><span style=color:#d14>&#34;</span> <span style=color:teal>$component</span> 1

		<span style=color:#000;font-weight:700>foreach</span>(<span style=color:teal>$package</span> <span style=color:#000;font-weight:700>in</span> <span style=color:teal>$Packages</span>){
			<span style=color:#000;font-weight:700>switch</span>(<span style=color:teal>$Manufacturer</span>){
				<span style=color:#d14>&#34;Dell&#34;</span>{
					<span style=color:#000;font-weight:700>If</span>(<span style=color:teal>$package</span>.Version <span style=color:#000;font-weight:700>-as</span> <span style=color:teal>[Version]</span>){
						<span style=color:#000;font-weight:700>If</span>(<span style=color:teal>$CurrentBIOSVersion</span> <span style=color:#000;font-weight:700>-as</span> <span style=color:teal>[Version]</span>){
							<span style=color:#000;font-weight:700>If</span>((<span style=color:teal>[Version]</span><span style=color:teal>$Package</span>.Version) <span style=color:#000;font-weight:700>-gt</span> <span style=color:teal>[Version]</span><span style=color:teal>$CurrentBIOSVersion</span>){
								<span style=color:teal>[void]</span><span style=color:teal>$ApplicableBIOSPackages</span>.Add(<span style=color:teal>$package</span>)
							}
						}<span style=color:#000;font-weight:700>ElseIf</span>(<span style=color:teal>$CurrentBIOSVersion</span> <span style=color:#000;font-weight:700>-like</span> <span style=color:#d14>&#34;A*&#34;</span>){
							<span style=color:#998;font-style:italic>#Moving from A__ version to a proper version number is considered an upgrade for Dell systems</span>
							<span style=color:teal>[void]</span><span style=color:teal>$ApplicableBIOSPackages</span>.Add(<span style=color:teal>$package</span>)
						}
					}<span style=color:#000;font-weight:700>ElseIf</span>((<span style=color:teal>$Package</span>.Version <span style=color:#000;font-weight:700>-like</span> <span style=color:#d14>&#34;A*&#34;</span>) <span style=color:#000;font-weight:700>-and</span> (<span style=color:teal>$CurrentBIOSVersion</span> <span style=color:#000;font-weight:700>-like</span> <span style=color:#d14>&#34;A*&#34;</span>)){
						<span style=color:#000;font-weight:700>If</span>((<span style=color:teal>[Int32]</span>::Parse((<span style=color:teal>$Package</span>.Version).TrimStart(<span style=color:#d14>&#34;A&#34;</span>))) <span style=color:#000;font-weight:700>-gt</span> (<span style=color:teal>[Int32]</span>::Parse((<span style=color:teal>$CurrentBIOSVersion</span>).TrimStart(<span style=color:#d14>&#34;A&#34;</span>)))){
							<span style=color:teal>[void]</span><span style=color:teal>$ApplicableBIOSPackages</span>.Add(<span style=color:teal>$package</span>)
						}
					}
				}
				<span style=color:#d14>&#34;Hewlett-Packard&#34;</span>{
					<span style=color:teal>$packageVersion</span> = (<span style=color:teal>$package</span>.Version).TrimEnd(<span style=color:#d14>&#34;.&#34;</span>)
					<span style=color:teal>$packageVersion</span> = <span style=color:teal>$packageVersion</span>.Split(<span style=color:#d14>&#34; &#34;</span>)[0] <span style=color:#998;font-style:italic>#Example: 02.02.03 A 1 --&gt; Will only use 02.02.03 for evaluating</span>
					<span style=color:#000;font-weight:700>If</span>(<span style=color:teal>$packageVersion</span> <span style=color:#000;font-weight:700>-as</span> <span style=color:teal>[Version]</span>){
						<span style=color:#000;font-weight:700>If</span>(<span style=color:teal>$CurrentBIOSVersion</span> <span style=color:#000;font-weight:700>-as</span> <span style=color:teal>[Version]</span>){
							<span style=color:#000;font-weight:700>If</span>(<span style=color:teal>[Version]</span><span style=color:teal>$packageVersion</span> <span style=color:#000;font-weight:700>-gt</span> <span style=color:teal>[Version]</span><span style=color:teal>$CurrentBIOSVersion</span>){
								<span style=color:teal>[void]</span><span style=color:teal>$ApplicableBIOSPackages</span>.Add(<span style=color:teal>$package</span>)
							}
						}<span style=color:#000;font-weight:700>Else</span>{<span style=color:#998;font-style:italic>#Attempting to extract a version number from the current BIOS version provided</span>
							<span style=color:teal>$CleanBIOSVersion</span> = <span style=color:teal>$CurrentBIOSVersion</span>.TrimEnd(<span style=color:#d14>&#34;.&#34;</span>)
							<span style=color:teal>$CleanBIOSVersion</span> = <span style=color:teal>$CleanBIOSVersion</span>.Split(<span style=color:#d14>&#34; &#34;</span>)[0]
							<span style=color:#000;font-weight:700>If</span>(<span style=color:teal>$CleanBIOSVersion</span> <span style=color:#000;font-weight:700>-as</span> <span style=color:teal>[Version]</span>){
								<span style=color:#000;font-weight:700>If</span>(<span style=color:teal>[Version]</span><span style=color:teal>$packageVersion</span> <span style=color:#000;font-weight:700>-gt</span> <span style=color:teal>[Version]</span><span style=color:teal>$CleanBIOSVersion</span>){
									<span style=color:teal>[void]</span><span style=color:teal>$ApplicableBIOSPackages</span>.Add(<span style=color:teal>$package</span>)
								}
							}
						}
					}<span style=color:#000;font-weight:700>ElseIf</span>(<span style=color:teal>$packageVersion</span> <span style=color:#000;font-weight:700>-match</span> <span style=color:#d14>&#34;.*F\.(\d+)$&#34;</span>){
						<span style=color:teal>$packageVersion</span> = <span style=color:teal>$matches</span>[1]
						<span style=color:#000;font-weight:700>If</span>(<span style=color:teal>$CurrentBIOSVersion</span> <span style=color:#000;font-weight:700>-match</span> <span style=color:#d14>&#34;.*F\.(\d+)$&#34;</span>){
							<span style=color:#000;font-weight:700>If</span>(<span style=color:teal>[int32]</span><span style=color:teal>$packageVersion</span> <span style=color:#000;font-weight:700>-gt</span> <span style=color:teal>[int32]</span><span style=color:teal>$matches</span>[1]){
								<span style=color:teal>[void]</span><span style=color:teal>$ApplicableBIOSPackages</span>.add(<span style=color:teal>$package</span>)
							}
						}
					}
				}
				<span style=color:#d14>&#34;Microsoft&#34;</span>{
					<span style=color:#0086b3>Add-TextToCMLog</span> <span style=color:teal>$LogFile</span>  <span style=color:#d14>&#34;No BIOS package will be returned, Microsoft provides firmware updates as part of their driver packages.&#34;</span> <span style=color:teal>$component</span> 2
				}
				<span style=color:#000;font-weight:700>default</span>{
					<span style=color:#998;font-style:italic>#Any other manufacturer: Compare versions only if they both parse as [Version] objects</span>
					<span style=color:#000;font-weight:700>If</span>((<span style=color:teal>$package</span>.Version <span style=color:#000;font-weight:700>-as</span> <span style=color:teal>[Version]</span>) <span style=color:#000;font-weight:700>-and</span> (<span style=color:teal>$CurrentBIOSVersion</span> <span style=color:#000;font-weight:700>-as</span> <span style=color:teal>[Version]</span>)){
						<span style=color:#000;font-weight:700>If</span>(<span style=color:teal>[Version]</span>(<span style=color:teal>$package</span>.Version) <span style=color:#000;font-weight:700>-gt</span> <span style=color:teal>[Version]</span><span style=color:teal>$CurrentBIOSVersion</span>){
							<span style=color:teal>[void]</span><span style=color:teal>$ApplicableBIOSPackages</span>.Add(<span style=color:teal>$package</span>)
						}
					}
				}
			}
		}
	}<span style=color:#000;font-weight:700>Else</span>{
		<span style=color:#0086b3>Add-TextToCMLog</span> <span style=color:teal>$LogFile</span>  <span style=color:#d14>&#34;No current BIOS version specified, cannot compare BIOS version.&#34;</span> <span style=color:teal>$component</span> 3
	}
}<span style=color:#000;font-weight:700>Else</span>{
	<span style=color:#998;font-style:italic>#Lenovo Only: Check if any of the remaining packages have a BIOS Release Date newer than the current BIOS Release Date</span>
	<span style=color:#0086b3>Add-TextToCMLog</span> <span style=color:teal>$LogFile</span>  <span style=color:#d14>&#34;Filtering package results to only packages that have a BIOS release date newer than </span><span style=color:#d14>`&#34;</span>$(<span style=color:teal>$CurrentBIOSReleaseDate</span>)<span style=color:#d14>`&#34;</span><span style=color:#d14>.&#34;</span> <span style=color:teal>$component</span> 1
	<span style=color:teal>$BIOSReleaseDate</span> = <span style=color:teal>[datetime]</span>::ParseExact(<span style=color:teal>$CurrentBIOSReleaseDate</span>,<span style=color:#d14>&#34;yyyyMMdd&#34;</span>,<span style=color:teal>$null</span>)
	<span style=color:#000;font-weight:700>foreach</span>(<span style=color:teal>$package</span> <span style=color:#000;font-weight:700>in</span> <span style=color:teal>$Packages</span>){
		<span style=color:#000;font-weight:700>If</span>(<span style=color:teal>$package</span>.Description <span style=color:#000;font-weight:700>-match</span> <span style=color:#d14>&#34;\(Models included:(.*)\) \(Release Date:(.*)\)&#34;</span>){
			<span style=color:#000;font-weight:700>Try</span>{
				<span style=color:teal>$ReleaseDate</span> = <span style=color:teal>[datetime]</span>::ParseExact(<span style=color:teal>$matches</span>[2],<span style=color:#d14>&#34;yyyyMMdd&#34;</span>,<span style=color:teal>$null</span>)
				<span style=color:#000;font-weight:700>If</span>(<span style=color:teal>$ReleaseDate</span> <span style=color:#000;font-weight:700>-gt</span> <span style=color:teal>$BIOSReleaseDate</span>){
					<span style=color:teal>[void]</span><span style=color:teal>$ApplicableBIOSPackages</span>.Add(<span style=color:teal>$package</span>)
				}
			}<span style=color:#000;font-weight:700>Catch</span>{
				<span style=color:#0086b3>Add-TextToCMLog</span> <span style=color:teal>$LogFile</span>  <span style=color:#d14>&#34;Failed to parse </span><span style=color:#d14>`&#34;</span><span style=color:#d14>$matches[2]</span><span style=color:#d14>`&#34;</span><span style=color:#d14> as a BIOS release date for package </span><span style=color:#d14>`&#34;</span>$(<span style=color:teal>$package</span>.Name)<span style=color:#d14>`&#34;</span><span style=color:#d14>, skipping...&#34;</span> <span style=color:teal>$component</span> 2
			}
		}
	}
}
</code></pre></td></tr></table>
</div>
</div>
<p><div class=image>
<figure>
<a href=image-6-1024x545.png target=_blank>
<img src=image-6-1024x545.png alt>
</a>
</figure>
</div> Example of the log file created when querying for a BIOS package</p>
<p>With these enhancements done on the script, we are now ready to use a task sequence to dynamically apply BIOS packages.</p>
<h3 id=task-sequences-modifications>Task Sequences modifications</h3>
<h4 id=modify-the-query-adminservice-for-packageid-ts>Modify the &ldquo;Query AdminService for PackageID&rdquo; TS</h4>
<p>We need to provide the current BIOS version and release date to the script in the task sequence.</p>
<p><div class=image>
<figure>
<a href=image-7-1024x743.png target=_blank>
<img src=image-7-1024x743.png alt>
</a>
</figure>
</div> New TS variables used for BIOS packages</p>
<p>Then we pass this information as a parameter to the Invoke-GetPackageIDFromAdminService script.</p>
<p><div class=image>
<figure>
<a href=image-8-1024x655.png target=_blank>
<img src=image-8-1024x655.png alt>
</a>
</figure>
</div> </p>
<h4 id=create-the-apply-bios-package-task-sequence>Create the &ldquo;Apply BIOS package&rdquo; task sequence</h4>
<p>The task sequence is similar to the one I had created for drivers. For applying the actual BIOS update, I&rsquo;ve reused the scripts by the guys at <a href=https://msendpointmgr.com/>MSEndpointMgr</a>.</p>
<p><div class=image>
<figure>
<a href=image-5-1024x820.png target=_blank>
<img src=image-5-1024x820.png alt>
</a>
</figure>
</div> </p>
<h4 id=regarding-hp-bios-updates>Regarding HP BIOS updates</h4>
<p>If your HP devices have a BIOS password set (I hope you do), then you&rsquo;ll need to specify 2 more variables:</p>
<ul>
<li>PasswordBinFilename: Name of the .bin file to use when applying BIOS update</li>
<li>PasswordBinPackageID: PackageID of the package containing the .bin file.</li>
</ul>
<p>I had to modify the original <a href=https://github.com/MSEndpointMgr/ConfigMgr/blob/master/Operating%20System%20Deployment/BIOS/Invoke-HPBIOSUpdate.ps1>Invoke-HPBIOSUpdate</a> script to add a new parameter to specify the path to the .bin file because the original script would expect the .bin file to be in the same folder as the script.</p>
<p>I also did not like the fact that the HP BIOS utility writes a log file in whatever directory it&rsquo;s located in with no options to specify a different log path, so I added a step to move the log file to _SMSTSLogPath.</p>
<h3 id=download>Download</h3>
<p><a href=https://github.com/CharlesNRU/mdm-adminservice/raw/master/MDM-TS.zip>Direct link to the task sequences</a></p>
<p><a href=https://github.com/CharlesNRU/mdm-adminservice/raw/master/MDM-TS.zip>Link to the github repository</a></p>
<p>As always, feel free to contact me if you have any suggestions for improvements.</p>
<p>Thank you.</p>
</div>
<comments id=comments>
<script src=https://utteranc.es/client.js repo=SysManSquad/sysmansquadblog issue-term=title label="blog comment" theme=github-light crossorigin=anonymous async></script>
</comments>
</article>
</div>
</div>
</div>
<footer id=footer>
<div class=container>
<div id=footer-copyright>
<p class=copyright>&copy; 2021 WinAdmins - https://blog.sysmansquad.com - Systems Management Squad</a></p>
</div>
</div>
</footer>
</div>
</body>
</html>