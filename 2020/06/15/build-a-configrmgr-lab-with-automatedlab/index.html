<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=keyword content="ConfigMgr Microsoft Intune Windows WinAdmins"><meta name=viewport content="width=device-width"><meta name=description content="A community blog and subsidiary of WinAdmins.io"><link rel="shortcut icon" href=/img/favicon.ico><title>Build a ConfigrMgr lab with AutomatedLab-SysManSquad | Systems Management Squad</title><link rel=canonical href=/2020/06/15/build-a-configrmgr-lab-with-automatedlab/><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=https://sysmansquad.com/css/custom.css><script src=https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js></script>
<script src=https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js></script>
<script src=https://sysmansquad.com/js/jquery.slicknav.js></script>
<script src=https://sysmansquad.com/js/asd_SlickNav_Mobile.js></script>
<script src=https://sysmansquad.com/js/clipboard.js></script>
<script src=https://sysmansquad.com/js/custom.js></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XXZR1RSQYX"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XXZR1RSQYX",{anonymize_ip:!1})}</script><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://sysmansquad.com/83"><meta name=twitter:title content="Build a ConfigrMgr lab with AutomatedLab"><meta name=twitter:description content="In this post I&rsquo;ll show you how to start building a ConfigMgr lab, for either Current Branch or Technical Preview, using AutomatedLab with Hyper-V. This approach is intended to be completely automated and &ldquo;hands off&rdquo; by calling a single script.
It downloads all the necessary files for you, including the CB or TP installation media. All you have to do is provide a Windows Server 2016/2019 ISO, but this can also be an evaluation copy."></head><body class="home blog"><div id=asd-container><div id=top-bar><div class=container><div id=nav-wrapper><ul class=menu id=menu-top-menu><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/>Home</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/about/><span>About</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=https://github.com/SysManSquad><span>GitHub</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/jointhesquad/><span>Join the Squad</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/meetthesquad/><span>Meet the Squad</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=#><span>MORE></span></a><ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/contact/>Contact</a></li></ul></li></ul></div><div id=top-search><a href=# class=search><i class="fa fa-search"></i></a><div class=show-search><form role=search method=get action=https://www.google.com/search id=searchform><input type=search placeholder="Search and hit enter..." name=q id=q title="Search and hit enter...">
<input type=hidden name=sitesearch value=https://sysmansquad.com>
<button type=submit value=Search class=searchbutton></form></div></div><div class=menu id=menu-mobile></div></div></div><header id=header class=noslider><div class=container><div id=logo><h1><a href=https://sysmansquad.com><img src=/img/SysManSquad-HorizontalColor-Logo.png alt="Systems Management Squad"></a></h1></div></div></header><div class=container><div id=content><div id=main class=fullwidth><article class="post type-post status-publish format-standard has-post-thumbnail hentry"><div class=post-header><h1>Build a ConfigrMgr lab with AutomatedLab</h1><p class=p-meta><span class=post-author><a href=/authors/acc>Adam Cook</a> /</span>
<span class=post-date>June 15, 2020</span>
<span class=post-categories>/ Endpoint Management</span>
<span class=post-categories>/ MECM/MEMCM/SCCM</span>
<span class=post-categories>/ Powershell</span>
<span class=post-categories>/ Scripting</span></p></div><div class=post-entry><p>In this post I&rsquo;ll show you how to start building a ConfigMgr lab, for either Current Branch or Technical Preview, using AutomatedLab with Hyper-V. This approach is intended to be completely automated and &ldquo;hands off&rdquo; by calling a single script.</p><p>It downloads all the necessary files for you, including the CB or TP installation media. All you have to do is provide a Windows Server 2016/2019 ISO, but this can also be an evaluation copy.</p><p>This post was originally posted on the <a href=https://winadmins.io>WinAdmins</a> blog, however we&rsquo;ve joined forces with SysManSquad and moved the content. Since that post, I&rsquo;ve updated the code to support the 2002 baseline, several bug fixes and now support installing Technical Preview! I also intend to provide clearer instructions.</p><h3 id=what-is-automatedlab>What is AutomatedLab?</h3><p><a href=https://github.com/automatedlab/automatedlab>AutomatedLab</a> is a PowerShell module for building lab environments with simple PowerShell code! The module can be found on <a href=https://github.com/AutomatedLab/AutomatedLab>GitHub</a> and more documentation also on their <a href=https://automatedlab.org>website</a>.</p><p>The benefit of using AutomatedLab is the simplicity it offers to build and throw away environments of varying complexity. Also, it offers a huge range of functions to customise your lab to how you want it.</p><p>Generally you create your build script, set it to run, come back some time later and your lab is complete exactly how you want it. That&rsquo;s exactly what I&rsquo;ve done with this ConfigMgr CustomRole: run the script, leave it alone and come back to a fully functioning and independent environment.</p><p>If you&rsquo;re curious and want an introduction to AutomatedLab, <a href=https://sysmansquad.com/2020/06/15/getting-started-with-automatedlab/>check out this post I wrote</a>. However it&rsquo;s not strictly necessary to follow along right now with this post if you have no prior understanding.</p><h3 id=yet-another-configmgr-lab-solution>Yet another ConfigMgr lab solution</h3><p>In my quest for finding an automated way to build out a ConfigMgr lab, I found several excellent options:</p><ul><li><a href=https://github.com/onpremcloudguy/PSNewCMENV>PSNewCMENV</a> - @onpremcloudguy</li><li><a href=https://github.com/AdamGrossTX/CMHyperHydrate>CMHyperHydrate</a> - @AdamGrossTX</li><li><a href=https://github.com/Skatterbrainz/CMBuild>CMBuild</a> - @skatterbrainzz</li><li><a href=https://deploymentresearch.com/hydration-kit-for-windows-server-2016-and-configmgr-current-technical-preview-branch/>ViaMonstra Hydration Kit</a> - @jarwidmark</li></ul><p>I was mainly interested in something that was hands off and had opportunities for me to contribute to. With that I felt AutomatedLab was exactly what I wanted.</p><p>At the time I found AutomatedLab, the ConfigMgr / SCCM / MEMCM / MECM (ARGH!) CustomRole in AutomatedLab&rsquo;s repository only had version 1802, so I thought I&rsquo;d chip in.</p><h3 id=getting-started>Getting started</h3><p>First things first, make sure you have got the latest version of the AutomatedLab module installed. Compare your installed version with what&rsquo;s available on the <a href=https://github.com/AutomatedLab/AutomatedLab/releases>AutomatedLab repository assets page</a>:</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cmd data-lang=cmd><span style=display:flex><span>PS C:\&gt; Get-Module <span style=color:#d14>&#34;AutomatedLab&#34;</span> -ListAvailable
</span></span></code></pre></td></tr></table></div></div><p><a href=ALInstalledModule.jpg><div class=image><figure><a href=ALInstalledModule.jpg target=_blank><img src=ALInstalledModule.jpg alt=screenshot></a></figure></div></a>Get installed version of AutomatedLab</p><p>To get started you&rsquo;ll need two things:</p><ul><li>The <code>CM-2002.ps1</code> script.</li><li>The <code>CM-2002</code> CustomRole folder and all of its contents, stored in your local AutomatedLab&rsquo;s CustomRole folder.</li></ul><p>You can source these things from either my <a href=https://github.com/codaamok/posh>PoSH GitHub repository</a>, the <a href=https://github.com/AutomatedLab/AutomatedLab>AutomatedLab GitHub repository</a> or they&rsquo;re are bundled within the AutomatedLab installer so you probably already have them on disk right now.</p><p>However, there&rsquo;s a high probability that what&rsquo;s in my repository is going to contain the latest fixes than anywhere else. So let&rsquo;s roll with that.</p><p>Download using either <code>git</code> or just download ZIP from the repository&rsquo;s web page:</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-1>1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-2>2</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cmd data-lang=cmd><span style=display:flex><span><span style=color:#000;font-weight:700>cd</span> C:\path\to\where\you\want\to\download
</span></span><span style=display:flex><span>git clone https://github.com/codaamok/PoSH.git
</span></span></code></pre></td></tr></table></div></div><p><div class=image><figure><a href=CM2002ALDownloadZip.jpg target=_blank><img src=CM2002ALDownloadZip.jpg alt=screenshot></a></figure></div>Download as ZIP from <a href=https://github.com/codaamok/posh>https://github.com/codaamok/posh</a></p><p>Now the content is downloaded, we must copy only the <code>CustomRole\CM-2002</code> folder to the correct location on disk so AutomatedLab can use the scripts inside it. The location of <code>CM-2002.ps1</code> isn&rsquo;t important.</p><p>If you were to use PowerShell, the command would look like this:</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#0086b3>PS </span>C:\&gt; <span style=color:#0086b3>Copy-Item</span> -Path <span style=color:#d14>&#34;C:\path\to\where\you\downloaded\PoSH\AutomatedLab\CustomRoles\CM-2002&#34;</span> -Destination <span style=color:#d14>&#34;C:\LabSources\CustomRoles&#34;</span> -Recurse -Force
</span></span></code></pre></td></tr></table></div></div><p>Make sure you have a Windows Server 2016 or 2019 ISO (Evaluation will be fine) in your <code>C:\LabSources\ISOs</code> directory.</p><p>Now you can just call <code>CM-2002.ps1</code> as is, without any parameters! It will download all the prerequisites and necessary binaries, and install everything for you.</p><p>Of course parameters are available to further customise your lab, however as is will give you a functional lab with the below configurations:</p><ul><li>1x AutomatedLab lab<ul><li>Name: &ldquo;CMLab01&rdquo;</li><li>VMPath: <em><code>&lt;drive</code>></em>:\AutomatedLab-VMs where <em><code>&lt;drive</code>></em> is the fastest drive available</li><li>AddressSpace: An unused and available subnet increasing 192.168.1.0 by 1 until one is found.</li><li>ExternalVMSwitch: Allows physical network access via Hyper-V external switch named &ldquo;Internet&rdquo;. &ldquo;Default Switch&rdquo; is an acceptable value to leverage an independent virtual network behind NAT.</li></ul></li><li>1x Active Directory domain:<ul><li>Domain: &ldquo;sysmansquad.lab&rdquo;</li><li>Username: &ldquo;Administrator&rdquo;</li><li>Password: &ldquo;Somepass1&rdquo;</li></ul></li><li>2x Hyper-V virtual machines:<ul><li>Operating System: Windows Server 2019 (Desktop Experience)</li><li>1x Domain Controller<ul><li>Name: &ldquo;DC01&rdquo;</li><li>vCPU: 2</li><li>Max memory: 2GB</li><li>Roles: &ldquo;RootDC&rdquo;, &ldquo;Routing&rdquo;</li><li>1x ConfigurationManagerprimarysiteserver:<ul><li>Name: &ldquo;CM01&rdquo;</li><li>vCPU: 4</li><li>Max memory: 8GB</li><li>Roles: &ldquo;SQLServer2017&rdquo;</li><li>CustomRoles: &ldquo;CM-2002&rdquo;</li><li>SiteCode: &ldquo;P01&rdquo;</li><li>SiteName: &ldquo;CMLab01&rdquo;</li><li>Version: &ldquo;Latest&rdquo;</li><li>LogViewer: &ldquo;OneTrace&rdquo;</li><li>Site system roles: MP, DP, SUP (inc WSUS), RSP, EP</li></ul></li></ul></li></ul></li></ul><h3 id=customisations>Customisations</h3><p>The majority of the above are customisable via the variety of parameters available for <code>CM-2002.ps1</code>.</p><p>Review the parameters available for <code>CM-2002.ps1</code> via <code>Get-Help C:\path\to\CM-2002.ps1</code> with parameters like <code>-Detailed</code>, <code>-Parameter &lt;paramaternamehere></code> etc. Also in my repository is a <code>CM-2002.md</code> markdown file which lays out all the parameters and examples.</p><p>A few examples of things you can customise using parameters of <code>CM-2002.ps1</code> are:</p><ul><li>Which branch to use, whether Current Branch or Technical Preview</li><li>Domain</li><li>Use Windows Server 2016 or 2019, Standard or Datacenter</li><li>Username / password</li><li>Enable/disable auto logon</li><li>Address space / subnet for the lab</li><li>Site code and name</li><li>Hyper-V setting such as vCPU count or memory settings per VM</li><li>Target Configuration Manager version<ul><li>At the time of writing this, only 2002 is available. However when updates become available, you&rsquo;ll be able to specify 2002, 2006, 2010 or just simply &ldquo;Latest&rdquo;</li><li>For Technical Preview, you&rsquo;ll only ever be able to specify 2002 or &ldquo;Latest&rdquo;.</li></ul></li></ul><p>If you wanted to apply scripted customisations to your lab, after the build is complete, then you can consider using <code>C:\LabSources\CustomRoles\CM-2002\CustomiseCM.ps1</code>.</p><h3 id=adding-servers-or-clients-to-the-lab>Adding servers or clients to the lab</h3><p>Doing this is as simple as spinning up VMs as you normally would, making them reachable to other VMs in the lab and join them to the domain.</p><p>If you&rsquo;re thinking, &ldquo;wait, what? I&rsquo;ve automated this much but now I have to manually install more clients/servers?!&rdquo;&mldr; then check out the <strong>Adding or removing lab machines</strong> section <a href=https://sysmansquad.com/2020/06/15/getting-started-with-automatedlab/>from this post</a>.</p><h3 id=support>Support</h3><p>If you experience any issues, please do open an issue on my <a href=https://github.com/codaamok/posh>GitHub repository</a>! Alternatively you can ping me on Twitter (<a href=https://twitter.com/codaamok>@codaamok</a>).</p><img src=/authors/acc/avatar.png alt="Photo of Adam Cook"><br><strong>Adam Cook</strong>
<em>Admin/Contributor</em><div><a href=https://twitter.com/codaamok><img src=/img/social/twitter.png></a>
<a href=https://www.linkedin.com/in/adamcharlescook><img src=/img/social/linkedin.png></a></div><p>Adam loves technology and helping people, focusing on PowerShell, Azure, ConfigMgr, and Linux.</p><hr></div><div class=post-share><div class="post-share-box share-comments"></div></div><comments id=comments><script src=https://utteranc.es/client.js repo=SysManSquad/sysmansquadblog issue-term=title label="blog comment" theme=github-light crossorigin=anonymous async></script></comments></article></div></div></div><footer id=footer><div class=container><div id=footer-copyright><p class=copyright>&copy; 2023 WinAdmins - https://sysmansquad.com - Systems Management Squad</a></p></div></div></footer></div></body></html>