<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=keyword content="ConfigMgr Microsoft Intune Windows WinAdmins"><meta name=viewport content="width=device-width"><meta name=description content="A community blog and subsidiary of WinAdmins.io"><link rel="shortcut icon" href=/img/favicon.ico><title>Working With Internet-Optimized Task Sequences and Generic Status Messages-SysManSquad | Systems Management Squad</title><link rel=canonical href=/2020/06/10/working-with-internet-optimized-task-sequences-and-generic-status-messages/><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=https://sysmansquad.com/css/custom.css><script src=https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js></script>
<script src=https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js></script>
<script src=https://sysmansquad.com/js/jquery.slicknav.js></script>
<script src=https://sysmansquad.com/js/asd_SlickNav_Mobile.js></script>
<script src=https://sysmansquad.com/js/clipboard.js></script>
<script src=https://sysmansquad.com/js/custom.js></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XXZR1RSQYX"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XXZR1RSQYX",{anonymize_ip:!1})}</script><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://sysmansquad.com/83"><meta name=twitter:title content="Working With Internet-Optimized Task Sequences and Generic Status Messages"><meta name=twitter:description content="For my customer the move to remote work is here to stay. In adjustment to the “New Normal,” deployment projects put on hold these last months are in discussion again. One project resuming soon is the upgrade from Office 2016 to Microsoft 365 Apps. With many laptop computers now internet or VPN-based what can be done to optimize upgrades for these remote users?
To provide background, my customer has recently implemented cloud management gateways and cloud distribution points."></head><body class="home blog"><div id=asd-container><div id=top-bar><div class=container><div id=nav-wrapper><ul class=menu id=menu-top-menu><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/>Home</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/about/><span>About</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=https://github.com/SysManSquad><span>GitHub</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/jointhesquad/><span>Join the Squad</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/meetthesquad/><span>Meet the Squad</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=#><span>MORE></span></a><ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/contact/>Contact</a></li></ul></li></ul></div><div id=top-search><a href=# class=search><i class="fa fa-search"></i></a><div class=show-search><form role=search method=get action=https://www.google.com/search id=searchform><input type=search placeholder="Search and hit enter..." name=q id=q title="Search and hit enter...">
<input type=hidden name=sitesearch value=https://sysmansquad.com>
<button type=submit value=Search class=searchbutton></form></div></div><div class=menu id=menu-mobile></div></div></div><header id=header class=noslider><div class=container><div id=logo><h1><a href=https://sysmansquad.com><img src=/img/SysManSquad-HorizontalColor-Logo.png alt="Systems Management Squad"></a></h1></div></div></header><div class=container><div id=content><div id=main class=fullwidth><article class="post type-post status-publish format-standard has-post-thumbnail hentry"><div class=post-header><h1>Working With Internet-Optimized Task Sequences and Generic Status Messages</h1><p class=p-meta><span class=post-author><a href=/authors/ronald>Ronald Montgomery</a> /</span>
<span class=post-date>June 10, 2020</span>
<span class=post-categories>/ Endpoint Management</span></p></div><div class=post-entry><p>For my customer the move to remote work is here to stay. In adjustment to the “New Normal,” deployment projects put on hold these last months are in discussion again. One project resuming soon is the upgrade from Office 2016 to Microsoft 365 Apps. With many laptop computers now internet or VPN-based what can be done to optimize upgrades for these remote users?</p><p>To provide background, my customer has recently implemented cloud management gateways and cloud distribution points. Content is available off VPN, but the task sequence is set to download all content before start. Therefore, we try to keep the task sequence as slim as possible since all dependencies (needed or not) are downloaded. The base Microsoft 365 Apps installation package in the task sequence is provided by a global team. We can’t easily make changes to the package or tweak it. Similarly, running PowerShell scripts from the console is tightly controlled.</p><p>One set of issues to solve are the uninstallation and upgrades for related Office software. My client uses two configurations of a room scheduling Outlook plug-in application, and 32-bit versions of Project and Visio are installed for many. With a 2.5 GB Microsoft 365 Apps install package, I was reluctant to add more binaries to the task sequence payload that won’t be needed by many computers. To alleviate payload we created a bare bones uninstall package for the Outlook plug-in and reduced those packages from 100 MB to less than 1 MB. The Microsoft 365 Apps upgrade application handles the 32-bit Project and Visio uninstalls.</p><p>The next challenge was how to capture the Outlook plug-in, Visio, and Project reinstalls. The task sequence sets boolean variables to capture the presence of each software. My customer has a webservice that can be called to inject these computer resource records into remediation deployment collections, but it’s not accessible to internet-based computers.</p><p>I found <a href=https://www.reddit.com/r/SCCM/comments/b19gzw/how_we_used_to_do_it_collecting_client_data_via/>this</a> generic status message article on Reddit and worked through the examples. A way to piggyback off SCCM client communication back to the infrastructure appealed to me. Could it somehow solve my problem with the application reinstalls?</p><p>The author explains how to return a generic information status message, with information of your choice in one of the insertion string fields. I created an action in my task sequence to return a string value of <strong>projectInstalled</strong> if 32-bit Project was installed. I use the Project boolean task sequence variable set earlier in the task sequence as a condition for the action.</p><p>If the 32-bit Project condition evaluates true the generic status message is sent:</p><p>**%**SYSTEMROOT%\System32\WindowsPowerShell\v1.0\powershell.exe -ExecutionPolicy Bypass -Command " & { $eventObj = New-Object -ComObject Microsoft.SMS.Event -ErrorAction Stop; $eventObj.EventType = "SMS_GenericStatusMessage_Info";$eventObj.SetProperty("Attribute403", "GenericMsg_SeeInsertionStrings");$eventObj.SetProperty("InsertionString1","MsgType_Office365Upgrade");$eventObj.SetProperty("InsertionString2", "projectInstalled");$eventObj.Submit()}"</p><p>(A quick aside: I used a task sequence command line action to run this script. The preferred method is to run a PowerShell script; old dog, new tricks, and all that jazz. Adam Gross has re-written the above code as a robust PowerShell script. The script is available <a href=https://github.com/RonaldMontgomery/SysManSquad/blob/master/New-CustomStatusMessage>here</a>.)</p><p>I created similar task sequence actions for 32-bit Visio and the Outlook plug-ins. These actions are executed at the start of the task sequence, when there is the best chance the client will successfully return this information. We originally had this after the Microsoft 365 Apps install reboot and the messages weren’t always successfully sent – the computer was on VPN and didn’t switch to communicating with the CMG, an issue we’re still trying to understand.</p><p>When querying status messages on the CAS I saw the generic status messages returned. Now to use that data for remediation.</p><p>There are creative ways to use this information. We can programmatically query for these generic status messages, or use Microsoft Flow or a Status Filter Rule, and then call the internal webservice to inject the resource records in the corresponding 64-bit deployment collections. For now, we’ve stayed simple and built remediation collections from the generic status messages.</p><p><a href="https://social.technet.microsoft.com/Forums/en-US/0822d4d9-3033-4344-8cff-c72d89a0db20/how-to-create-collection-based-on-status-message?forum=configmgrgeneral">This</a> Technet forum thread gives the collection query syntax. The WQL query for the 64-bit Project deployment collection is below. Messsage ID <strong>39997</strong> is the generic information status message ID. The first insertion string value of <strong>MsgType_Office365Upgrade</strong> was chosen to separate these messages from future deployment messages.</p><p><strong>select</strong> SMS_R_SYSTEM.ResourceID,
SMS_R_SYSTEM.ResourceType,
SMS_R_SYSTEM.Name,
SMS_R_SYSTEM.SMSUniqueIdentifier,
SMS_R_SYSTEM.ResourceDomainORWorkgroup,
SMS_R_SYSTEM.Client
<strong>from</strong> sms_R_System
<strong>JOIN</strong> sms_statusmessage <strong>ON</strong> sms_R_System.netbios_name0 = sms_statusmessage.machinename
<strong>JOIN</strong> sms_StatMsgWithInsStrings <strong>ON</strong> sms_statusmessage.RecordID = sms_StatMsgWithInsStrings.RecordID
<strong>WHERE</strong> sms_statusmessage.messageid = &ldquo;39997&rdquo;
<strong>AND</strong> sms_StatMsgWithInsStrings.InsString1 = &ldquo;MsgType_Office365Upgrade&rdquo;
<strong>AND</strong> sms_StatMsgWithInsStrings.InsString2 = &ldquo;projectInstalled&rdquo;</p><p>Through the use of generic status messages in the Microsoft 365 Apps upgrade task sequence we hope to automate application upgrade/installation for the Outlook plug-in, Visio, and Project users. A second goal is to reduce the task sequence payload for internet-based clients – and keep only one task sequence for all deployment cases.<br>Do you do similar work in your environment? Do you have ideas to make this process work better? I’m always trying to learn new ways of working. Please let me know.</p><img src=/authors/ronald/avatar.png alt="Photo of Ronald Montgomery"><br><strong>Ronald Montgomery</strong>
<em>Contributor</em><div><a href=https://www.linkedin.com/in/ronalddmontgomery><img src=/img/social/linkedin.png></a></div><p>Adam is a Ronald is a ConfigMgr administrator in the St. Louis, Missouri area.</p><hr></div><comments id=comments><script src=https://utteranc.es/client.js repo=SysManSquad/sysmansquadblog issue-term=title label="blog comment" theme=github-light crossorigin=anonymous async></script></comments></article></div></div></div><footer id=footer><div class=container><div id=footer-copyright><p class=copyright>&copy; 2022 WinAdmins - https://sysmansquad.com - Systems Management Squad</a></p></div></div></footer></div></body></html>