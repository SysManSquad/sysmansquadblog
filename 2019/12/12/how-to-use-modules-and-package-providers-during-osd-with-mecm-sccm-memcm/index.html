<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=keyword content="ConfigMgr Microsoft Intune Windows WinAdmins"><meta name=viewport content="width=device-width"><meta name=description content="A community blog and subsidiary of WinAdmins.io"><link rel="shortcut icon" href=/img/favicon.ico><title>How to use modules and package providers during OSD with MECM (SCCM/MEMCM)-SysManSquad | Systems Management Squad</title><link rel=canonical href=/2019/12/12/how-to-use-modules-and-package-providers-during-osd-with-mecm-sccm-memcm/><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=https://sysmansquad.com/css/custom.css><script src=https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js></script>
<script src=https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js></script>
<script src=https://sysmansquad.com/js/jquery.slicknav.js></script>
<script src=https://sysmansquad.com/js/asd_SlickNav_Mobile.js></script>
<script src=https://sysmansquad.com/js/clipboard.js></script>
<script src=https://sysmansquad.com/js/custom.js></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XXZR1RSQYX"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XXZR1RSQYX",{anonymize_ip:!1})}</script><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://sysmansquad.com/83"><meta name=twitter:title content="How to use modules and package providers during OSD with MECM (SCCM/MEMCM)"><meta name=twitter:description content="For the past few days, I&rsquo;ve been implementing SnipeIT into our environment to start actually tracking assets as opposed to the archaic spreadsheet we had going. I wanted to add any new machine that were imaged into the database right away without any input from me. That way, all I had to do was assign a user to the device in the asset management portal for SnipeIT, and I was good to go."></head><body class="home blog"><div id=asd-container><div id=top-bar><div class=container><div id=nav-wrapper><ul class=menu id=menu-top-menu><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/>Home</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/about/><span>About</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=https://github.com/SysManSquad><span>GitHub</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/jointhesquad/><span>Join the Squad</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/meetthesquad/><span>Meet the Squad</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=#><span>MORE></span></a><ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/contact/>Contact</a></li></ul></li></ul></div><div id=top-search><a href=# class=search><i class="fa fa-search"></i></a><div class=show-search><form role=search method=get action=https://www.google.com/search id=searchform><input type=search placeholder="Search and hit enter..." name=q id=q title="Search and hit enter...">
<input type=hidden name=sitesearch value=https://sysmansquad.com>
<button type=submit value=Search class=searchbutton></form></div></div><div class=menu id=menu-mobile></div></div></div><header id=header class=noslider><div class=container><div id=logo><h1><a href=https://sysmansquad.com><img src=/img/SysManSquad-HorizontalColor-Logo.png alt="Systems Management Squad"></a></h1></div></div></header><div class=container><div id=content><div id=main class=fullwidth><article class="post type-post status-publish format-standard has-post-thumbnail hentry"><div class=post-header><h1>How to use modules and package providers during OSD with MECM (SCCM/MEMCM)</h1><p class=p-meta><span class=post-author><a href=/authors/jake>Jake Shackelford</a> /</span>
<span class=post-date>December 12, 2019</span>
<span class=post-categories>/ Powershell</span>
<span class=post-categories>/ Scripting</span></p></div><div class=post-entry><p><div class=image><figure><a href=PowerShell.png target=_blank><img src=PowerShell.png alt="Powershell Icon"></a></figure></div></p><p>For the past few days, I&rsquo;ve been implementing SnipeIT into our environment to start actually tracking assets as opposed to the archaic spreadsheet we had going. I wanted to add any new machine that were imaged into the database right away without any input from me. That way, all I had to do was assign a user to the device in the asset management portal for SnipeIT, and I was good to go. However, this proved to be quite the headache for me. Special thanks to Christopher Kibble, Colin Wilkins, and Adam Gross for all their support and helping me learn some PS along the way (I&rsquo;m still a noob).</p><h3 id=its-easier-than-it-sounds>It&rsquo;s easier than it sounds!</h3><p>I&rsquo;ve used many PowerShell scripts during OSD In the past and thanks to the recent changes, where you can just paste a script into a task sequence, it&rsquo;s become even easier! With this in mind, I created a script and tested it on my dev machine and a few others, and everything looked great. They ran in the SYSTEM context fine, as an admin fine, all looked dandy. I put it into my OSD, and it returned successful but never actually showed up into my asset management system. After trying everything under the sun including placement of the script during OSD, turning it into an application, making it a package, etc. I just could not get it to work during OSD. I was about ready to give in but was thinking maybe it&rsquo;s an issue with installing the modules and package providers (It was).</p><h3 id=how-to-get-those-lovely-modules-and-packages-during-osd>How to get those lovely modules and packages during OSD.</h3><p>In my use case, I already had the module and package provider I needed installed to my machine.</p><p>You can find the modules you need at <code>$env:ProgramFiles\WindowsPowerShell\Modules</code> assuming you have them installed on your machine.</p><p>You can find PackageProviders at <code>$env:ProgramFiles\PackageManagement\ProviderAssemblies</code> also assuming you have them installed on your machine.</p><p>I copied the WindowsPowerShell folder and the PacakageManagement folders to a new folder on my SCCM server</p><p>In my case, my folder structure for the entire package looks like so:</p><p><div class=image><figure><a href=https://camo.githubusercontent.com/ec9b5904e323575dc980183eb46dc07aed204989/68747470733a2f2f696d6775722e636f6d2f37656a7339526f2e6a7067 target=_blank><img src=https://camo.githubusercontent.com/ec9b5904e323575dc980183eb46dc07aed204989/68747470733a2f2f696d6775722e636f6d2f37656a7339526f2e6a7067 alt="An image from Windows Explorer containing 2 folders and 2 powershell scripts"></a></figure></div></p><p>Once we have these two folders in a folder on our SCCM, we can create a package.</p><p>Now please forgive me for my terrible PS skills I&rsquo;m working on improving them!</p><p>Create a script in the same folder you put PackageManagement and WindowsPowerShell that looks like the following</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-1>1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-2>2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-3>3</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:teal>$executingScriptDirectory</span> = <span style=color:#0086b3>Split-Path</span> -Path <span style=color:teal>$MyInvocation</span>.MyCommand.Definition -Parent
</span></span><span style=display:flex><span><span style=color:#0086b3>copy-item</span> <span style=color:teal>$executingScriptDirectory</span>\PackageManagement <span style=color:teal>$env:ProgramFiles</span> -force -Recurse
</span></span><span style=display:flex><span><span style=color:#0086b3>copy-item</span> <span style=color:teal>$executingScriptDirectory</span>\WindowsPowershell <span style=color:teal>$env:ProgramFiles</span> -force -Recurse
</span></span></code></pre></td></tr></table></div></div><p>In my case, I called this script <strong>MoveItems.ps1</strong></p><p>Once you have this complete, create a package with all the content.</p><p>In your OSD task Sequence create a &ldquo;run PowerShell script&rdquo; step and reference the package you made like so:</p><p><div class=image><figure><a href=https://camo.githubusercontent.com/17cb3f713d11be996213630ba822f8b005cb446b/68747470733a2f2f696d6775722e636f6d2f6f4f43627857442e6a7067 target=_blank><img src=https://camo.githubusercontent.com/17cb3f713d11be996213630ba822f8b005cb446b/68747470733a2f2f696d6775722e636f6d2f6f4f43627857442e6a7067 alt="An image showing the properties tab of a task sequence step"></a></figure></div></p><p>Next, in your original script that&rsquo;s failing to run, you&rsquo;ll want to IMPORT those modules or packageproviders as opposed to installing them since you now have the content copied to that local machine. In my case the code looks like so: (This will look different depending on the modules you are trying to import)</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-1>1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-2>2</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#0086b3>Import-Module</span> -Name <span style=color:teal>$env:ProgramFiles</span>\WindowsPowerShell\Modules\SnipeitPS -Verbose
</span></span><span style=display:flex><span><span style=color:#0086b3>Import-PackageProvider</span> -Name <span style=color:#d14>&#34;Nuget&#34;</span> -Verbose
</span></span></code></pre></td></tr></table></div></div><p>Add another Run PowerShell script to your task sequence and reference your script with the newly added Import commands and you should be good to go! Don&rsquo;t forget to update your distribution point for the package you created!</p><p>If anyone is interested in the actual SnipeIT script feel free to come to the <a href=https://winadmins.io/>WinAdmins</a> Discord and send me a message!</p><img src=/authors/jake/avatar.png alt="Photo of Jake Shackelford"><br><strong>Jake Shackelford</strong>
<em>Admin/Contributor</em><div><a href=https://twitter.com/shackelfjaco><img src=/img/social/twitter.png></a></div><p>Jake is one of our Admins but also our inaugural author and the main reason SysManSquad exists today.</p><hr></div><comments id=comments><script src=https://utteranc.es/client.js repo=SysManSquad/sysmansquadblog issue-term=title label="blog comment" theme=github-light crossorigin=anonymous async></script></comments></article></div></div></div><footer id=footer><div class=container><div id=footer-copyright><p class=copyright>&copy; 2023 WinAdmins - https://sysmansquad.com - Systems Management Squad</a></p></div></div></footer></div></body></html>