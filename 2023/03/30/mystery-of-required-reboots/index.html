<!doctype html><html lang=en-us><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=keyword content="ConfigMgr Microsoft Intune Windows WinAdmins"><meta name=viewport content="width=device-width"><meta name=description content="A community blog and subsidiary of WinAdmins.io"><link rel="shortcut icon" href=/img/favicon.ico><title>Mystery of Required Reboots during Autopilot-SysManSquad | Systems Management Squad</title>
<link rel=canonical href=/2023/03/30/mystery-of-required-reboots/><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=https://sysmansquad.com/css/custom.css><script src=https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js></script><script src=https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js></script><script src=https://sysmansquad.com/js/jquery.slicknav.js></script><script src=https://sysmansquad.com/js/asd_SlickNav_Mobile.js></script><script src=https://sysmansquad.com/js/clipboard.js></script><script src=https://sysmansquad.com/js/custom.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-XXZR1RSQYX"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XXZR1RSQYX",{anonymize_ip:!1})}</script><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://sysmansquad.com/83"><meta name=twitter:title content="Mystery of Required Reboots during Autopilot"><meta name=twitter:description content="Businesses pay tens of thousands of $currency for Microsoft Partner consultants to come in, &ldquo;modernise&rdquo; their EUC estate, and leave behind a plethora of bugs and issues that shouldn&rsquo;t exist because said partners are supposed to be &ldquo;industry experts&rdquo;.
Completely unrelated, an issue I was working on at a client was with their Autopilot setup left behind from an MS partner that was causing a forced reboot mid-ESP. Shortly after entering company credentials, there would be a 10 minute reboot warning and no way to cancel - other than Shift+F10 and running shutdown -a which a normal end user wouldn&rsquo;t know and shouldn&rsquo;t need to know."></head><body class="home blog"><div id=asd-container><div id=top-bar><div class=container><div id=nav-wrapper><ul class=menu id=menu-top-menu><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/>Home</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/about/><span>About</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=https://github.com/SysManSquad><span>GitHub</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/jointhesquad/><span>Join the Squad</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/meetthesquad/><span>Meet the Squad</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=#><span>MORE></span></a><ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/contact/>Contact</a></li></ul></li></ul></div><div id=top-search><a href=# class=search><i class="fa fa-search"></i></a><div class=show-search><form role=search method=get action=https://www.google.com/search id=searchform><input type=search placeholder="Search and hit enter..." name=q id=q title="Search and hit enter...">
<input type=hidden name=sitesearch value=https://sysmansquad.com>
<button type=submit value=Search class=searchbutton></form></div></div><div class=menu id=menu-mobile></div></div></div><header id=header class=noslider><div class=container><div id=logo><h1><a href=https://sysmansquad.com><img src=/img/SysManSquad-HorizontalColor-Logo.png alt="Systems Management Squad"></a></h1></div></div></header><div class=container><div id=content><div id=main class=fullwidth><article class="post type-post status-publish format-standard has-post-thumbnail hentry"><div class=post-header><h1>Mystery of Required Reboots during Autopilot</h1><p class=p-meta><span class=post-author><a href=/authors/grant>Grant Dickins</a> / </span><span class=post-date>March 30, 2023 </span><span class=post-categories>/ Intune </span><span class=post-categories>/ Autopilot</span></p></div><div class=post-entry><p>Businesses pay tens of thousands of $currency for Microsoft Partner consultants to come in, &ldquo;<em>modernise</em>&rdquo; their EUC estate, and leave behind a plethora of bugs and issues that shouldn&rsquo;t exist because said partners are supposed to be &ldquo;industry experts&rdquo;.</p><p>Completely unrelated, an issue I was working on at a client was with their Autopilot setup left behind from an MS partner that was causing a forced reboot mid-ESP.
Shortly after entering company credentials, there would be a 10 minute reboot warning and no way to cancel - other than Shift+F10 and running <code>shutdown -a</code> which a normal end user wouldn&rsquo;t know and shouldn&rsquo;t need to know.<br>Unfortunately, if the reboot continued, it often left the device in a boot-loop. The build engineer at the time didn&rsquo;t know any other way to break out of it other than rebuild from vanilla Windows media.</p><p>This was the first time I&rsquo;d ever come across the issue, but didn&rsquo;t take long to find other people with the same issue online.<br>The reboot was caused by a Configuration Profile for Endpoint Protection that turned on WDAC in Audit Mode.<div class=image><figure><a href=WDAC_Auditmode.png target=_blank><img src=WDAC_Auditmode.png alt></a></figure></div></p><p>There are various notes on <a href=https://learn.microsoft.com/en-us/windows/security/threat-protection/windows-defender-application-control/deployment/deploy-windows-defender-application-control-policies-using-intune#use-intunes-built-in-policies>Microsoft Learn: Deploy WDAC policies with MDM</a> about issues and caveats with WDAC policies. One specifically about forced reboots:</p><blockquote><p>Intune currently uses the AppLocker CSP to deploy its built-in policies. The AppLocker CSP will always request a reboot when applying WDAC policies. You can use Intune&rsquo;s custom OMA-URI feature with the ApplicationControl CSP to deploy your own WDAC policies rebootlessly.</p></blockquote><p>I have since fixed the issue now with a custom OMA. But a few weeks later, a colleague shared a <a href=https://nitter.net/BruceSaaaa/status/1632851267968983041>twitter post</a> where the guy was having reboots mid-autopilot also.</p><p><a href=https://nitter.net/SCCMentor title="Paul Winstanley - MVP">Paul Winstanley</a> and <a href=https://nitter.net/MMelkersen title="Mattias Melkersen {MVP}">Mattias Melkersen</a> both pointed out in the thread that there is a nice list of OMA-URIs which will always cause reboots when applied, and it&rsquo;s available in the registry for all to see:
<code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Provisioning\SyncML\RebootRequiredURIs</code></p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-23>23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-24>24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-25>25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-26>26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-27>27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-28>28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-29>29</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-30>30</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-31>31</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-32>32</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-33>33</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-34>34</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>RebootRequiredURIs
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>./Device/Vendor/MSFT/Accounts/Domain/ComputerName
</span></span><span style=display:flex><span>./Device/Vendor/MSFT/Policy/Config/Connectivity/AllowUSBConnection
</span></span><span style=display:flex><span>./Device/Vendor/MSFT/Policy/Config/DeviceGuard/ConfigureSystemGuardLaunch
</span></span><span style=display:flex><span>./Device/Vendor/MSFT/Policy/Config/DeviceGuard/EnableVirtualizationBasedSecurity
</span></span><span style=display:flex><span>./Device/Vendor/MSFT/Policy/Config/DeviceGuard/LsaCfgFlags
</span></span><span style=display:flex><span>./Device/Vendor/MSFT/Policy/Config/DeviceGuard/RequirePlatformSecurityFeatures
</span></span><span style=display:flex><span>./Device/Vendor/MSFT/Policy/Config/DmaGuard/DeviceEnumerationPolicy
</span></span><span style=display:flex><span>./Device/Vendor/MSFT/Policy/Config/ExploitGuard/ExploitProtectionSettings
</span></span><span style=display:flex><span>./Device/Vendor/MSFT/Policy/Config/MixedReality/HeadTrackingMode
</span></span><span style=display:flex><span>./Device/Vendor/MSFT/Policy/Config/Notifications/DisallowCloudNotification
</span></span><span style=display:flex><span>./Device/Vendor/MSFT/Policy/Config/Notifications/DisallowTileNotification
</span></span><span style=display:flex><span>./Device/Vendor/MSFT/Policy/Config/Notifications/WnsEndpoint
</span></span><span style=display:flex><span>./Device/Vendor/MSFT/Policy/Config/ServiceControlManager/SvchostProcessMitigation
</span></span><span style=display:flex><span>./Device/Vendor/MSFT/Policy/Config/Start/HideChangeAccountSettings
</span></span><span style=display:flex><span>./Device/Vendor/MSFT/Policy/Config/Start/HideHibernate
</span></span><span style=display:flex><span>./Device/Vendor/MSFT/Policy/Config/Start/HideLock
</span></span><span style=display:flex><span>./Device/Vendor/MSFT/Policy/Config/Start/HidePowerButton
</span></span><span style=display:flex><span>./Device/Vendor/MSFT/Policy/Config/Start/HideRestart
</span></span><span style=display:flex><span>./Device/Vendor/MSFT/Policy/Config/Start/HideShutDown
</span></span><span style=display:flex><span>./Device/Vendor/MSFT/Policy/Config/Start/HideSignOut
</span></span><span style=display:flex><span>./Device/Vendor/MSFT/Policy/Config/Start/HideSleep
</span></span><span style=display:flex><span>./Device/Vendor/MSFT/Policy/Config/Start/HideSwitchAccount
</span></span><span style=display:flex><span>./Device/Vendor/MSFT/Policy/Config/Start/HideUserTile
</span></span><span style=display:flex><span>./Device/Vendor/MSFT/Policy/Config/Start/ImportEdgeAssets
</span></span><span style=display:flex><span>./Device/Vendor/MSFT/Policy/Config/Update/ManagePreviewBuilds
</span></span><span style=display:flex><span>./Device/Vendor/MSFT/Uefi/Identity/Apply
</span></span><span style=display:flex><span>./Device/Vendor/MSFT/Uefi/Identity2/Apply
</span></span><span style=display:flex><span>./Device/Vendor/MSFT/Uefi/Permissions/Apply
</span></span><span style=display:flex><span>./Device/Vendor/MSFT/Uefi/Permissions2/Apply
</span></span><span style=display:flex><span>./Device/Vendor/MSFT/Uefi/Settings/Apply
</span></span><span style=display:flex><span>./Device/Vendor/MSFT/Uefi/Settings2/Apply
</span></span><span style=display:flex><span>./Device/Vendor/MSFT/WindowsDefenderApplicationGuard/InstallWindowsDefenderApplicationGuard
</span></span></code></pre></td></tr></table></div></div><p>Obviously, in my case, the offending reboot would have been caused by: <code>./Device/Vendor/MSFT/WindowsDefenderApplicationGuard/InstallWindowsDefenderApplicationGuard</code></p><p>Mystery solved!</p><img src=/authors/grant/avatar.png alt="Photo of Grant Dickins"><br><strong>Grant Dickins</strong>
<em>Contributor</em><div><a href=https://twitter.com/_G_rant><img src=/img/social/twitter.png></a></div><p>Grant has worked supporting IT in the Oil & Gas industry for 10 years, has a keen interest in Config Manager and trying to bring the industry kicking and screaming into the modern cloud-based world.</p><hr></div><comments id=comments><script src=https://utteranc.es/client.js repo=SysManSquad/sysmansquadblog issue-term=title label="blog comment" theme=github-light crossorigin=anonymous async></script></comments></article></div></div></div><footer id=footer><div class=container><div id=footer-copyright><p class=copyright>&copy; 2023 WinAdmins - https://sysmansquad.com - Systems Management Squad</a></p></div></div></footer></div></body></html>