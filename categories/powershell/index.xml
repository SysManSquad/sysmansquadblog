<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Powershell on Systems Management Squad</title><link>https://sysmansquad.com/categories/powershell/</link><description>Recent content in Powershell on Systems Management Squad</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Tue, 09 Aug 2022 13:59:21 +0000</lastBuildDate><atom:link href="https://sysmansquad.com/categories/powershell/index.xml" rel="self" type="application/rss+xml"/><item><title>Who Is Logged On, From The System Context</title><link>https://sysmansquad.com/2022/08/09/which-user-is-logged-in-when-running-as-system/</link><pubDate>Tue, 09 Aug 2022 13:59:21 +0000</pubDate><guid>https://sysmansquad.com/2022/08/09/which-user-is-logged-in-when-running-as-system/</guid><description>Intro Have you ever deployed a script that needs to be executed in the system context, but you also need to work with something that is currently running in the user context?
Obviously you could just loop through all the user profiles on the system, but thats not always a good idea.
Lo and behold, you can simply see who is the owner of the explorer.exe process and use that, Obviously this will not work if no one is logged on.</description></item><item><title>Using PowerShell and Graph to update Azure AD user photos in bulk</title><link>https://sysmansquad.com/2021/12/03/2021-12-03-using-powershell-and-graph-to-update-azure-ad-user-photos-in-bulk/</link><pubDate>Fri, 03 Dec 2021 00:00:00 +0000</pubDate><guid>https://sysmansquad.com/2021/12/03/2021-12-03-using-powershell-and-graph-to-update-azure-ad-user-photos-in-bulk/</guid><description>Introduction In this post, I‚Äôll give you some background information and show you how to utilize the Microsoft Graph API to bulk update Azure AD user photos. If you‚Äôd like to skip the background information and get straight to the nitty-gritty, click here.
Background I work at a private K-12 school in the United States. Like many schools out there, we have scheduled portraits once a year for students and staff.</description></item><item><title>Setting Environmental Variables with Intune and proactive remediations</title><link>https://sysmansquad.com/2021/07/02/setting-environmental-variables-with-intune-and-proactive-remediations/</link><pubDate>Fri, 02 Jul 2021 05:24:25 +0000</pubDate><guid>https://sysmansquad.com/2021/07/02/setting-environmental-variables-with-intune-and-proactive-remediations/</guid><description>As you may have noticed by now, there doesn&amp;rsquo;t seem to be any nice built in way to set environmental variables in intune üôÅ
The Problem Setting a user environmental variable using powershell is an easy task to accomplish, you basically just run the following:
1 Set-ItemProperty -Path HKCU:\Environment -Name temp -Value &amp;#34;c:\temp\&amp;#34; This works just fine, but won&amp;rsquo;t take effect until the user either reboots or signs into the device again.</description></item><item><title>Setting A Default Outlook Signature in Outlook using Intune Proactive Remediations</title><link>https://sysmansquad.com/2021/06/18/setting-a-default-outlook-signature-in-outlook-using-intune-proactive-remediations/</link><pubDate>Fri, 18 Jun 2021 12:37:50 +0000</pubDate><guid>https://sysmansquad.com/2021/06/18/setting-a-default-outlook-signature-in-outlook-using-intune-proactive-remediations/</guid><description>So you have already figured out how to dynamically generated outlook signatures, but now you want to make sure that people actually use them. but without preventing the use of other signatures your users might have.
Well it just so happens that I have a solution for you!
No default signature has been set
To do all this, we create a new Proactive Remediation in Intune.
Add the detection and remediations scripts from below, and set it to run as the user.</description></item><item><title>Where is the report‚Äôs data??</title><link>https://sysmansquad.com/2021/05/15/where-is-the-reports-data/</link><pubDate>Sun, 16 May 2021 03:21:09 +0000</pubDate><guid>https://sysmansquad.com/2021/05/15/where-is-the-reports-data/</guid><description>Have you ever looked at a report on a Portal Page and wanted to know just WHERE the data just came from?
Well you can - and finding the information can be so easy. Read on below to see how.
Introduction Take for example this report on a Proactive Remediation. I used one of the built in Proactive Remediations for the example, but it could easily be one of our other Proactive Remediation posts, like Dynamic Outlook Signatures, Building VPN Connections, or Repairing Folder permissions.</description></item><item><title>Updated Modern Driver/BIOS Management with CMG Support</title><link>https://sysmansquad.com/2021/04/27/updated-modern-driver-bios-management-with-cmg-support/</link><pubDate>Wed, 28 Apr 2021 03:04:02 +0000</pubDate><guid>https://sysmansquad.com/2021/04/27/updated-modern-driver-bios-management-with-cmg-support/</guid><description>Hello,
This is a long and overdue update on a solution I started working on last year to allow my organization to use the modern driver management solution without the need of the custom webservice. I also wanted the solution to use the built-in task sequence steps as much as possible to allow other administrators to customize the solution to their need without the need to go modify a big PowerShell script.</description></item><item><title>Keeping Up with Distribution Points</title><link>https://sysmansquad.com/2021/02/17/keeping-up-with-distribution-points/</link><pubDate>Wed, 17 Feb 2021 15:24:30 +0000</pubDate><guid>https://sysmansquad.com/2021/02/17/keeping-up-with-distribution-points/</guid><description>Distribution Points are great, but they can often be a huge annoyance. Getting content distributed is one thing, but then making sure it STAYS distributed, and old things are getting cleaned up, and making sure all the content hashes are correct, etc. It‚Äôs easy to feel like you‚Äôre constantly drowning in a sea of DP warnings and errors.
Luckily, there‚Äôs some simple things we can do to take this burden away.</description></item><item><title>Trigger Teams Installer for User After Machine Wide Installer</title><link>https://sysmansquad.com/2021/01/26/trigger-teams-installer-for-user-after-machine-wide-installer/</link><pubDate>Tue, 26 Jan 2021 12:30:17 +0000</pubDate><guid>https://sysmansquad.com/2021/01/26/trigger-teams-installer-for-user-after-machine-wide-installer/</guid><description>The Problem: Teams Machine Wide Installer finishes&amp;hellip; Then&amp;hellip; Nothing? Have you or a loved one ever deployed Microsoft Teams in an enterprise environment? Did the users complain? Did project management complain? Management? You?
I&amp;rsquo;m sure someone was not happy about the overall user experience. In particular when the Teams Machine Wide installer is finished, and detected by your application management tool of choice it does&amp;hellip; nothing. The user is left with a message claiming Teams is &amp;lsquo;Installed&amp;rsquo; when clearly it is not.</description></item><item><title>Finding Azure Virtual Machines in Configuration Manager</title><link>https://sysmansquad.com/2021/01/05/finding-azure-virtual-machines-in-configuration-manager/</link><pubDate>Wed, 06 Jan 2021 05:04:40 +0000</pubDate><guid>https://sysmansquad.com/2021/01/05/finding-azure-virtual-machines-in-configuration-manager/</guid><description>A request came in from my System Admin group to push certain policies only to VMs hosted in Azure. Currently, they had a naming convention being used (well, supposed to be used) to simply prefix the hostname with AZ-, but they came across a couple Domain Controllers that hadn&amp;rsquo;t installed Updates in 7+ months, and of course the names didn&amp;rsquo;t follow the accepted standard.
So I started looking for ways to identify Azure devices definitively and came across this Detect Windows Azure Virtual Machine post, which led to reading the Azure Metadata Service docs, and eventually got me to turn this into a Configuration Item / Configuration Baseline and subsequent Device Collections.</description></item><item><title>Automating Outside of Business Hours Responses</title><link>https://sysmansquad.com/2020/12/30/automating-changing-out-of-business-hours-responses/</link><pubDate>Wed, 30 Dec 2020 19:20:15 +0000</pubDate><guid>https://sysmansquad.com/2020/12/30/automating-changing-out-of-business-hours-responses/</guid><description>Have you ever had customers emailing in outside of hours? In this post we will setup some scripted automatic maintenance of Auto-Reply responses on a user account.
We considered several possibilities but the customer did not have an Azure Subscription yet, we ended up using PowerShell, Microsoft Graph, App Authentication, and a Scheduled Task.
Our customer will be moving to Azure later so we will probably revisit this as Azure Functions, or possibly Power Automate later on.</description></item><item><title>Mapping Network Drives on Intune Devices</title><link>https://sysmansquad.com/2020/12/16/mapping-network-drives-on-intune-devices/</link><pubDate>Wed, 16 Dec 2020 19:04:49 +0000</pubDate><guid>https://sysmansquad.com/2020/12/16/mapping-network-drives-on-intune-devices/</guid><description>This guide is part of a video series companion guide on setting up mapped drives on Intune devices - you can watch the video here S02E18 How to Map Network Drives on Microsoft Intune Devices - (I.T)! This is rather simple but I will be adding some useful bits of code for people who do not have an always on VPN solution for all those Work From Home scenarios.
Creating the script Before we get started let me explain how this process works.</description></item><item><title>Give your ADR a little boost with Status Filter Rules and PowerShell</title><link>https://sysmansquad.com/2020/12/08/give-your-adr-a-little-boost-with-status-filter-rules-and-powershell/</link><pubDate>Tue, 08 Dec 2020 09:16:43 +0000</pubDate><guid>https://sysmansquad.com/2020/12/08/give-your-adr-a-little-boost-with-status-filter-rules-and-powershell/</guid><description>Introduction MEMCM already offers a lot of features to help SysAdmins automate many processes and save them a lot of time to drink more coffee‚òï work on less mundane and more interesting tasks.
Among them, there are Automatic Deployment Rules (ADR) that let you automate patch management for your Windows devices. There are also Status Filter Rules that allow you to execute actions (Launch a program, execute a script‚Ä¶) when specific status messages are processed by the site server.</description></item><item><title>Find Microsoft Accounts on Company Domains</title><link>https://sysmansquad.com/2020/11/23/find-microsoft-accounts/</link><pubDate>Mon, 23 Nov 2020 15:00:00 +0000</pubDate><guid>https://sysmansquad.com/2020/11/23/find-microsoft-accounts/</guid><description>The other day I was helping someone over in the WinAdmins Discord. Their users kept getting confused about what their passwords were, and it was causing a lot of HelpDesk tickets. Let&amp;rsquo;s find out what users have Microsoft accounts on the company domain so we can help move those accounts elsewhere to streamline the user experience.
Update on Prevention: Microsoft has introduced some changes that at least seem to prevent NEW Microsoft Accounts on Company Domains.</description></item><item><title>Manage Distribution Point Content Using PSCMContentMgmt</title><link>https://sysmansquad.com/2020/09/04/manage-distribution-point-content-using-pscmcontentmgmt/</link><pubDate>Fri, 04 Sep 2020 21:59:36 +0000</pubDate><guid>https://sysmansquad.com/2020/09/04/manage-distribution-point-content-using-pscmcontentmgmt/</guid><description>Introduction I recently wrote PSCMContentMgmt which provides a simple and effective workflow for managing your MEMCM distribution points. Here are some of the things you can do with it:
Query content objects which are distributed to distribution point(s) or distribution point group(s) Compare content objects distributed to distribution point(s) or distribution point group(s) Find content objects in a &amp;ldquo;distribution failed&amp;rdquo; state for all or selective distribution points Remove, distribute or redistribute content objects returned by any function to distribution point(s) Find an object in your site by searching on any arbitrary ID (useful when reading logs and want to know what object an ID resolves to) Migrate a distribution point&amp;rsquo;s content to a new/different distribution point by exporting its content library to prestaged .</description></item><item><title>Getting Reboot History and Optimizing Legacy Functions</title><link>https://sysmansquad.com/2020/08/28/getting-reboot-history-and-optimizing-legacy-functions/</link><pubDate>Fri, 28 Aug 2020 14:00:00 +0000</pubDate><guid>https://sysmansquad.com/2020/08/28/getting-reboot-history-and-optimizing-legacy-functions/</guid><description>The other day, I logged on to a jump server and, while investigating an unrelated issue, I noticed the BG Info background showed the Last Reboot as March 1st, 2020. &amp;ldquo;That can&amp;rsquo;t be right,&amp;rdquo; I thought. &amp;ldquo;We have weekly maintenance windows to reboot these servers.&amp;rdquo;
As I opened an old stand-by function from my stash (originally posted here: https://gallery.technet.microsoft.com/scriptcenter/Get-RebootHistory-bc804819 in 2015) and ran it, I was a bit annoyed at how SLOW it was.</description></item><item><title>Bulk Updating Autopilot enrolled devices with Graph API and assigning a Group Tag based on Purchase OrderID</title><link>https://sysmansquad.com/2020/08/24/bulk-updating-autopilot-enrolled-devices-with-graph-api-and-assigning-a-group-tag-based-on-purchase-orderid/</link><pubDate>Mon, 24 Aug 2020 14:31:46 +0000</pubDate><guid>https://sysmansquad.com/2020/08/24/bulk-updating-autopilot-enrolled-devices-with-graph-api-and-assigning-a-group-tag-based-on-purchase-orderid/</guid><description>The Problem For any new machines ordered from a vendor such as Dell that get enrolled into Autopilot you get the basic device info enrolled but nothing defining that would let it get auto-enrolled into a dynamic group easily. Purchase Order ID is included in every order we receive from Dell however I don&amp;rsquo;t want to have to add that Purchase Order ID into the dynamic device query every time a new machine gets added.</description></item><item><title>Setting ACL using Intune Endpoint Analytics Proactive Remediations</title><link>https://sysmansquad.com/2020/07/27/setting-acl-using-intune-endpoint-analytics-proactive-remediations/</link><pubDate>Mon, 27 Jul 2020 14:56:26 +0000</pubDate><guid>https://sysmansquad.com/2020/07/27/setting-acl-using-intune-endpoint-analytics-proactive-remediations/</guid><description>Namaste y&amp;rsquo;all! In todays Siri dictated blog post, I will show you how you can configure access control lists (ACL) for a directory using Intune Proactive remediations.
The issue I was facing was that regular users do not have modify permissions to the public desktop on their corporate devices, meaning that the user is unable to remove annoying shortcuts that would get placed there by the various apps they install. While this is hardly a high priority task to solve.</description></item><item><title>Dynamic Outlook Email Signature Using with Intune Endpoint Analytics Proactive Remediations</title><link>https://sysmansquad.com/2020/07/08/dynamic-outlook-email-signature-using-with-intune-endpoint-analytics-proactive-remediations/</link><pubDate>Thu, 09 Jul 2020 03:09:31 +0000</pubDate><guid>https://sysmansquad.com/2020/07/08/dynamic-outlook-email-signature-using-with-intune-endpoint-analytics-proactive-remediations/</guid><description>Howdy y&amp;rsquo;all!
Since you have already read se√±or Shackelfords blog post on setting up Endpoint Analytics Proactive remediations, we can skip the intro and dive right in.
In this blog post we will be get familiar with a somewhat novel idea that proactive remediation&amp;rsquo;s can be used for. Which, as the title of this post suggests, is the creation of a dynamic email signature in the form of a .html file using Microsoft Graph.</description></item><item><title>Intune/Autopilot Proactive Remediation</title><link>https://sysmansquad.com/2020/07/07/intune-autopilot-proactive-remediation/</link><pubDate>Tue, 07 Jul 2020 16:24:57 +0000</pubDate><guid>https://sysmansquad.com/2020/07/07/intune-autopilot-proactive-remediation/</guid><description>What is Proactive Remediation? Proactive remediations are a pair of scripts used to detect and remediate a problem on a machine. The first script runs a query on your endpoints that returns an exit code of success or failure. We call this first script the detection script. On a successful exit code it is reported as &amp;ldquo;Without issue&amp;rdquo; in the Intune portal and nothing else is executed. On a failed exit code the second script is run which is called a remediation script.</description></item><item><title>Build a ConfigrMgr lab with AutomatedLab</title><link>https://sysmansquad.com/2020/06/15/build-a-configrmgr-lab-with-automatedlab/</link><pubDate>Mon, 15 Jun 2020 06:00:00 +0000</pubDate><guid>https://sysmansquad.com/2020/06/15/build-a-configrmgr-lab-with-automatedlab/</guid><description>In this post I&amp;rsquo;ll show you how to start building a ConfigMgr lab, for either Current Branch or Technical Preview, using AutomatedLab with Hyper-V. This approach is intended to be completely automated and &amp;ldquo;hands off&amp;rdquo; by calling a single script.
It downloads all the necessary files for you, including the CB or TP installation media. All you have to do is provide a Windows Server 2016/2019 ISO, but this can also be an evaluation copy.</description></item><item><title>Getting started with AutomatedLab</title><link>https://sysmansquad.com/2020/06/15/getting-started-with-automatedlab/</link><pubDate>Mon, 15 Jun 2020 06:00:00 +0000</pubDate><guid>https://sysmansquad.com/2020/06/15/getting-started-with-automatedlab/</guid><description>What is AutomatedLab? AutomatedLab is simply PowerShell module. In some ways it‚Äôs a framework because it encourages a particular workflow for managing named labs consisting of VMs with prefined applications / ‚Äúroles‚Äù or custom roles.
The benefit using AutomatedLab is the simplicity it offers to quickly fire up and throw away environments, and rebuild again. It also offers a huge range of functions to build out whatever you want.
Generally, the workflow goes something like:</description></item><item><title>Deploy languages via Software Center with PSCMWin10Language</title><link>https://sysmansquad.com/2020/06/08/deploy-languages-via-software-center-with-pscmwin10language/</link><pubDate>Mon, 08 Jun 2020 15:00:00 +0000</pubDate><guid>https://sysmansquad.com/2020/06/08/deploy-languages-via-software-center-with-pscmwin10language/</guid><description>This post complements my other post, where I walk-through the differences of LP, LIP, LXP and FoD.
Here I will show you how to use a PowerShell module I wrote, PSCMWin10Languages, to create Microsoft Endpoint Manager Configuration Manager Applications for each language you want to deploy via the Software Center.
These Applications are not for OSD. It changes the language only for the user who installs the Application via the Software Center.</description></item><item><title>ARM (Azure Resource Manager) Templating for Windows Virtual Desktop</title><link>https://sysmansquad.com/2020/05/26/arm-azure-resource-manager-templating-for-windows-virtual-desktop/</link><pubDate>Tue, 26 May 2020 12:56:38 +0000</pubDate><guid>https://sysmansquad.com/2020/05/26/arm-azure-resource-manager-templating-for-windows-virtual-desktop/</guid><description>Why would I use ARM templating, isn&amp;rsquo;t the default Image Gallery fine? Well first off, what is ARM Templating? According to Microsoft &amp;ldquo;You can automate deployments and use the practice of infrastructure as code. In code, you define the infrastructure that needs to be deployed. The infrastructure code becomes part of your project. Just like application code, you store the infrastructure code in a source repository and version it&amp;hellip;&amp;rdquo;
What does all that mean?</description></item><item><title>NET-103 : Layering in Active Directory</title><link>https://sysmansquad.com/2020/05/19/net-103-layering-in-active-directory/</link><pubDate>Tue, 19 May 2020 14:00:00 +0000</pubDate><guid>https://sysmansquad.com/2020/05/19/net-103-layering-in-active-directory/</guid><description>Joe Ravi / CC BY-SA https://creativecommons.org/licenses/by-sa/3.0 In previous articles, we&amp;rsquo;ve built the basic services you need without getting too far in the weeds. Now we&amp;rsquo;re going to layer in a central identity service.
It&amp;rsquo;s also hopefully going to be a lot shorter than previous articles, though I can&amp;rsquo;t make any promises - these things tend to all start small, then balloon rapidly.
If you&amp;rsquo;re continuing from NET-102 you&amp;rsquo;ll already have the following machines:</description></item><item><title>Modern Driver Management with the Administration Service</title><link>https://sysmansquad.com/2020/05/15/modern-driver-management-with-the-administration-service/</link><pubDate>Fri, 15 May 2020 14:39:20 +0000</pubDate><guid>https://sysmansquad.com/2020/05/15/modern-driver-management-with-the-administration-service/</guid><description>2021-04-27 update: The solution now works over CMG. Please see this post for details.
Hello!
Today I‚Äôd like to share with you a new solution I‚Äôve developed to allow me to use the free Modern Driver Management solution from the team at MSEndpointMgr at my work. My goal is to use the process developed by them for managing drivers in a task sequence and convert it to use the ConfigMgr Administration Service since my company won&amp;rsquo;t allow me to install their third-party web service.</description></item><item><title>Teams Channel Notification when OSD Fails</title><link>https://sysmansquad.com/2020/04/22/teams-channel-notification-when-osd-fails/</link><pubDate>Wed, 22 Apr 2020 13:00:00 +0000</pubDate><guid>https://sysmansquad.com/2020/04/22/teams-channel-notification-when-osd-fails/</guid><description>How would you like this lovely notification appearing within MS Teams every time a build failed? Better than getting a helpdesk ticket or not finding out at all.
Well, now you can!
Removed broken screenshot - editor
Step 1 - Configure Teams You need to make sure your O365 Administrator has enabled Incoming webhooks connectors in your O365 Tenant.
Open Teams. Select a channel, or create a new channel specific for these notifications (This is best practice so normal channels are not spammed) Click the &amp;hellip; Next to the channel name and choose Connectors Removed broken screenshot - editor</description></item><item><title>Inventory Deprovisioned Windows 10 Apps</title><link>https://sysmansquad.com/2020/03/11/inventory-deprovisioned-windows-10-apps/</link><pubDate>Wed, 11 Mar 2020 14:00:00 +0000</pubDate><guid>https://sysmansquad.com/2020/03/11/inventory-deprovisioned-windows-10-apps/</guid><description>In my previous post I&amp;rsquo;ve shown that we can revert the deprovisioning of Windows 10 apps. This is awesome news for anyone that has removed the Windows Store. I have been unable to find any other way of restoring the Windows Store once it has been deprovisioned, so this is an awesome time saver. Instead of reimaging devices that do not have the store we can simply &amp;lsquo;reprovision&amp;rsquo; the store, and perform a feature update!</description></item><item><title>NET-102: Build your lab</title><link>https://sysmansquad.com/2020/01/23/net-102-build-your-lab/</link><pubDate>Thu, 23 Jan 2020 07:13:45 +0000</pubDate><guid>https://sysmansquad.com/2020/01/23/net-102-build-your-lab/</guid><description>Welcome back! We&amp;rsquo;re now going to move on to the actual effort it takes to build your lab. As you recall we got pretty far last time in documenting the beginnings of our network. For this lab I&amp;rsquo;ll be using VMWare Workstation, but you can accomplish this with Microsoft Hyper-V, Oracle VirtualBox, the free tier of VMWare&amp;rsquo;s ESX, or XCP-NG.
If you haven&amp;rsquo;t read the previous post, please have a look here as each post builds upon the last.</description></item><item><title>Reprovision Windows 10 Apps‚Ä¶ Wait, What?</title><link>https://sysmansquad.com/2021/01/06/reprovision-windows-10-apps-wait-what/</link><pubDate>Mon, 06 Jan 2020 13:54:48 +0000</pubDate><guid>https://sysmansquad.com/2021/01/06/reprovision-windows-10-apps-wait-what/</guid><description>Remember when we all complained that Microsoft &amp;ldquo;wasn&amp;rsquo;t respecting our app removals!&amp;rdquo; and they were all reinstalled during every feature update? Pepperidge farm remembers. Well, Microsoft was kind enough to hear our collective complaints, and take action on them. That is an awesome quality that we are seeing from the product teams at Microsoft.
Starting in Windows 10 1803, deprovisioned apps will NOT be reinstalled during a feature update. No more Solitaire returning from the dead every time we try to &amp;ldquo;Get current and stay current.</description></item><item><title>How to use modules and package providers during OSD with MECM (SCCM/MEMCM)</title><link>https://sysmansquad.com/2019/12/12/how-to-use-modules-and-package-providers-during-osd-with-mecm-sccm-memcm/</link><pubDate>Thu, 12 Dec 2019 15:53:40 +0000</pubDate><guid>https://sysmansquad.com/2019/12/12/how-to-use-modules-and-package-providers-during-osd-with-mecm-sccm-memcm/</guid><description>For the past few days, I&amp;rsquo;ve been implementing SnipeIT into our environment to start actually tracking assets as opposed to the archaic spreadsheet we had going. I wanted to add any new machine that were imaged into the database right away without any input from me. That way, all I had to do was assign a user to the device in the asset management portal for SnipeIT, and I was good to go.</description></item></channel></rss>