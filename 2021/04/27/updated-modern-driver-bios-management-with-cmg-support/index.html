<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=keyword content="ConfigMgr Microsoft Intune Windows WinAdmins">
<meta name=viewport content="width=device-width">
<meta name=description content="A community blog and subsidiary of WinAdmins.io">
<link rel="shortcut icon" href=/img/favicon.ico>
<title>Updated Modern Driver/BIOS Management with CMG Support-SysManSquad | Systems Management Squad</title>
<link rel=canonical href=/2021/04/27/updated-modern-driver-bios-management-with-cmg-support/>
<link rel=stylesheet href=/css/style.css>
<link rel=stylesheet href=https://www.sysmansquad.com/css/custom.css>
<script src=https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js></script>
<script src=https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js></script>
<script src=https://www.sysmansquad.com/js/jquery.slicknav.js></script>
<script src=https://www.sysmansquad.com/js/asd_SlickNav_Mobile.js></script>
<script src=https://www.sysmansquad.com/js/custom.js></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XXZR1RSQYX"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-XXZR1RSQYX',{anonymize_ip:!1})}</script>
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://www.sysmansquad.com/83">
<meta name=twitter:title content="Updated Modern Driver/BIOS Management with CMG Support">
<meta name=twitter:description content="<li class=&#34;uagb-toc__list&#34;> <a href=&#34;#improvements-to-invoke-getpackageidfromadminservice&#34;>Improvements to Invoke-GetPackageIDFromAdminService</a><ul class=&#34;uagb-toc__list&#34;> <li class=&#34;uagb-toc__list&#34;> <a href=&#34;#1-new-parameters-and-parametersets&#34;>1) New parameters and ParameterSets</a><li class=&#34;uagb-toc__list&#34;> <li class=&#34;uagb-toc__list&#34;> <a href=&#34;#2-verify-install-and-import-the-msalps-module&#34;>2) Verify, Install and Import the MSAL.PS module</a><li class=&#34;uagb-toc__list&#34;> <li class=&#34;uagb-toc__list&#34;> <a href=&#34;#3-querying-the-adminservice&#34;>3) Querying the AdminService</a> </li></ul> </li></ul> </li></ul> </li> <li class=&#34;uagb-toc__list&#34;> <a href=&#34;#improvements-to-the-task-sequence&#34;>Improvements to the task sequence</a><ul class=&#34;uagb-toc__list&#34;> <li class=&#34;uagb-toc__list&#34;> <a href=&#34;#1-is-the-client-on-internet&#34;>1) Is the client on Internet?</a><li class=&#34;uagb-toc__list&#34;> <li class=&#34;uagb-toc__list&#34;> <a href=&#34;#2-additional-parameters-for-internet-clients&#34;>2) Additional Parameters for Internet clients</a><li class=&#34;uagb-toc__list&#34;> <li class=&#34;uagb-toc__list&#34;> <a href=&#34;#3-running-the-script-with-the-right-parameters&#34;>3) Running the script with the right parameters</a> </li></ul> </li></ul> </li></ul> </li></ul> </li> <li class=&#34;uagb-toc__list&#34;> <a href=&#34;#the-end-result&#34;>The end result</a><li class=&#34;uagb-toc__list&#34;> <a href=&#34;#how-do-i-set-this-up-in-my-environment&#34;>How do I set this up in my environment?">
</head>
<body class="home blog">
<div id=asd-container>
<div id=top-bar>
<div class=container>
<div id=nav-wrapper>
<ul class=menu id=menu-top-menu>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/>Home</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/about/>
<span>About</span>
</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=https://github.com/SysManSquad>
<span>GitHub</span>
</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/jointhesquad/>
<span>Join the Squad</span>
</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/meetthesquad/>
<span>Meet the Squad</span>
</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=#>
<span>MORE></span>
</a>
<ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/contact/>Contact</a>
</li>
</ul>
</li>
</ul>
</div>
<div id=top-search>
<a href=# class=search><i class="fa fa-search"></i></a>
<div class=show-search>
<form role=search method=get action=https://www.google.com/search id=searchform>
<input type=search placeholder="Search and hit enter..." name=q id=q title="Search and hit enter...">
<input type=hidden name=sitesearch value=https://www.sysmansquad.com>
<button type=submit value=Search>
</form>
</div>
</div>
<div class=menu id=menu-mobile></div>
</div>
</div>
<header id=header class=noslider>
<div class=container>
<div id=logo>
<h1><a href=https://www.sysmansquad.com><img src=/img/SysManSquad-HorizontalColor-Logo.png alt="Systems Management Squad"></a></h1>
</div>
</div>
</header>
<div class=container>
<div id=content>
<div id=main class=fullwidth>
<article class="post type-post status-publish format-standard has-post-thumbnail hentry">
<div class=post-header>
<h1>Updated Modern Driver/BIOS Management with CMG Support</h1>
<span class=post-date>April 28, 2021</span>
</div>
<div class=post-entry>
<pre><code>        &lt;li class=&quot;uagb-toc__list&quot;&gt;
          &lt;a href=&quot;#improvements-to-invoke-getpackageidfromadminservice&quot;&gt;Improvements to Invoke-GetPackageIDFromAdminService&lt;/a&gt;&lt;ul class=&quot;uagb-toc__list&quot;&gt;
            &lt;li class=&quot;uagb-toc__list&quot;&gt;
              &lt;a href=&quot;#1-new-parameters-and-parametersets&quot;&gt;1) New parameters and ParameterSets&lt;/a&gt;&lt;li class=&quot;uagb-toc__list&quot;&gt;
                &lt;li class=&quot;uagb-toc__list&quot;&gt;
                  &lt;a href=&quot;#2-verify-install-and-import-the-msalps-module&quot;&gt;2) Verify, Install and Import the MSAL.PS module&lt;/a&gt;&lt;li class=&quot;uagb-toc__list&quot;&gt;
                    &lt;li class=&quot;uagb-toc__list&quot;&gt;
                      &lt;a href=&quot;#3-querying-the-adminservice&quot;&gt;3) Querying the AdminService&lt;/a&gt;
                    &lt;/li&gt;&lt;/ul&gt;
                  &lt;/li&gt;&lt;/ul&gt;
                &lt;/li&gt;&lt;/ul&gt;
              &lt;/li&gt;
              &lt;li class=&quot;uagb-toc__list&quot;&gt;
                &lt;a href=&quot;#improvements-to-the-task-sequence&quot;&gt;Improvements to the task sequence&lt;/a&gt;&lt;ul class=&quot;uagb-toc__list&quot;&gt;
                  &lt;li class=&quot;uagb-toc__list&quot;&gt;
                    &lt;a href=&quot;#1-is-the-client-on-internet&quot;&gt;1) Is the client on Internet?&lt;/a&gt;&lt;li class=&quot;uagb-toc__list&quot;&gt;
                      &lt;li class=&quot;uagb-toc__list&quot;&gt;
                        &lt;a href=&quot;#2-additional-parameters-for-internet-clients&quot;&gt;2) Additional Parameters for Internet clients&lt;/a&gt;&lt;li class=&quot;uagb-toc__list&quot;&gt;
                          &lt;li class=&quot;uagb-toc__list&quot;&gt;
                            &lt;a href=&quot;#3-running-the-script-with-the-right-parameters&quot;&gt;3) Running the script with the right parameters&lt;/a&gt;
                          &lt;/li&gt;&lt;/ul&gt;
                        &lt;/li&gt;&lt;/ul&gt;
                      &lt;/li&gt;&lt;/ul&gt;
                    &lt;/li&gt;&lt;/ul&gt;
                  &lt;/li&gt;
                  &lt;li class=&quot;uagb-toc__list&quot;&gt;
                    &lt;a href=&quot;#the-end-result&quot;&gt;The end result&lt;/a&gt;&lt;li class=&quot;uagb-toc__list&quot;&gt;
                      &lt;a href=&quot;#how-do-i-set-this-up-in-my-environment&quot;&gt;How do I set this up in my environment?&lt;/a&gt;&lt;ul class=&quot;uagb-toc__list&quot;&gt;
                        &lt;li class=&quot;uagb-toc__list&quot;&gt;
                          &lt;a href=&quot;#what-if-i-have-multiple-cmgs&quot;&gt;What if I have multiple CMGs?&lt;/a&gt;
                        &lt;/li&gt;
                      &lt;/ul&gt;
                    &lt;/li&gt;&lt;/ul&gt;
                  &lt;/li&gt;
                &lt;/ul&gt;
              &lt;/li&gt;&lt;/ul&gt;
            &lt;/li&gt;
          &lt;/ul&gt;
        &lt;/li&gt;
        
        &lt;li class=&quot;uagb-toc__list&quot;&gt;
          &lt;a href=&quot;#a-note-on-the-task-sequence-size&quot;&gt;A note on the task sequence size&lt;/a&gt;&lt;li class=&quot;uagb-toc__list&quot;&gt;
            &lt;a href=&quot;#links&quot;&gt;Links&lt;/a&gt;
          &lt;/li&gt;&lt;/ul&gt;
        &lt;/li&gt;
      &lt;/ul&gt;
    &lt;/li&gt;&lt;/ul&gt;
  &lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;
&lt;/ol&gt;
</code></pre>
<p>Hello,</p>
<p>This is a long and overdue update on a solution I started working on last year to allow my organization to use the modern driver management solution without the need of the custom webservice. I also wanted the solution to use the built-in task sequence steps as much as possible to allow other administrators to customize the solution to their need without the need to go modify a big PowerShell script.</p>
<p>You can read the original blog posts here:</p>
<p><strong>Modern Driver Management with the Administration Service</strong></p>
<p><strong>Modern BIOS Management with the Administration Service</strong></p>
<h2 id=notable-improvements>Notable improvements</h2>
<h2 id=prerequisites-to-use-the-solution-over-cmg>Prerequisites to use the solution over CMG</h2>
<h3 id=a-working-cmg>A working CMG</h3>
<p>There are multiple blog articles and guides online to help you set up your CMG. Here are some links that helped me:</p>
<ul>
<li><a href=https://docs.microsoft.com/en-us/mem/configmgr/core/clients/manage/cmg/setup-cloud-management-gateway>Official documentation/guidance from Microsoft</a></li>
<li><a href=https://systemcenterdudes.com/setup-and-configure-sccm-cloud-management-gateway-1806/>CMG Guide from System Center Dudes</a></li>
<li><a href=https://www.prajwaldesai.com/setup-sccm-cloud-management-gateway/>CMG Guide from Prajwal Desai</a></li>
</ul>
<p>Personally, for my lab, I used the <a href=https://z-nerd.com/blog/2019/05/20-lets-encrypt-cloud-management-gateway/>Let&rsquo;s Encrypt Cloud Management Gateway</a> blog post by Nathan Ziehnert to set up my CMG.</p>
<h3 id=additional-configuration-to-use-the-adminservice-over-cmg>Additional configuration to use the AdminService over CMG</h3>
<p>There is some additional configuration that is needed to be able to query the AdminService over the cloud management gateway.</p>
<p>Once again, another one of Nathan’s blog post helped me: <a href=https://z-nerd.com/blog/2019/12/03-adminservice-over-cmg/>Securing Access to the ConfigMgr AdminService Over Cloud Management Gateway</a></p>
<p>There are 2 things I had to do differently in the Authentication section:</p>
<ul>
<li>Add a platform and select “Mobile and desktop applications” and check the box for : <a href=https://login.microsoftonline.com/common/oauth2/nativeclient>https://login.microsoftonline.com/common/oauth2/nativeclient</a></li>
<li>Select “Yes” to Allow public client flows</li>
</ul>
<p> </p>
<h2 id=how-to-query-the-adminservice-over-cmg>How to query the AdminService over CMG?</h2>
<p>I started my research by reading the blog post from Sandy Zeng here: <a href=https://msendpointmgr.com/2019/07/16/use-configmgr-administration-service-adminservice-over-internet/>https://msendpointmgr.com/2019/07/16/use-configmgr-administration-service-adminservice-over-internet/</a></p>
<p>Also, at the same time, when I was looking at my application registration in the Azure Portal I saw this notification:</p>
<p> </p>
<p>After inspecting Sandy’s script, I confirmed that it was using Azure Active Directory Authentication Library (ADAL), so I wanted to make my solution work with MSAL instead of ADAL.</p>
<p>After doing some research, I found the perfect PowerShell module to help me: <a href=https://github.com/AzureAD/MSAL.PS/>MSAL.PS</a></p>
<p>With the help of that module, I was easily able to get an access token that is needed to query the AdminService over CMG.</p>
<h3 id=using-the-msalps-module>Using the MSAL.PS module</h3>
<p>Here is a sample script I used to test retrieving an access token with the MSAL.PS module:</p>
<p> </p>
<p>And here is what the result looks like:</p>
<p> </p>
<p>Now that I have an access token, I can easily query the AdminService over CMG. I reused the same part of the code used by Sandy to do this:</p>
<p> </p>
<p>In the example above, I was successfully able to retrieve information for 36 packages from the AdminService over CMG.</p>
<h2 id=improvements-to-invoke-getpackageidfromadminservice>Improvements to Invoke-GetPackageIDFromAdminService</h2>
<p>Now that I knew what information I needed to use to query the AdminService over CMG, I was ready to make the necessary modifications to my script.</p>
<h3 id=1-new-parameters-and-parametersets>1) New parameters and ParameterSets</h3>
<p>Depending on if the client is on the internet or not, my script would require a different set of parameters. This was the perfect opportunity to use <a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_parameter_sets?view=powershell-7.1">parameter sets</a>.</p>
<p>[parameter(Mandatory = $true, ParameterSetName = &ldquo;Internet&rdquo;)]
[ValidateNotNullOrEmpty()]
[string]$ExternalUrl,</p>
<p>[parameter(Mandatory = $true, ParameterSetName = &ldquo;Internet&rdquo;)]
[ValidateNotNullOrEmpty()]
[string]$TenantID,</p>
<p>[parameter(Mandatory = $true, ParameterSetName = &ldquo;Internet&rdquo;)]
[ValidateNotNullOrEmpty()]
[string]$ClientID,</p>
<p>[parameter(Mandatory = $false, ParameterSetName = &ldquo;Internet&rdquo;)]
[ValidateNotNullOrEmpty()]
[string]$ApplicationIdUri = &lsquo;https://ConfigMgrService&rsquo;,</p>
<p>[parameter(Mandatory = $false, ParameterSetName = &ldquo;Intranet&rdquo;)]
[parameter(Mandatory = $true, ParameterSetName = &ldquo;Internet&rdquo;)]
[ValidateNotNullOrEmpty()]
[string]$Username,</p>
<p>[parameter(Mandatory = $false, ParameterSetName = &ldquo;Intranet&rdquo;)]
[parameter(Mandatory = $true, ParameterSetName = &ldquo;Internet&rdquo;)]
[ValidateNotNullOrEmpty()]
[string]$Password,</p>
<p>[parameter(Mandatory = $false, ParameterSetName = &ldquo;Intranet&rdquo;)]
[parameter(Mandatory = $false, ParameterSetName = &ldquo;Internet&rdquo;)]
[bool]$BypassCertCheck = $false,</p>
<h3 id=2-verify-install-and-import-the-msalps-module>2) Verify, Install and Import the MSAL.PS module</h3>
<p>I wrote a function to handle installing & importing the MSAL.PS.</p>
<p>The tricky part here is that the MSAL.PS module requires us to accept the license agreement before we can install the module. There is a parameter <strong>-AcceptLicense</strong> for the Install-Module function but it is only available in the <a href=https://docs.microsoft.com/en-us/powershell/module/powershellget>PowerShellGet module</a> version 2 or higher.</p>
<p>This function checks for the availability of the MSAL.PS module and if it’s not there it will check for the prerequisites to install before it can import the module.</p>
<pre><code>    Add-TextToCMLog $LogFile &quot;MSAL.PS is not installed, checking for prerequisites before installing module.&quot; $component 1
    
    Add-TextToCMLog $LogFile &quot;Checking for NuGet package provider... &quot; $component 1
    If(-not (Get-PackageProvider -Name NuGet -ListAvailable -ErrorAction SilentlyContinue)){
        Add-TextToCMLog $LogFile &quot;NuGet package provider is not installed, installing NuGet...&quot; $component 1
        $NuGetVersion = Install-PackageProvider -Name NuGet -Force -ErrorAction Stop | Select-Object -ExpandProperty Version
        Add-TextToCMLog $LogFile &quot;NuGet package provider version $($NuGetVersion) installed.&quot; $component 1
    }
    
    Add-TextToCMLog $LogFile &quot;Checking for PowerShellGet module version 2 or higher &quot; $component 1
    $PowerShellGetLatestVersion = Get-Module -ListAvailable -Name PowerShellGet | Sort-Object -Property Version -Descending | Select-Object -First 1 -ExpandProperty Version       
    If((-not $PowerShellGetLatestVersion)){
        Add-TextToCMLog $LogFile &quot;Could not find any version of PowerShellGet installed.&quot; $component 1
    }
    If(($PowerShellGetLatestVersion.Major -lt 2)){
        Add-TextToCMLog $LogFile &quot;Current PowerShellGet version is $($PowerShellGetLatestVersion) and needs to be updated.&quot; $component 1
    }
    If((-not $PowerShellGetLatestVersion) -or ($PowerShellGetLatestVersion.Major -lt 2)){
        Add-TextToCMLog $LogFile &quot;Installing latest version of PowerShellGet...&quot; $component 1
        Install-Module -Name PowerShellGet -AllowClobber -Force
        $InstalledVersion = Get-Module -ListAvailable -Name PowerShellGet | Sort-Object -Property Version -Descending | Select-Object -First 1 -ExpandProperty Version
        Add-TextToCMLog $LogFile &quot;PowerShellGet module version $($InstalledVersion) installed.&quot; $component 1
    }
    
    Add-TextToCMLog $LogFile &quot;Installing MSAL.PS module...&quot; $component 1
    If((-not $PowerShellGetLatestVersion) -or ($PowerShellGetLatestVersion.Major -lt 2)){
        Add-TextToCMLog $LogFile &quot;Starting another powershell process to install the module...&quot; $component 1
        $result = Start-Process -FilePath powershell.exe -ArgumentList &quot;Install-Module MSAL.PS -AcceptLicense -Force&quot; -PassThru -Wait -NoNewWindow
        If($result.ExitCode -ne 0){
            Add-TextToCMLog $LogFile &quot;Failed to install MSAL.PS module&quot; $component 3
            Throw &quot;Failed to install MSAL.PS module&quot;
        }
    }Else{
        Install-Module MSAL.PS -AcceptLicense -Force
    }
}
Add-TextToCMLog $LogFile &quot;Importing MSAL.PS module...&quot; $component 1
Import-module MSAL.PS -Force
Add-TextToCMLog $LogFile &quot;MSAL.PS module successfully imported.&quot; $component 1
</code></pre>
<p>}</p>
<h4 id=what-about-winpe-powershell-gallery-does-not-work-in-winpe>What about WinPE? PowerShell Gallery does not work in WinPE!</h4>
<p>You are right, by default PowerShell Gallery does not work in WinPE. To solve this issue, you have 2 options:</p>
<pre><code>  &lt;div class=&quot;wp-block-media-text__content&quot;&gt;
    &lt;p&gt;
      a) Create a package with the saved module and distribute it to your CMG
    &lt;/p&gt;
  &lt;/div&gt;
&lt;/div&gt;
</code></pre>
<pre><code>      &lt;div class=&quot;wp-block-media-text__content&quot;&gt;
        &lt;p&gt;
          b) Edit the package in the “Manually install MSAL.PS module” step:
        &lt;/p&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;
</code></pre>
<p>Both options will allow you to install and import the MSAL.PS module in WinPE.</p>
<p>If you decide to go with enabling support for PowerShell Gallery in WinPE, you can disable the step to manually install the module in the task sequence.</p>
<h3 id=3-querying-the-adminservice>3) Querying the AdminService</h3>
<p>Now, depending on what parameters were used, we will query the AdminService locally or via the CMG:</p>
<p>The rest of the script to filter and select the most suitable package did not change.</p>
<h2 id=improvements-to-the-task-sequence>Improvements to the task sequence</h2>
<p>Now that the script itself supports querying over CMG, I needed to make some adjustments to the “<strong>Query AdminService for PackageID</strong>” task sequence to properly call the script with the right parameters.</p>
<h3 id=1-is-the-client-on-internet>1) Is the client on Internet?</h3>
<p>We need to determine if the device running the task sequence is on Internet or on the corporate network (intranet).</p>
<p>First, we try using the _SMSTSIsClientOnInternet task sequence variable:</p>
<p> </p>
<p>Note: In my limited testing, I found that if a task sequence does not reference any package, this variable may not be set.</p>
<p>If the “ClientIsOnInternet” is still not set after this step and device is not in WinPE, we use the following PowerShell command to determine if the device is on Internet:</p>
<p> </p>
<h3 id=2-additional-parameters-for-internet-clients>2) Additional Parameters for Internet clients</h3>
<p>Here you fill out your environment-specific information. The additional parameters needed for CMG support are:</p>
<ul>
<li>ExternalUrl: The ExternalUrl to access the AdminService from your CMG. The followinfg query can be used to find the ExternalUrl:</li>
</ul>
<ul>
<li>TenantId: Your Azure AD Tenant ID</li>
<li>ClientId: The Client ID of the application registration that you created to interact with the AdminService. See <a href="https://sysmansquad.com/wp-admin/post.php?post=2552&action=edit#additional-configuration-to-use-the-adminservice-over-cmg">additional configuration to use the AdminService over CMG</a> for details.</li>
<li>ApplicationIdUri: The application ID Uri for your application registration. The default value of &ldquo;https://ConfigMgrService&rdquo; will probably be OK for most people.</li>
</ul>
<p> </p>
<h3 id=3-running-the-script-with-the-right-parameters>3) Running the script with the right parameters</h3>
<p>Depending on the value of the “ClientIsOnInternet” variable, we run the script with different parameters.</p>
<p>If the client is determined to be intranet, use the intranet parameters:</p>
<p> </p>
<p>If the client is on Internet, use the internet parameters:</p>
<p> </p>
<h2 id=the-end-result>The end result</h2>
<p>You can now use the Modern Driver Management and Modern BIOS Management solution for Internet clients just like you are doing with your intranet clients.</p>
<p>If you are on Current Branch 2010 or later, you can use a boot media to run bare metal deployment on the Internet and still use the Modern Driver/BIOS Management solution.</p>
<p> </p>
<h2 id=how-do-i-set-this-up-in-my-environment>How do I set this up in my environment?</h2>
<ol>
<li>Download the task sequences <a href=https://github.com/CharlesNRU/mdm-adminservice/raw/master/MDM-TS.zip>here</a>.</li>
<li>Import the task sequences in your environment</li>
<li>Configure the parameters correctly in the “Query AdminService for PackageID” task sequence:</li>
</ol>
<p> </p>
<p>For example on what you can do with these task sequences, see my previous blog posts:</p>
<ul>
<li><a href=https://sysmansquad.com/2020/05/15/modern-driver-management-with-the-administration-service/>https://sysmansquad.com/2020/05/15/modern-driver-management-with-the-administration-service/</a></li>
<li><a href=https://sysmansquad.com/2020/06/18/modern-bios-management-with-the-administration-service/>https://sysmansquad.com/2020/06/18/modern-bios-management-with-the-administration-service/</a></li>
</ul>
<h3 id=what-if-i-have-multiple-cmgs>What if I have multiple CMGs?</h3>
<p>There is nothing stopping you from writing a small script to detect/check which CMG to use and then set the &ldquo;AS_ExternalUrl&rdquo; variable to whatever you want.</p>
<p>Now you have support for multiple CMGs 🙂</p>
<h2 id=a-note-on-the-task-sequence-size>A note on the task sequence size</h2>
<p>Currently, the scripts used in this solution are added directly in the task sequence instead of referencing a package containing the scripts. As you can see below, the task sequence size can be somewhat big:</p>
<p> </p>
<p>If you are concerned about the total size of the task sequence, you could store the scripts in a package instead and this would greatly reduce the size of the task sequence.</p>
<p>Reference regarding task sequence size: <a href=https://docs.microsoft.com/en-us/mem/configmgr/osd/deploy-use/manage-task-sequences-to-automate-tasks#reduce-the-size-of-task-sequence-policy>https://docs.microsoft.com/en-us/mem/configmgr/osd/deploy-use/manage-task-sequences-to-automate-tasks#reduce-the-size-of-task-sequence-policy</a></p>
<h2 id=links>Links</h2>
<p><a href=https://github.com/CharlesNRU/mdm-adminservice/raw/master/MDM-TS.zip>Task Sequence Exports</a></p>
<p><a href=https://github.com/CharlesNRU/mdm-adminservice>MDM-AdminService GitHub repository</a></p>
</div>
<div class=post-share>
<div class="post-share-box share-comments">
hello
</div>
</div>
<div class=post-author>
</div>
<comments id=comments>
<script src=https://utteranc.es/client.js repo=SysManSquad/sysmansquadblog issue-term=title label="blog comment" theme=github-light crossorigin=anonymous async></script>
</comments>
</article>
</div>
</div>
</div>
<footer id=footer>
<div class=container>
<div id=footer-copyright>
<p class=copyright>&copy; 2021 WinAdmins - https://www.sysmansquad.com - Systems Management Squad</a></p>
</div>
</div>
</footer>
</div>
</body>
</html>