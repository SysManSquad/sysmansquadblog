<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=keyword content="ConfigMgr Microsoft Intune Windows WinAdmins">
<meta name=viewport content="width=device-width">
<meta name=description content="A community blog and subsidiary of WinAdmins.io">
<link rel="shortcut icon" href=/img/favicon.ico>
<title>Create a new WinPE boot image-SysManSquad | Systems Management Squad</title>
<link rel=canonical href=/2021/02/22/create-a-new-winpe-boot-image/>
<link rel=stylesheet href=/css/style.css>
<link rel=stylesheet href=https://blog.sysmansquad.com/css/custom.css>
<script src=https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js></script>
<script src=https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js></script>
<script src=https://blog.sysmansquad.com/js/jquery.slicknav.js></script>
<script src=https://blog.sysmansquad.com/js/asd_SlickNav_Mobile.js></script>
<script src=https://blog.sysmansquad.com/js/custom.js></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XXZR1RSQYX"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-XXZR1RSQYX',{anonymize_ip:!1})}</script>
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://blog.sysmansquad.com/83">
<meta name=twitter:title content="Create a new WinPE boot image">
<meta name=twitter:description content="Introduction In this post I&rsquo;ll show you how you can create a new boot image in ConfigMgr.
There&rsquo;s plenty of good content out there already on this, but I was interested to write this because I didn&rsquo;t see many PowerShell examples out there until I came across Michael Niehaus' post on Build your own Windows PE image. A fantastic post, highly recommend reading it. Michael provided a useful script at the end of this post in a .">
</head>
<body class="home blog">
<div id=asd-container>
<div id=top-bar>
<div class=container>
<div id=nav-wrapper>
<ul class=menu id=menu-top-menu>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/>Home</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/about/>
<span>About</span>
</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=https://github.com/SysManSquad>
<span>GitHub</span>
</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/jointhesquad/>
<span>Join the Squad</span>
</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/meetthesquad/>
<span>Meet the Squad</span>
</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=#>
<span>MORE></span>
</a>
<ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/contact/>Contact</a>
</li>
</ul>
</li>
</ul>
</div>
<div id=top-search>
<a href=# class=search><i class="fa fa-search"></i></a>
<div class=show-search>
<form role=search method=get action=https://www.google.com/search id=searchform>
<input type=search placeholder="Search and hit enter..." name=q id=q title="Search and hit enter...">
<input type=hidden name=sitesearch value=https://blog.sysmansquad.com>
<button type=submit value=Search>
</form>
</div>
</div>
<div class=menu id=menu-mobile></div>
</div>
</div>
<header id=header class=noslider>
<div class=container>
<div id=logo>
<h1><a href=https://blog.sysmansquad.com><img src=/img/SysManSquad-HorizontalColor-Logo.png alt="Systems Management Squad"></a></h1>
</div>
</div>
</header>
<div class=container>
<div id=content>
<div id=main class=fullwidth>
<article class="post type-post status-publish format-standard has-post-thumbnail hentry">
<div class=post-header>
<h1>Create a new WinPE boot image</h1>
<p class=p-meta>
<span class=post-author><a href=/authors/acc>Adam Cook</a> / </span>
<span class=post-date>February 22, 2021 </span>
<span class=post-categories>/ Endpoint Management </span>
<span class=post-categories>/ How-To </span>
<span class=post-categories>/ MECM/MEMCM/SCCM </span>
</p>
</div>
<div class=post-entry>
<h2 id=introduction>Introduction</h2>
<p>In this post I&rsquo;ll show you how you can create a new boot image in ConfigMgr.</p>
<p>There&rsquo;s plenty of good content out there already on this, but I was interested to write this because I didn&rsquo;t see many PowerShell examples out there until I came across Michael Niehaus' post on <a href=https://oofhours.com/2021/01/17/build-your-own-windows-pe-image/>Build your own Windows PE image</a>. A fantastic post, highly recommend reading it. Michael provided a useful script at the end of this post in a .zip file. I felt it could do with some improvements.</p>
<p>In this post I&rsquo;ll share two ways on how to create a boot image for ConfigMgr:</p>
<ul>
<li>The &ldquo;GUI&rdquo; way: copy the WinPE.wim file from your ADK directory, importing it into ConfigMgr, and adding your optional components drivers via the console</li>
<li>Using PowerShell to copy the WinPE.wim, add our drivers and optional components and then import into wherever you need</li>
</ul>
<p>Generally, it&rsquo;s better to not modify the default boot images that come out of the box with ConfigMgr. But if you&rsquo;ve modified them, don&rsquo;t sweat it, at least you&rsquo;ll have this post to help you create a fresh one in future if need.</p>
<h2 id=the-gui-way>The &ldquo;GUI&rdquo; way</h2>
<ol>
<li>Navigate to your ADK installation directory. It&rsquo;ll likely be <code>C:\Program Files (x86)\Windows Kits\10\Assessment and Deployment Kit\Windows Preinstallation Environment</code></li>
<li>You&rsquo;ll notice you have multiple winpe.wim files on disk, one for each architecture:<br>
<div class=image>
<figure>
<a href=createnewbootimageconfigmgr-1-1024x468.png target=_blank>
<img src=createnewbootimageconfigmgr-1-1024x468.png alt=screenshot>
</a>
<figcaption>Multiple WinPE.wim files in the ADK installation directory</figcaption>
</figure>
</div></li>
<li>Let&rsquo;s run with the most common requirement here and copy <code>amd64\en-us\winpe.wim</code> to any destination directory you need</li>
<li>Optionally rename it to something more particular, perhaps to include today&rsquo;s date and architecture e.g. <code>WinPE-amd64-2021-02-13.wim</code></li>
<li>Open the ConfigMgr console, and right click on Boot Images under Software Library > Operating Systems.<br>
<a href=createnewbootimageconfigmgr-2.png><div class=image>
<figure>
<a href=createnewbootimageconfigmgr-2.png target=_blank>
<img src=createnewbootimageconfigmgr-2.png alt=screenshot>
</a>
</figure>
</div></a>Add Boot Image in ConfigMgr console</li>
<li>Go through the wizard to browse out and select our new boot image <code>WinPE-amd64-2021-02-13.wim</code></li>
<li>After the wizard completes, you&rsquo;ll notice that ConfigMgr duplicated the .wim file and appended the PackageID to the file name. Any changes we make to this boot image, e.g. add optional components or drivers, ConfigMgr will modify the .wim file with the PackageID in the filename, leaving the original untouched.</li>
</ol>
<p>For each change you make to this boot image, ConfigMgr will always start with a fresh copy from the original - the one without the PackageID in the file name. <strong>Don&rsquo;t delete it</strong>! Otherwise you&rsquo;ll find yourself making a new one, again, when you come to update drivers or add new components later.</p>
<p><a href=createnewbootimageconfigmgr-3.png><div class=image>
<figure>
<a href=createnewbootimageconfigmgr-3-1024x358.png target=_blank>
<img src=createnewbootimageconfigmgr-3-1024x358.png alt=screenshot>
</a>
</figure>
</div></a>Boot image on disk and in console after imported</p>
<p>Now you&rsquo;re free to do as you please with your new fresh new vanilla boot image. You&rsquo;ll notice adding optional components etc will increase the file size, naturally.</p>
<p><a href=createnewbootimageconfigmgr-4.png><div class=image>
<figure>
<a href=createnewbootimageconfigmgr-4-1024x823.png target=_blank>
<img src=createnewbootimageconfigmgr-4-1024x823.png alt=screenshot>
</a>
</figure>
</div></a>Boot image with drivers and optional components addedWhat I want to point out here is that because we did these actions within the ConfigMgr console, i.e. add drivers and optional components, we can see exactly what those drivers and components are.</p>
<p>When we come to do this using PowerShell, our new boot image will contain all the same drivers and optional components, however when we right click and go to Properties like I demonstrated in the screenshots above, you won&rsquo;t actually see anything in the <strong>Drivers</strong> or <strong>Optional Components</strong> tabs.</p>
<h2 id=using-powershell>Using PowerShell</h2>
<p>This was inspired by Michael Niehaus&rsquo;s script but I added some improvements.</p>
<ul>
<li><a href=https://github.com/codaamok/PoSH/blob/master/ConfigMgr/New-WinPEWIM.ps1>Download New-WinPEWIM.ps1</a> from my GitHub by cloning my repo or clicking the Raw button, right clicking empty space and selecting &ldquo;Save As&rdquo;. It will attempt to download it as .txt. Just rename it to .ps1 as the only file extension.</li>
</ul>
<p><a href=createnewbootimageconfigmgr-5.png><div class=image>
<figure>
<a href=createnewbootimageconfigmgr-5-1024x582.png target=_blank>
<img src=createnewbootimageconfigmgr-5-1024x582.png alt=screenshot>
</a>
</figure>
</div></a>View New-WinPEWIM.ps1 as Raw</p>
<ul>
<li>Execute the script. Customise any of the parameters to suit your needs:</li>
</ul>
<div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1><a style=outline:none;text-decoration:none;color:inherit href=#1>1</a>
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>.\<span style=color:#0086b3>New-WinPEWIM</span>.ps1 -Platforms amd64 -OptionalComponents <span style=color:#d14>&#34;WinPE-WDS-Tools&#34;</span>, <span style=color:#d14>&#34;WinPE-Scripting&#34;</span>, <span style=color:#d14>&#34;WinPE-WMI&#34;</span>, <span style=color:#d14>&#34;WinPE-SecureStartup&#34;</span>, <span style=color:#d14>&#34;WinPE-NetFx&#34;</span>, <span style=color:#d14>&#34;WinPE-PowerShell&#34;</span>, <span style=color:#d14>&#34;WinPE-StorageWMI&#34;</span>, <span style=color:#d14>&#34;WinPE-DismCmdlets&#34;</span> -OutputDirectory <span style=color:#d14>&#34;G:\OSD\BootImages&#34;</span> -DriversDirectory <span style=color:#d14>&#34;G:\Drivers\WINPE10.0-DRIVERS-A22-3GVJN\x64&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>YouTube video on using New-WinPEWIM.ps1</p>
<p>You&rsquo;ll notice that when you import this to ConfigMgr, the <strong>Drivers</strong> and <strong>Optional Components</strong> tabs will be blank. Since ConfigMgr wasn&rsquo;t the tool used to inject drivers or optional components, it doesn&rsquo;t know what it doesn&rsquo;t know!</p>
<p>This is arguably a reasonable drawback of using this approach, because it creates a little obfuscation. Another admin who was looking through your boot images wouldn&rsquo;t understand there are already drivers and optional components added to the boot image. Their only clue when looking at it on face value would be that the file size would be larger than the default.</p>
<h3 id=update>Update</h3>
<p>Adam Gross has a script on his GitHub where you can import a new WinPE boot image to your ConfigMgr site while still being able to get those juicy tabs / metadata fields populated!</p>
<p><a href=https://github.com/AdamGrossTX/PowershellScripts/blob/master/ConfigMgr/BootImage/New-BootImage.ps1>New-BootImage.ps1</a></p>
<p>It looks like it doesn&rsquo;t have a parameter to let you specify which Optional Components you want injected, it&rsquo;s hardcoded on <a href=https://github.com/AdamGrossTX/PowershellScripts/blob/master/ConfigMgr/BootImage/New-BootImage.ps1#L214>line #214</a>. So tinker with that if you want to add different, more, or fewer optional components.</p>
<p>It also doesn&rsquo;t have a parameter for it to inject a directory of drivers. I&rsquo;ll make a PR at some point and update this block when that&rsquo;s done.</p>
<p>None the less I hope you found this useful. Let me know if you have any questions or feedback in the comments below, or <a href=https://twitter.com/codaamok>DM/tweet me on Twitter @codaamok</a>.</p>
<img src=/authors/acc/avatar.png alt="Photo of Adam Cook"><br>
<strong>Adam Cook</strong>
<em>Admin/Contributor</em>
<div>
<a href=https://twitter.com/codaamok><img src=/img/social/twitter.png></a>
<a href=https://www.linkedin.com/in/adamcharlescook><img src=/img/social/linkedin.png></a>
</div>
<p>Adam loves technology and helping people, focusing on PowerShell, Azure, ConfigMgr, and Linux.</p>
<hr>
</div>
<comments id=comments>
<script src=https://utteranc.es/client.js repo=SysManSquad/sysmansquadblog issue-term=title label="blog comment" theme=github-light crossorigin=anonymous async></script>
</comments>
</article>
</div>
</div>
</div>
<footer id=footer>
<div class=container>
<div id=footer-copyright>
<p class=copyright>&copy; 2022 WinAdmins - https://blog.sysmansquad.com - Systems Management Squad</a></p>
</div>
</div>
</footer>
</div>
</body>
</html>