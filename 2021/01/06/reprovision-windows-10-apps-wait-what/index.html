<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=keyword content="ConfigMgr Microsoft Intune Windows WinAdmins"><meta name=viewport content="width=device-width"><meta name=description content="A community blog and subsidiary of WinAdmins.io"><link rel="shortcut icon" href=/img/favicon.ico><title>Reprovision Windows 10 Apps… Wait, What?-SysManSquad | Systems Management Squad</title><link rel=canonical href=/2021/01/06/reprovision-windows-10-apps-wait-what/><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=https://blog.sysmansquad.com/css/custom.css><script src=https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js></script>
<script src=https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js></script>
<script src=https://blog.sysmansquad.com/js/jquery.slicknav.js></script>
<script src=https://blog.sysmansquad.com/js/asd_SlickNav_Mobile.js></script>
<script src=https://blog.sysmansquad.com/js/custom.js></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XXZR1RSQYX"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XXZR1RSQYX",{anonymize_ip:!1})}</script><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.sysmansquad.com/83"><meta name=twitter:title content="Reprovision Windows 10 Apps… Wait, What?"><meta name=twitter:description content="Remember when we all complained that Microsoft &ldquo;wasn&rsquo;t respecting our app removals!&rdquo; and they were all reinstalled during every feature update? Pepperidge farm remembers. Well, Microsoft was kind enough to hear our collective complaints, and take action on them. That is an awesome quality that we are seeing from the product teams at Microsoft.
Starting in Windows 10 1803, deprovisioned apps will NOT be reinstalled during a feature update. No more Solitaire returning from the dead every time we try to &ldquo;Get current and stay current."></head><body class="home blog"><div id=asd-container><div id=top-bar><div class=container><div id=nav-wrapper><ul class=menu id=menu-top-menu><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/>Home</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/about/><span>About</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=https://github.com/SysManSquad><span>GitHub</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/jointhesquad/><span>Join the Squad</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/meetthesquad/><span>Meet the Squad</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=#><span>MORE></span></a><ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/contact/>Contact</a></li></ul></li></ul></div><div id=top-search><a href=# class=search><i class="fa fa-search"></i></a><div class=show-search><form role=search method=get action=https://www.google.com/search id=searchform><input type=search placeholder="Search and hit enter..." name=q id=q title="Search and hit enter...">
<input type=hidden name=sitesearch value=https://blog.sysmansquad.com>
<button type=submit value=Search></form></div></div><div class=menu id=menu-mobile></div></div></div><header id=header class=noslider><div class=container><div id=logo><h1><a href=https://blog.sysmansquad.com><img src=/img/SysManSquad-HorizontalColor-Logo.png alt="Systems Management Squad"></a></h1></div></div></header><div class=container><div id=content><div id=main class=fullwidth><article class="post type-post status-publish format-standard has-post-thumbnail hentry"><div class=post-header><h1>Reprovision Windows 10 Apps… Wait, What?</h1><p class=p-meta><span class=post-author><a href=/authors/cody>Cody Mathis</a> /</span>
<span class=post-date>January 6, 2020</span>
<span class=post-categories>/ Endpoint Management</span>
<span class=post-categories>/ How-To</span>
<span class=post-categories>/ MECM/MEMCM/SCCM</span>
<span class=post-categories>/ Powershell</span>
<span class=post-categories>/ Scripting</span></p></div><div class=post-entry><p>Remember when we all complained that Microsoft &ldquo;wasn&rsquo;t respecting our app removals!&rdquo; and they were all reinstalled during every feature update? Pepperidge farm remembers. Well, Microsoft was kind enough to hear our collective complaints, and take action on them. That is an awesome quality that we are seeing from the product teams at Microsoft.</p><p>Starting in Windows 10 1803, deprovisioned apps will NOT be reinstalled during a feature update. No more Solitaire returning from the dead every time we try to &ldquo;Get current and stay current.&rdquo; No more ZuneMusic trying to be brought back from the dead by Microsoft.</p><h4 id=but-i-changed-my-mind-i-want-those-apps-back>But I changed my mind&mldr; I want those apps back</h4><p>Ironically, I found myself pounding my head against the keyboard trying to reinstall the Windows Store! Bad decisions are made sometimes . In this case, a business decision was made to deprovision the Windows Store because it is <em>evil</em>!!! Or at least that was the misunderstanding 3-4 years ago when the decision was made. <strong>(Note: DON&rsquo;T REMOVE THE STORE, THERE ARE BETTER WAYS TO HANDLE IT SUCH AS DISABLING WITH GPO, OR MANAGING IT WITH WINDOWS STORE FOR BUSINESS)</strong></p><p>The Windows Store was of course not the only app removed. Various applications were selected for removal based on this reason, or that reason.</p><h4 id=we-can-unfix-it-we-have-the-technology>We can unfix it, we have the technology</h4><p>Microsoft details the &rsquo;trigger&rsquo; for these apps not being reinstalled in the docs here.</p><p>The gist of it is, when an app is deprovisioned a registry key will be made. If that registry key is present then the app will not be reinstalled on any Windows 10 Feature Update that is 1803 or above. To help get a handle on this I&rsquo;ve written up some functions that have multiple use cases.</p><h4 id=find-em>Find &rsquo;em</h4><p>First, we can identify apps that have been deprovisioned with the below function. I’ve linked to it on GitHub, and the codeblock is below.</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-1> 1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-2> 2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-3> 3</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-4> 4</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-5> 5</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-6> 6</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-7> 7</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-8> 8</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-9> 9</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-10>10</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-11>11</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-12>12</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-13>13</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-14>14</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-15>15</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-16>16</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-17>17</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-18>18</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-19>19</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-20>20</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-21>21</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-22>22</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-23>23</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-24>24</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-25>25</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-26>26</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-27>27</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-28>28</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-29>29</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-30>30</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-31>31</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-32>32</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-33>33</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-34>34</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-35>35</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-36>36</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-37>37</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-38>38</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-39>39</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-40><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-40>40</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-41><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-41>41</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-42><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-42>42</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-43><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-43>43</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-44><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-44>44</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-45><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-45>45</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-46><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-46>46</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-47><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-47>47</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-48><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-48>48</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-49><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-49>49</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-50><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-50>50</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-51><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-51>51</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#000;font-weight:700>function</span> <span style=color:#0086b3>Get-DeprovisionedAppX</span> {
</span></span><span style=display:flex><span>    <span style=color:#998;font-style:italic>#</span>
</span></span><span style=display:flex><span>    .SYNOPSIS
</span></span><span style=display:flex><span>        Returns an array of apps that are deprovisioned
</span></span><span style=display:flex><span>    .DESCRIPTION
</span></span><span style=display:flex><span>        This <span style=color:#000;font-weight:700>function</span> returns an array of all the apps that are deprovisioned on the local computer.
</span></span><span style=display:flex><span>        Deprovisioned apps will show up <span style=color:#000;font-weight:700>in</span> the registry <span style=color:#000;font-weight:700>if</span> they were removed <span style=color:#000;font-weight:700>while</span> Windows was offline, or
</span></span><span style=display:flex><span>        with the PowerShell cmdlets <span style=color:#000;font-weight:700>for</span> removing AppX Packages.
</span></span><span style=display:flex><span>    .<span style=color:#000;font-weight:700>PARAMETER</span> <span style=color:#000;font-weight:700>Filter</span>
</span></span><span style=display:flex><span>        Option <span style=color:#000;font-weight:700>filter</span> that will be ran through as a <span style=color:#d14>&#39;-match&#39;</span> so that regex can be used
</span></span><span style=display:flex><span>        Accepts an array of strings, which can be a regex string <span style=color:#000;font-weight:700>if</span> you wish
</span></span><span style=display:flex><span>    .EXAMPLE
</span></span><span style=display:flex><span>        <span style=color:#0086b3>PS </span>C:\&gt; <span style=color:#0086b3>Get-DeprovisionedAppX</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>Return</span> all deprovisioned apps on the local computers
</span></span><span style=display:flex><span>    .EXAMPLE
</span></span><span style=display:flex><span>        <span style=color:#0086b3>PS </span>C:\&gt; <span style=color:#0086b3>Get-DeprovisionedAppX</span> -Filter Store
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>Return</span> all deprovisioned apps on the local computers that match the <span style=color:#000;font-weight:700>filter</span> <span style=color:#d14>&#39;Store&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#998;font-style:italic>#&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>param</span> (
</span></span><span style=display:flex><span>        [<span style=color:#000;font-weight:700>parameter</span>(<span style=color:#000;font-weight:700>Mandatory</span> = <span style=color:teal>$false</span>)]
</span></span><span style=display:flex><span>        <span style=color:teal>[string[]]</span><span style=color:teal>$Filter</span>
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>begin</span> {
</span></span><span style=display:flex><span>        <span style=color:teal>$DeprovisionRoot</span> = <span style=color:#d14>&#34;registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Appx\AppxAllUserStore\Deprovisioned&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:teal>$AllDeprovisionedApps</span> = <span style=color:#0086b3>Get-ChildItem</span> -Path <span style=color:teal>$DeprovisionRoot</span> | <span style=color:#0086b3>Select-Object</span> -Property @{ Name = <span style=color:#d14>&#39;DeprovisionedApp&#39;</span>; Expression = { <span style=color:teal>$_</span>.PSChildName } }
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>if</span> (<span style=color:teal>$null</span> <span style=color:#000;font-weight:700>-eq</span> <span style=color:teal>$AllDeprovisionedApps</span>) {
</span></span><span style=display:flex><span>            <span style=color:#0086b3>Write-Warning</span> <span style=color:#d14>&#34;There are no deprovisioned apps&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>process</span> {
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>switch</span> (<span style=color:teal>$PSBoundParameters</span>.ContainsKey(<span style=color:#d14>&#39;Filter&#39;</span>)) {
</span></span><span style=display:flex><span>            <span style=color:teal>$true</span> {
</span></span><span style=display:flex><span>                <span style=color:#000;font-weight:700>foreach</span> (<span style=color:teal>$SearchString</span> <span style=color:#000;font-weight:700>in</span> <span style=color:teal>$Filter</span>) {
</span></span><span style=display:flex><span>                    <span style=color:#000;font-weight:700>switch</span> <span style=color:#000;font-weight:700>-regex</span> (<span style=color:teal>$AllDeprovisionedApps</span>.DeprovisionedApp) {
</span></span><span style=display:flex><span>                        <span style=color:teal>$SearchString</span> {
</span></span><span style=display:flex><span>                            <span style=color:teal>[PSCustomObject]</span>@{ 
</span></span><span style=display:flex><span>                                <span style=color:#d14>&#39;DeprovisionedApp&#39;</span> = <span style=color:teal>$PSItem</span>
</span></span><span style=display:flex><span>                            }
</span></span><span style=display:flex><span>                        }
</span></span><span style=display:flex><span>                        <span style=color:#000;font-weight:700>default</span> {
</span></span><span style=display:flex><span>                            <span style=color:#0086b3>Write-Verbose</span> <span style=color:#d14>&#34;$PSItem does not match the filter </span><span style=color:#d14>`&#39;</span><span style=color:#d14>$SearchString</span><span style=color:#d14>`&#34;</span><span style=color:#d14>&#34;</span>
</span></span><span style=display:flex><span>                        }
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:teal>$false</span> {
</span></span><span style=display:flex><span>                <span style=color:#0086b3>Write-Output</span> <span style=color:teal>$AllDeprovisionedApps</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>Get-DeprovisionedAppX</p><p>Nothing too crazy going on here. At the core we are grabbing all keys under the path provided in the MS docs. I am just tossing in support for filters, comment based help, and some verbose output. I am also ensuring that we return an object with a specific property name, DeprovisionedApp. The reason for this will be apparent when we look at the next function.</p><h4 id=fix-em>Fix &rsquo;em</h4><p>We have our targets, now lets blow them away! The below function &lsquo;reprovisions&rsquo; the apps by removing the registry keys for the requested apps.</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-1> 1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-2> 2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-3> 3</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-4> 4</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-5> 5</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-6> 6</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-7> 7</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-8> 8</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-9> 9</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-10>10</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-11>11</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-12>12</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-13>13</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-14>14</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-15>15</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-16>16</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-17>17</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-18>18</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-19>19</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-20>20</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-21>21</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-22>22</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-23>23</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-24>24</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-25>25</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-26>26</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-27>27</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-28>28</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-29>29</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-30>30</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-31>31</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-32>32</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-33>33</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-34>34</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-35>35</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-36>36</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-37>37</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-38>38</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-39>39</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-40><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-40>40</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-41><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-41>41</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-42><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-42>42</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-43><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-43>43</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-44><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-44>44</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-45><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-45>45</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-46><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-46>46</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-47><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-47>47</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-48><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-48>48</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#000;font-weight:700>function</span> <span style=color:#0086b3>Reprovision-AppX</span> {
</span></span><span style=display:flex><span>    <span style=color:#998;font-style:italic>#</span>
</span></span><span style=display:flex><span>    .SYNOPSIS
</span></span><span style=display:flex><span>        <span style=color:#d14>&#39;Reprovision&#39;</span> apps by removing the registry key that prevents app reinstall
</span></span><span style=display:flex><span>    .DESCRIPTION
</span></span><span style=display:flex><span>        Starting <span style=color:#000;font-weight:700>in</span> Windows 10 1803, a registry key is <span style=color:#0086b3>set </span><span style=color:#000;font-weight:700>for</span> every deprovisioned app. As long as this registry key
</span></span><span style=display:flex><span>        is <span style=color:#000;font-weight:700>in</span> place, a deprovisioned application will not be reinstalled during a feature update. By removing these
</span></span><span style=display:flex><span>        registry keys, we can ensure that deprovisioned apps, such as the windows store are able to be reinstalled.
</span></span><span style=display:flex><span>    .<span style=color:#000;font-weight:700>PARAMETER</span> DeprovisionedApp
</span></span><span style=display:flex><span>        The full name of the app to reprovision, as it appears <span style=color:#000;font-weight:700>in</span> the registry. You can easily get this name using
</span></span><span style=display:flex><span>        the <span style=color:#0086b3>Get-DeprovisionedApp</span> <span style=color:#000;font-weight:700>function</span>. 
</span></span><span style=display:flex><span>    .EXAMPLE
</span></span><span style=display:flex><span>        <span style=color:#0086b3>PS </span>C:\&gt; <span style=color:#0086b3>Reprovision-AppX</span> -DeprovisionedApp <span style=color:#d14>&#39;Microsoft.WindowsAlarms_8wekyb3d8bbwe&#39;</span>
</span></span><span style=display:flex><span>        Removes the registry key <span style=color:#000;font-weight:700>for</span> the deprovisioned WindowsAlarms app. The app will <span style=color:#000;font-weight:700>return</span> after the next
</span></span><span style=display:flex><span>        feature update.
</span></span><span style=display:flex><span>    .INPUTS
</span></span><span style=display:flex><span>        <span style=color:teal>[string[]]</span>
</span></span><span style=display:flex><span>    .NOTES
</span></span><span style=display:flex><span>        You must provide the exact name of the app as it appears <span style=color:#000;font-weight:700>in</span> the registry. This is the full app <span style=color:#d14>&#39;name&#39;</span> - It is 
</span></span><span style=display:flex><span>        recommended to first use the <span style=color:#0086b3>Get-DeprovisionApp</span> <span style=color:#000;font-weight:700>function</span> to find apps that can be reprovisioned.
</span></span><span style=display:flex><span>    <span style=color:#998;font-style:italic>#&gt;</span>
</span></span><span style=display:flex><span>    [<span style=color:#000;font-weight:700>CmdletBinding</span>(SupportsShouldProcess)]
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>param</span>(
</span></span><span style=display:flex><span>        [<span style=color:#000;font-weight:700>parameter</span>(<span style=color:#000;font-weight:700>Mandatory</span> = <span style=color:teal>$true</span>, <span style=color:#000;font-weight:700>ValueFromPipelineByPropertyName</span> = <span style=color:teal>$true</span>)]
</span></span><span style=display:flex><span>        <span style=color:teal>[string[]]</span><span style=color:teal>$DeprovisionedApp</span>
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>begin</span> {
</span></span><span style=display:flex><span>        <span style=color:teal>$DeprovisionRoot</span> = <span style=color:#d14>&#34;registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Appx\AppxAllUserStore\Deprovisioned&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:teal>$AllDeprovisionedApps</span> = <span style=color:#0086b3>Get-ChildItem</span> -Path <span style=color:teal>$DeprovisionRoot</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>if</span> (<span style=color:teal>$null</span> <span style=color:#000;font-weight:700>-eq</span> <span style=color:teal>$AllDeprovisionedApps</span>) {
</span></span><span style=display:flex><span>            <span style=color:#0086b3>Write-Warning</span> <span style=color:#d14>&#34;There are no deprovisioned apps&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>process</span> {
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>foreach</span> (<span style=color:teal>$App</span> <span style=color:#000;font-weight:700>in</span> <span style=color:teal>$DeprovisionedApp</span>) {
</span></span><span style=display:flex><span>            <span style=color:teal>$DeprovisionedAppPath</span> = <span style=color:#0086b3>Join-Path</span> -Path <span style=color:teal>$DeprovisionRoot</span> -ChildPath <span style=color:teal>$App</span>
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>if</span> (<span style=color:teal>$PSCmdlet</span>.ShouldProcess(<span style=color:teal>$App</span>, <span style=color:#d14>&#34;Reprovision-App&#34;</span>)) {
</span></span><span style=display:flex><span>                <span style=color:teal>$AppPath</span> = <span style=color:#0086b3>Resolve-Path</span> -Path <span style=color:teal>$DeprovisionedAppPath</span> -ErrorAction Ignore
</span></span><span style=display:flex><span>                <span style=color:#000;font-weight:700>if</span> (<span style=color:teal>$null</span> <span style=color:#000;font-weight:700>-ne</span> <span style=color:teal>$AppPath</span>) {
</span></span><span style=display:flex><span>                    <span style=color:#0086b3>Remove-Item</span> -Path <span style=color:teal>$AppPath</span>.Path -Force
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                <span style=color:#000;font-weight:700>else</span> {
</span></span><span style=display:flex><span>                    <span style=color:#0086b3>Write-Warning</span> <span style=color:#d14>&#34;App $App was not found to be deprovisioned&#34;</span>
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>Reprovision-AppX</p><p>What we have here is a glorified wrapper for <strong>Remove-Item</strong>. But, it does have a bit of extra spice sprinkled on it.</p><p><strong>ValueFromPipelineByPropertyName</strong> - With this specified on the DeprovisionedApp input parameter we are able to pipe from our Get-DeprovisionedApp function, to Reprovision-App.</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#0086b3>Get-DeprovisionedAppX</span> -Filter <span style=color:#d14>&#39;Store&#39;</span> | <span style=color:#0086b3>Reprovision-AppX</span>
</span></span></code></pre></td></tr></table></div></div><p>That&rsquo;s pretty cool!</p><p><strong>[CmdletBinding(SupportsShouldProcess)]</strong> - At the top of the function this snippet allows the implementation of WhatIf support. To finish the implementation we have to use <strong>$PSCmdlet.ShouldProcess</strong> where it is fitting. This function has it at line 37, just before the action happens.</p><h4 id=last-step>Last step</h4><p>Once the deprovisioned apps have been identified, and &lsquo;reprovisioned&rsquo; by removing the registry keys, there is one last step. You have to do a feature update! It is always good to &lsquo;Get current and stay current&rsquo; anyway, but this gives you another reason to update Windows 10.</p><h4 id=a-good-start>A good start</h4><p>In this post I&rsquo;ve outlined the mechanism that ensures a deprovisioned AppX Package stays removed. Knowing how this works, we can leverage functions that help identify deprovisoned apps, and &lsquo;reprovision&rsquo; them.</p><p>I hope this helps someone get their environment back in working order by restoring the Windows Store! Or maybe just Solitaire&mldr; Let them play cards guys.</p><p><a href=https://twitter.com/CodyMathis123>@CodyMathis123</a></p><img src=/authors/cody/avatar.png alt="Photo of Cody Mathis"><br><strong>Cody Mathis</strong>
<em>Contributor</em><div><a href=https://twitter.com/CodyMathis123><img src=/img/social/twitter.png></a>
<a href=https://www.linkedin.com/in/cody-mathis-22a717136><img src=/img/social/linkedin.png></a></div><p>Cody has 10 years of ConfigMgr, PowerShell, and automation experience focusing on streamlining processes</p><hr></div><div class=post-share><div class="post-share-box share-comments">hello</div></div><comments id=comments><script src=https://utteranc.es/client.js repo=SysManSquad/sysmansquadblog issue-term=title label="blog comment" theme=github-light crossorigin=anonymous async></script></comments></article></div></div></div><footer id=footer><div class=container><div id=footer-copyright><p class=copyright>&copy; 2022 WinAdmins - https://blog.sysmansquad.com - Systems Management Squad</a></p></div></div></footer></div></body></html>