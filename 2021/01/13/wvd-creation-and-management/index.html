<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=keyword content="ConfigMgr Microsoft Intune Windows WinAdmins">
<meta name=viewport content="width=device-width">
<meta name=description content="A community blog and subsidiary of WinAdmins.io">
<link rel="shortcut icon" href=/img/favicon.ico>
<title>Windows Virtual Desktop: Creation and Management-SysManSquad | Systems Management Squad</title>
<link rel=canonical href=/2021/01/13/wvd-creation-and-management/>
<link rel=stylesheet href=/css/style.css>
<link rel=stylesheet href=https://blog.sysmansquad.com/css/custom.css>
<script src=https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js></script>
<script src=https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js></script>
<script src=https://blog.sysmansquad.com/js/jquery.slicknav.js></script>
<script src=https://blog.sysmansquad.com/js/asd_SlickNav_Mobile.js></script>
<script src=https://blog.sysmansquad.com/js/custom.js></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XXZR1RSQYX"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-XXZR1RSQYX',{anonymize_ip:!1})}</script>
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://blog.sysmansquad.com/83">
<meta name=twitter:title content="Windows Virtual Desktop: Creation and Management">
<meta name=twitter:description content="THIS GUIDE IS NOW OUTDATED WITH THE RELEASE OF WVD 2.0, I will create a new blog with the updated info in the future! Some of the info below is still valid! Why Windows Virtual Desktop? Windows Virtual Desktop allows you to create virtual Windows 10 machines that can be accessed from virtually anywhere. This means you can give someone a full desktop experience from virtually anywhere including android and iOS!">
</head>
<body class="home blog">
<div id=asd-container>
<div id=top-bar>
<div class=container>
<div id=nav-wrapper>
<ul class=menu id=menu-top-menu>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/>Home</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/about/>
<span>About</span>
</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=https://github.com/SysManSquad>
<span>GitHub</span>
</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/jointhesquad/>
<span>Join the Squad</span>
</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/meetthesquad/>
<span>Meet the Squad</span>
</a>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=#>
<span>MORE></span>
</a>
<ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home">
<a href=/contact/>Contact</a>
</li>
</ul>
</li>
</ul>
</div>
<div id=top-search>
<a href=# class=search><i class="fa fa-search"></i></a>
<div class=show-search>
<form role=search method=get action=https://www.google.com/search id=searchform>
<input type=search placeholder="Search and hit enter..." name=q id=q title="Search and hit enter...">
<input type=hidden name=sitesearch value=https://blog.sysmansquad.com>
<button type=submit value=Search>
</form>
</div>
</div>
<div class=menu id=menu-mobile></div>
</div>
</div>
<header id=header class=noslider>
<div class=container>
<div id=logo>
<h1><a href=https://blog.sysmansquad.com><img src=/img/SysManSquad-HorizontalColor-Logo.png alt="Systems Management Squad"></a></h1>
</div>
</div>
</header>
<div class=container>
<div id=content>
<div id=main class=fullwidth>
<article class="post type-post status-publish format-standard has-post-thumbnail hentry">
<div class=post-header>
<h1>Windows Virtual Desktop: Creation and Management</h1>
<p class=p-meta>
<span class=post-author><a href=/authors/jake>Jake Shackelford</a> / </span>
<span class=post-date>January 13, 2020 </span>
<span class=post-categories>/ Azure </span>
<span class=post-categories>/ Endpoint Management </span>
<span class=post-categories>/ How-To </span>
<span class=post-categories>/ Windows </span>
</p>
</div>
<div class=post-entry>
<h1 id=this-guide-is-now-outdated-with-the-release-of-wvd-20-i-will-create-a-new-blog-with-the-updated-info-in-the-future-some-of-the-info-below-is-still-valid><strong>THIS GUIDE IS NOW OUTDATED WITH THE RELEASE OF WVD 2.0, I will create a new blog with the updated info in the future! Some of the info below is still valid!</strong></h1>
<h2 id=why-windows-virtual-desktop>Why Windows Virtual Desktop?</h2>
<p>Windows Virtual Desktop allows you to create virtual Windows 10 machines that can be accessed from virtually anywhere. This means you can give someone a full desktop experience from virtually anywhere including android and iOS! In addition, if you do not want users to have a full desktop you can deploy specific applications which look and act like a native app on the machine, which can save you time and headaches when trying to deploy complex software.</p>
<h3 id=requirements>Requirements</h3>
<table>
<thead>
<tr>
<th>OS</th>
<th>Required license</th>
</tr>
</thead>
<tbody>
<tr>
<td>Windows 10 Enterprise multi-session or Windows 10 Enterprise</td>
<td>Microsoft 365 E3, E5, A3, A5, F1, Business</td>
</tr>
<tr>
<td>Windows E3, E5, A3, A5</td>
<td></td>
</tr>
</tbody>
</table>
<p>This guide assumes you have either <a href=https://docs.microsoft.com/azure/active-directory-domain-services/>Azure Active Directory Domain Services (Azure AD DS)</a> or a network connection from your Azure tenant to your on-premises network. In the following guide I will be going over the Azure AD DS method, but both are similar.</p>
<p>You will also need <a href=https://blog.itprocloud.de/Windows-Virtual-Desktop-Admin/>Marcel Meurer&rsquo;s tool</a> (I provide download links farther down). Several of the items I will be covering are a re-hash of what he has in his post but with more steps for using the tool and creating a master virtual machine (VM).</p>
<h2 id=2-creating-resource-groups>Creating Resource Groups</h2>
<ol>
<li>Login to the Azure portal <a href=https://portal.azure.com/>https://portal.azure.com/</a></li>
<li>Click the <strong>Create a resource</strong> button<div class=image>
<figure>
<a href=image-1.png target=_blank>
<img src=image-1.png alt="An image showing the heading &amp;ldquo;Azure services&amp;rdquo; with a button labeled &amp;ldquo;Create a resource&amp;rdquo;">
</a>
</figure>
</div></li>
<li>Search for Resource group</li>
<li>Create a Resource group called DOMAIN-Master-VMs or whatever you&rsquo;d like your golden images to be based off (YES WVD is essentially build and capture/reference image)</li>
<li>Create a second Resource group and give it whatever name you&rsquo;d like. EX. I&rsquo;m going to deploy AutoCAD so I&rsquo;ll name it DOMAIN-AutoCAD-HostPool</li>
</ol>
<h3 id=3-creating-a-service-principal-account>Creating a Service Principal Account</h3>
<p>We need to create a service principal account to access Marcel&rsquo;s UI and also grant permission to different resource groups in order to manage our WVD environment</p>
<ol>
<li>From the Azure Portal Dashboard, navigate to Azure Active Directory</li>
<li>Select App registrations</li>
<li>New Registration</li>
<li>Give your application a name; I chose &ldquo;svc_WVDAdmin</li>
<li>Leave the rest default</li>
<li>Select Register</li>
<li>Go to your newly created application</li>
<li>Record the Application client ID and Directory tenant ID for later</li>
<li>Select Certificates & Secrets</li>
<li>Create a new client secret</li>
<li>Select an expire date; I chose Never</li>
<li>Select Add and record the key value you are given as you can&rsquo;t ever see it again</li>
<li>While we are in AAD navigate to the overview page and record the Tenant Name which should be above the Tenant ID</li>
</ol>
<h3 id=4-granting-access-for-our-service-account>Granting Access for our Service account</h3>
<ol>
<li>Navigate to the two Resource groups we created earlier</li>
<li>Select Access Control (IAM)</li>
<li>Select Role assignments</li>
<li>Select Add</li>
<li>Select Role assignment</li>
<li>Role should be set to Contributor</li>
<li>Select should be set to your Service account; in this case svc_WVDAdmin</li>
<li>Select Save</li>
<li>Apply the same setup to your other resource group or any resource groups you want to create and manage WVD with</li>
</ol>
<h3 id=5-creating-a-wvd-tenant>Creating a WVD tenant</h3>
<p>Time for some powershell! The following powershell will add a WVD tenant. Please use an administrative account when signing in as you have to grant access for your tenant.</p>
<div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1><a style=outline:none;text-decoration:none;color:inherit href=#1>1</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2><a style=outline:none;text-decoration:none;color:inherit href=#2>2</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3><a style=outline:none;text-decoration:none;color:inherit href=#3>3</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4><a style=outline:none;text-decoration:none;color:inherit href=#4>4</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=5><a style=outline:none;text-decoration:none;color:inherit href=#5>5</a>
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=color:teal>$ApplicationID</span> = PASTE YOUR SERVICE PRINCIPAL ACCOUNT APP ID HERE
<span style=color:teal>$TenantName</span> = PASTE YOUR FULL TENANT NAME HERE
<span style=color:#0086b3>Install-Module</span> -Name Microsoft.RDInfra.RDPowerShell
<span style=color:#0086b3>Add-RdsAccount</span> -DeploymentUrl <span style=color:#d14>&#34;https://rdbroker.wvd.microsoft.com&#34;</span>
<span style=color:#0086b3>New-RdsRoleAssignment</span> -TenantName <span style=color:teal>$TenantName</span> -RoleDefinitionName <span style=color:#d14>&#34;RDS Owner&#34;</span> -ApplicationId <span style=color:teal>$ApplicationID</span>
</code></pre></td></tr></table>
</div>
</div><p><div class=image>
<figure>
<a href=powershell_rJBQfXUtgx.png target=_blank>
<img src=powershell_rJBQfXUtgx.png alt="An image showing a completed RDS role assignment">
</a>
</figure>
</div>
<em>Successful execution</em></p>
<h3 id=6-setting-up-marcels-tool-and-creating-a-network-share>Setting up Marcel&rsquo;s tool and creating a network share</h3>
<p>Earlier I mentioned I will be going over the method with Azure AD DS. I currently have a tools server in Azure that I&rsquo;m using to manage everything so I will be signing into that. This gives me access to view and manage Azure AD DS and install any other tools I might need such as WVD. One thing I don&rsquo;t cover in this guide is Network Security Groups. I would strongly suggest blocking all RDP access except from Specific IPs so that only you can access the MasterVMs and your tools server.</p>
<p>You will need to download 4 items at this point:</p>
<ol>
<li><a href=https://blog.itprocloud.de/assets/files/WVDAdmin.msi>Marcel&rsquo;s tool</a></li>
<li><a href=https://blog.itprocloud.de/assets/files/AutoUpdate/Scripts/ITPC-WVD-Image-Processing.ps1.txt>ITPC-WVD-Image-Processing.ps1</a></li>
<li><a href=https://query.prod.cms.rt.microsoft.com/cms/api/am/binary/RWrmXv>Microsoft.RDInfra.RDAgent.msi</a></li>
<li><a href=https://query.prod.cms.rt.microsoft.com/cms/api/am/binary/RWrxrH>Microsoft.RDInfra.RDAgentBootLoader.msi</a></li>
<li>Rename 2-4 to match the link text since they will be named incorrectly when you download them.</li>
</ol>
<p>With these downloaded, create the file share:</p>
<ol>
<li>Navigate to C:\ and create a folder called Configuration</li>
<li>Inside of your Configuration folder create a WVD folder</li>
<li>Right click the WVD folder and select Share</li>
<li>Give Everyone Read Access</li>
<li>Move the 3 files we downloaded and renamed earlier into this folder; it should look like the following<div class=image>
<figure>
<a href=mstsc_n4qL8uv5Vs.png target=_blank>
<img src=mstsc_n4qL8uv5Vs.png alt="An image showing windows explorer opened to &amp;ldquo;C:\Windows\Configuration\WVD&amp;rdquo;, with two msi files and one powershell script displayed">
</a>
</figure>
</div></li>
<li>Next install Marcel&rsquo;s tool. You can leave all the options to default</li>
</ol>
<h3 id=7-launching-the-tool>Launching the tool</h3>
<p>We are ready to at the very least get signed into the tool now!</p>
<ol>
<li>Launch the WVD Admin tool that we just installed</li>
<li>Input the Azure Tenant ID, Service Principal ID and the Principal Key you recorded earlier</li>
<li>Select Save</li>
<li>On the left-hand side select Reload All</li>
</ol>
<p>You should see two forests, one being your Tenant Name the other being Azure. If you expand your tenant name you will see the resource group for the host-pool we created earlier assuming the permissions were assigned properly. If you expand the Azure forest you will see Virtual Machines and Images. At this stage you shouldn&rsquo;t have much else since we haven&rsquo;t created any master VMs for our host pools.</p>
<h2 id=8-creating-master-vms>Creating Master VMs</h2>
<p>I hate to use the word master VMs as it really boils down to a golden image or the old build and capture mentality but that&rsquo;s currently what we have to work with in WVD.</p>
<ol>
<li>Navigate to the Master-VMs resource group we created earlier</li>
<li>Create a new resource by selecting the Add button</li>
<li>Search for Microsoft Windows 10 + Office 365 ProPlus (you do the + Office 365 ProPlus because the non-office version isn&rsquo;t the latest release of windows) and make sure you&rsquo;re selecting the latest version</li>
<li>Click Create<div class=image>
<figure>
<a href=GetImage.png target=_blank>
<img src=GetImage.png alt="An image depicting the controls to create a new Windows 10 + Office 365 ProPlus instance.">
</a>
</figure>
</div></li>
<li>For Virtual Machine name change it to whatever your preference in my case i&rsquo;ll be calling it AutoCAD after the program that I&rsquo;ll be installing</li>
<li>You can leave the Size default I typically select B2Ms as I like to penny pinch (Please note this server won&rsquo;t cost you anything other than the storage of the drive when we are done with it)</li>
<li>Scroll down and set an administrator account. This is a local admin account</li>
<li>Select Next: Disks</li>
<li>I change my disks to Standard HDD again to save on costs.</li>
<li>Select Next: Networking</li>
<li>Select the Virtual Network that your Azure AD DS exists on</li>
<li>Change the subnet as needed</li>
<li>Select Next: Management</li>
<li>Turn off Boot Diagnostics</li>
<li>Select Review and Create</li>
<li>Select Create</li>
<li>It will take a few minutes for the VM to deploy</li>
<li>Once it has deployed, connect to the VM via RDP</li>
<li>Install your applications (You can have as many applications as you want. In fact it&rsquo;s easier to manage if you put them all on one VM but this is up to your discretion)</li>
<li>Make a note of the full path to the .exe of the programs you want to give access to</li>
<li>Install Windows Updates</li>
<li>Restart and check for more Updates</li>
<li>Once updates are done Disable the Windows Update Service</li>
<li>Domain join the machine</li>
<li>Make any registry changes you want. I personally use the list below</li>
<li>Shutdown the VM</li>
</ol>
<div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1><a style=outline:none;text-decoration:none;color:inherit href=#1> 1</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2><a style=outline:none;text-decoration:none;color:inherit href=#2> 2</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3><a style=outline:none;text-decoration:none;color:inherit href=#3> 3</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4><a style=outline:none;text-decoration:none;color:inherit href=#4> 4</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=5><a style=outline:none;text-decoration:none;color:inherit href=#5> 5</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=6><a style=outline:none;text-decoration:none;color:inherit href=#6> 6</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=7><a style=outline:none;text-decoration:none;color:inherit href=#7> 7</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=8><a style=outline:none;text-decoration:none;color:inherit href=#8> 8</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=9><a style=outline:none;text-decoration:none;color:inherit href=#9> 9</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=10><a style=outline:none;text-decoration:none;color:inherit href=#10>10</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=11><a style=outline:none;text-decoration:none;color:inherit href=#11>11</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=12><a style=outline:none;text-decoration:none;color:inherit href=#12>12</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=13><a style=outline:none;text-decoration:none;color:inherit href=#13>13</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=14><a style=outline:none;text-decoration:none;color:inherit href=#14>14</a>
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=15><a style=outline:none;text-decoration:none;color:inherit href=#15>15</a>
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>reg add <span style=color:#d14>&#34;HKLM\SOFTWARE\Policies\Microsoft\Windows NT\Terminal Services&#34;</span> /v RemoteAppLogoffTimeLimit /t REG_DWORD /d 0 /f 

reg add <span style=color:#d14>&#34;HKLM\SOFTWARE\Policies\Microsoft\Windows NT\Terminal Services&#34;</span> /v fResetBroken /t REG_DWORD /d 1 /f 

reg add <span style=color:#d14>&#34;HKLM\SOFTWARE\Policies\Microsoft\Windows NT\Terminal Services&#34;</span> /v MaxConnectionTime /t REG_DWORD /d 10800000 /f 

reg add <span style=color:#d14>&#34;HKLM\SOFTWARE\Policies\Microsoft\Windows NT\Terminal Services&#34;</span> /v RemoteAppLogoffTimeLimit /t REG_DWORD /d 0 /f 

reg add <span style=color:#d14>&#34;HKLM\SOFTWARE\Policies\Microsoft\Windows NT\Terminal Services&#34;</span> /v MaxDisconnectionTime /t REG_DWORD /d 5000 /f 

reg add <span style=color:#d14>&#34;HKLM\SOFTWARE\Policies\Microsoft\Windows NT\Terminal Services&#34;</span> /v MaxIdleTime /t REG_DWORD /d 10800000 /f 

reg add <span style=color:#d14>&#34;HKLM\SOFTWARE\Policies\Microsoft\Windows NT\Terminal Services&#34;</span> /v fEnableTimeZoneRedirection /t REG_DWORD /d 1 /f 

reg add <span style=color:#d14>&#34;HKCU\Software\Microsoft\Windows\CurrentVersion\StorageSense\Parameters\StoragePolicy&#34;</span> /v 01 /t REG_DWORD /d 0 /f 
</code></pre></td></tr></table>
</div>
</div><h3 id=9-creating-a-template-image>Creating a Template Image</h3>
<p>Now that we have a VM that&rsquo;s ready to go let&rsquo;s create a template of it! Using this method, the tool creates a temporary VM and creates an image based off that temporary VM. Once it&rsquo;s done the temporary VM is deleted and you&rsquo;re left with your original VM and a template image. This is great because if we want to go back and apply updates to the applications or windows itself we can boot up the original VM apply our changes and make a new template image from it.</p>
<ol>
<li>Open WVD Admin tool</li>
<li>Select Reload all</li>
<li>Expand the Azure tab</li>
<li>Expand your Virtual machines</li>
<li>Expand your Resource groups</li>
<li>Right click on the VM we want to create a template of</li>
<li>Select Create a template image</li>
<li>On the left-hand side you&rsquo;ll want to give the Image a name or keep what&rsquo;s defaulted</li>
<li>Make sure the Template VM is the one you selected</li>
<li>Target RG should be the resource group where you want this template to live in my case I keep them in my MasterVMS resource group</li>
<li>Script path is going to be the full path name where we have the 3 configuration files we added to our share earlier (EX: \Server.Contoso.com\Confiration\WVD</li>
<li>Select Capture</li>
<li>This process takes on average about 10 minutes</li>
</ol>
<h3 id=creating-a-host-pool>Creating a host pool</h3>
<p><div class=image>
<figure>
<a href=giphy.gif target=_blank>
<img src=giphy.gif alt="A short gif of a man from a tv show mouthing &amp;ldquo;so close&amp;rdquo;">
</a>
</figure>
</div><br>
Now that we have a template image, we are ready to create the host pool!</p>
<ol>
<li>Navigate to your Tenant name on the left-hand side</li>
<li>Right click on your tenant</li>
<li>You will have 2 options one being Shared the other being Persistent/VDI in this scenario we are going to select Shared</li>
<li>Select a name for the resource. In my case I&rsquo;ll call it AutoCAD</li>
<li>Navigate back to Azure and expand Images</li>
<li>Expand your Resource Groups</li>
<li>Right click the image that we created earlier</li>
<li>Select Create a session host from image</li>
<li>Your screen at this point should look like this:<div class=image>
<figure>
<a href=mstsc_dJ47TcxRQX.png target=_blank>
<img src=mstsc_dJ47TcxRQX.png alt="An image of the &amp;ldquo;rollout&amp;rdquo; tab">
</a>
</figure>
</div></li>
<li>First we can apply a VM Name. You&rsquo;ll notice at the end we have ###, this will auto number the VM based on the Count to the right so if I have a count of two it will create two VMs in the host pool called WVD-PROD-001 and WVD-PROD-002</li>
<li>We will select our Image</li>
<li>Select the host pool we created at the beginning of these steps</li>
<li>Select your subnet</li>
<li>Select the resource group you&rsquo;d like these servers to live in (EX I&rsquo;ll be using the resource group we created earlier DOMAIN-AutoCAD-HostPool )</li>
<li>Select your Disk and Size in my case I use PremiumLRS or UltraSSDLRS</li>
<li>For Size I usually go with Standard B4ms however this will vary on the app and will take some testing to properly size</li>
<li>Domain User and Password should be pretty straight forward, in this case since we are using Azure AD DS we use the full email address and password of someone who&rsquo;s allowed to domain join a machine</li>
<li>You will want to check the License as Windows Client checkbox if you meet the licensing requirements listed earlier in this post as it will save you roughly 40% on VM costs ***</li>
<li>OU should be set to the OU you&rsquo;d like the machine joined too; in this case I will be selecting the Azure AD DC Computers OU located on my Azure AD DS</li>
<li>Domain FQDN should be straight forward simply put your domain name (EX contoso.com)</li>
<li>Local admin and password will be the local administrator account on the newly created VMs</li>
<li>Script path should be set to the same path as when we created an image template (EX: \Server.Contoso.com\Confiration\WVD)</li>
<li>Select Start Rollout</li>
<li>The time for this can vary based on machine size and number of machines</li>
<li>Once completed, you will be able to go to the resource you created under your tenant and see the Session Hosts</li>
</ol>
<p>*** Note that if you are using forced tunneling in your environment that your activation will fail. See the following links for more details:</p>
<ul>
<li><a href=https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-forced-tunneling-rm>Forced Tunneling</a></li>
<li><a href=https://docs.microsoft.com/azure/virtual-machines/troubleshooting/custom-routes-enable-kms-activation>Failed KMS Activation</a></li>
</ul>
<h3 id=assigning-groups-and-access>Assigning Groups and Access</h3>
<p>Now that we have a host-pool we can start assigning access to them. On the resource we created earlier under our tenant in the WVD Admin application you should be able to see the session hosts that we just made. You&rsquo;ll also notice that a tab called Host Pool opens up.<br>
<div class=image>
<figure>
<a href=mstsc_8jOwEORRJs.png target=_blank>
<img src=mstsc_8jOwEORRJs.png alt="An image depicting the &amp;ldquo;Host Pool&amp;rdquo; tab">
</a>
</figure>
</div></p>
<p>From here we can change several things; the two important ones being the Max Session Limit and Load Balancer Type. Max Session limit should be pretty straight forward, how many sessions can each VM in the Session host accept. Load Balancer Type gives you three options:</p>
<ol>
<li>Breadth First - Users will be evenly spread out across all the VMs in the host pool</li>
<li>Depth First - Users will be loaded up onto the first VM until the max session limit is reached and then loaded onto the next</li>
<li>Persistent - When a user signs in for the first time they will always logon to the same VM in the pool</li>
</ol>
<p>In my experience Breath First is the one to go with as it will cause the least amount of hiccups performance wise, it&rsquo;s also selected by default.</p>
<p>Now that we have that set, we have two options on the type of groups we can create:</p>
<ol>
<li>Application Groups - This grants access to a specific app and not the entire environment, if you are using the Remote Desktop application these apps will appear as if they are native apps on the machine</li>
<li>Desktop Group - This will grant users to a full windows environment with all apps installed on the machine</li>
</ol>
<p>In this scenario we will create an application group as a Desktop group is very straight forward</p>
<ol>
<li>Select the resource that contains your session Hosts</li>
<li>Right click and select Add Application Group</li>
<li>Give the group a name (EX AutoCAD)</li>
<li>Right click the newly created group and select Add Remote Application</li>
<li>Give it a name as well (EX Revit):<div class=image>
<figure>
<a href=mstsc_uuyZLfch9A.png target=_blank>
<img src=mstsc_uuyZLfch9A.png alt="An image of the &amp;ldquo;Remote App&amp;rdquo; tab">
</a>
</figure>
</div></li>
<li>I personally set CLI settings to DoNotAllow because I&rsquo;m not passing any Azure CLI commands to these VMs (More info can be found <a href="https://docs.microsoft.com/cli/azure/?view=azure-cli-latest">HERE</a>)</li>
<li>File Path will be the path to the EXE that you should have copied down earlier when installing your applications, you can also set Icon Path to this as well</li>
<li>If you want the app to appear in a folder you can give it a folder name, but I personally do not</li>
<li>Friendly name is the name the app will appear as in the web feed or remote desktop application</li>
<li>Select Save Changes</li>
</ol>
<p>We are almost there! Take a minute to breathe or grab a drink!<br>
<div class=image>
<figure>
<a href=giphy-1.gif target=_blank>
<img src=giphy-1.gif alt="a gif depicting a woman breathing into a paper bag to calm down">
</a>
</figure>
</div></p>
<p>Next, we are going to assign access to the application group we made. Currently in WVD we have to do manual assignments&mldr; it does not support groups but will in the future.</p>
<ol>
<li>Go to the application group we created (EX AutoCAD)</li>
<li>You will notice under the App Group tab there is a blank box on the right-hand side</li>
<li>Right click in that box and select Add</li>
<li>Type in the users who need access to these apps (EX <a href=mailto:Joe@contoso.com>Joe@contoso.com</a>; <a href=mailto:mary@contoso.com>mary@contoso.com</a>)</li>
<li>Select Ok</li>
<li>Right clicking and selecting refresh will show you the users who currently have access<br>
You did it you&rsquo;re done! Aside from having to test said applications!</li>
</ol>
<p>To access these apps you can use one of the following:</p>
<p><a href=https://aka.ms/wvd/clients/windows>Remote Desktop Client</a>
<a href=https://rdweb.wvd.microsoft.com/webclient/index.html>Remote Desktop Web client</a></p>
<p>I strongly recommend using the Remote Desktop Client option as the second just loads the app in a webpage. Once downloaded and installed you can subscribe with the user you granted access to and you should see the applications that were granted. If you double click on the app you will be prompted to sign in (Currently SSO only works with ADFS this will change in the future). The first sign in will be a little slower as it&rsquo;s creating a profile for the user in the background. This can be alleviated with solutions such as <a href=https://docs.microsoft.com/fslogix/overview>FSLogix</a> which is very easy to setup. In any event we are done and you&rsquo;re now the proud owner of a WVD environment.</p>
<img src=/authors/jake/avatar.png alt="Photo of Jake Shackelford"><br>
<strong>Jake Shackelford</strong>
<em>Admin/Contributor</em>
<div>
<a href=https://twitter.com/shackelfjaco><img src=/img/social/twitter.png></a>
</div>
<p>Jake is one of our Admins but also our inaugural author and the main reason SysManSquad exists today.</p>
<hr>
</div>
<div class=post-share>
<div class="post-share-box share-comments">
hello
</div>
</div>
<comments id=comments>
<script src=https://utteranc.es/client.js repo=SysManSquad/sysmansquadblog issue-term=title label="blog comment" theme=github-light crossorigin=anonymous async></script>
</comments>
</article>
</div>
</div>
</div>
<footer id=footer>
<div class=container>
<div id=footer-copyright>
<p class=copyright>&copy; 2022 WinAdmins - https://blog.sysmansquad.com - Systems Management Squad</a></p>
</div>
</div>
</footer>
</div>
</body>
</html>