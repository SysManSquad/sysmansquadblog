<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=keyword content="ConfigMgr Microsoft Intune Windows WinAdmins"><meta name=viewport content="width=device-width"><meta name=description content="A community blog and subsidiary of WinAdmins.io"><link rel="shortcut icon" href=/img/favicon.ico><title>Import Intune Assets into ServiceNow without the costly plugins-SysManSquad | Systems Management Squad</title><link rel=canonical href=/2022-05-20-import-intune-assets-into-servicenow-without-the-costly-plugin/><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=https://sysmansquad.com/css/custom.css><script src=https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js></script>
<script src=https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js></script>
<script src=https://sysmansquad.com/js/jquery.slicknav.js></script>
<script src=https://sysmansquad.com/js/asd_SlickNav_Mobile.js></script>
<script src=https://sysmansquad.com/js/clipboard.js></script>
<script src=https://sysmansquad.com/js/custom.js></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XXZR1RSQYX"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XXZR1RSQYX",{anonymize_ip:!1})}</script><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://sysmansquad.com/83"><meta name=twitter:title content="Import Intune Assets into ServiceNow without the costly plugins"><meta name=twitter:description content="In cases where an organization does not want to pay the hefty cost of servcenow’s integration hub, there is a way to still be able to import your intune assets into servicenow via the ms service graph api.
In this guide, we will be retrieving Intune assets and importing them into the ServiceNow CMDB.
Azure Setup Register an app to use Microsoft Graph API:
Sign in to the Microsoft Endpoint Manager admin center using administrative credentials."></head><body class="home blog"><div id=asd-container><div id=top-bar><div class=container><div id=nav-wrapper><ul class=menu id=menu-top-menu><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/>Home</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/about/><span>About</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=https://github.com/SysManSquad><span>GitHub</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/jointhesquad/><span>Join the Squad</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/meetthesquad/><span>Meet the Squad</span></a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=#><span>MORE></span></a><ul class="sub-menu menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href=/contact/>Contact</a></li></ul></li></ul></div><div id=top-search><a href=# class=search><i class="fa fa-search"></i></a><div class=show-search><form role=search method=get action=https://www.google.com/search id=searchform><input type=search placeholder="Search and hit enter..." name=q id=q title="Search and hit enter...">
<input type=hidden name=sitesearch value=https://sysmansquad.com>
<button type=submit value=Search class=searchbutton></form></div></div><div class=menu id=menu-mobile></div></div></div><header id=header class=noslider><div class=container><div id=logo><h1><a href=https://sysmansquad.com><img src=/img/SysManSquad-HorizontalColor-Logo.png alt="Systems Management Squad"></a></h1></div></div></header><div class=container><div id=content><div id=main class=fullwidth><article class="post type-post status-publish format-standard has-post-thumbnail hentry"><div class=post-header><h1>Import Intune Assets into ServiceNow without the costly plugins</h1><p class=p-meta><span class=post-author><a href=/authors/jeremy>Jeremy Hamilton</a> /</span>
<span class=post-date>May 20, 2022</span>
<span class=post-categories>/ Endpoint Management</span></p></div><div class=post-entry><p>In cases where an organization does not want to pay the hefty cost of servcenow’s integration hub, there is a way to still be able to import your intune assets into servicenow via the ms service graph api.</p><p>In this guide, we will be retrieving Intune assets and importing them into the ServiceNow CMDB.</p><h2 id=azure-setup>Azure Setup</h2><p>Register an app to use Microsoft Graph API:</p><ul><li>Sign in to the Microsoft Endpoint Manager admin center using administrative credentials. As appropriate, you may use:<ul><li>The tenant admin account.</li><li>A tenant user account with the <strong>Users can register applications</strong> setting enabled.</li></ul></li><li>Select <strong>All services > M365 Azure Active Directory > Azure Active Directory > App registrations</strong>.</li></ul><p><div class=image><figure><a href=image-4.png target=_blank><img src=image-4.png alt=Screenshot></a></figure></div></p><ul><li>Either choose <strong>New registration</strong> to create a new application or choose an existing application. (If you choose an existing application, skip the next step.)</li><li>In the <strong>Register an application</strong> pane, specify the following:<ul><li>A <strong>Name</strong> for the application (displayed when users sign in).</li><li>The <strong>Supported account type</strong>.</li><li>A <strong>Redirect URI</strong> value. This value is option.</li></ul></li><li>From the application pane:<ul><li>Note the <strong>Application (client) ID</strong> value.</li><li>Select <strong>API permissions</strong>.</li></ul></li></ul><p>From the <strong>API permissions</strong> pane, choose Add a permission > Microsoft APIs > Microsoft Graph. Then, select the type of permissions your application requires. For ServiceNow, I have the following permissions:</p><p><div class=image><figure><a href=image-5.png target=_blank><img src=image-5.png alt=Screenshot></a></figure></div></p><h2 id=create-the-application-secret>Create the Application Secret:</h2><p><div class=image><figure><a href=image-6.png target=_blank><img src=image-6.png alt=Screenshot></a></figure></div></p><ul><li>Once the app is registered in Azure, write down the following information:
Application Secret<ul><li>Tenant ID</li><li>Client ID</li></ul></li></ul><h2 id=authentication>Authentication</h2><p>In the Microsoft documentation, they tell us to use OAuth2.0 to authenticate. First, let’s make sure your instance has OAuth2.0 enabled. Go in to your system properties, and make sure <code>com.snc.platform.security.oauth.is.active</code> is set to true.</p><h2 id=procedure>Procedure</h2><ul><li>On the <strong>ServiceNow console</strong>, in the <strong>Filter</strong> navigator, type <strong>sys_properties.list</strong> and press the <strong>Enter</strong> key.</li><li>On the <strong>System Properties</strong> window, search for <strong>com.snc.platform.security.oauth.is.active</strong> and verify if the value is set to true.</li></ul><p><div class=image><figure><a href=image-14-1024x264.png target=_blank><img src=image-14-1024x264.png alt=Screenshot></a></figure></div></p><p>If the entry does not exist:</p><ul><li>Enter <strong>sys_properties.list</strong> in the Workspace filter navigator of ServiceNow and click <strong>New</strong>.</li><li>Fill out the form with the following settings:<ul><li><strong>Name</strong>: com.snc.platform.security.oauth.is.active</li><li><strong>Type</strong>: true | false</li><li><strong>Value</strong>: true</li></ul></li><li>In your ServiceNow instance, lets create an application registry. Navigate to System OAuth > Application Registry. Here are the fields you need to fill out:</li></ul><table><thead><tr><th>Field</th><th>Value</th></tr></thead><tbody><tr><td>Name</td><td>Azure Authentication (can be anything)</td></tr><tr><td>Client ID</td><td>Azure App client ID</td></tr><tr><td>Client Secret</td><td>Azure App secret</td></tr><tr><td>Default Grant Type</td><td>Client Credentials</td></tr><tr><td>Token URL</td><td><a href=https://login.microsoftonline.com/%7BtenantID%7D/oauth2/v2.0/token>https://login.microsoftonline.com/{tenantID}/oauth2/v2.0/token</a></td></tr><tr><td>Redirect URL</td><td><a href=https://instance-name.service-now.com/oauth_redirect.do>https://instance-name.service-now.com/oauth_redirect.do</a></td></tr></tbody></table><p><div class=image><figure><a href=image-7.png target=_blank><img src=image-7.png alt=Screenshot></a></figure></div></p><ul><li>Now you will have to create an OAuth Entity Profile and choose the provider you just created. Once this is done, you will need to create the OAuth Entity Scope. The OAuth scope is <code>https://graph.microsoft.com/.default</code>.</li></ul><p><div class=image><figure><a href=image-8.png target=_blank><img src=image-8.png alt=Screenshot></a></figure></div></p><p><div class=image><figure><a href=image-9.png target=_blank><img src=image-9.png alt=Screenshot></a></figure></div></p><p><div class=image><figure><a href=image-10.png target=_blank><img src=image-10.png alt=Screenshot></a></figure></div></p><h2 id=get-the-payload>Get the Payload</h2><p>We will now test the connection by generating a token with your application registry. Navigate to System Web Services > REST Messages and create a new one. Name the message anything you want, and add a description. The endpoint URL is what you can change depending on what information you need. Follow this link to find more managedDevice methods in the graph API.</p><p>For this guide, I want to list all devices in my environment. So the URL I will use is: <code>https://graph.microsoft.com/beta/deviceManagement/managedDevices</code>.</p><ul><li>Select OAuth2.0 as the authentication type, and choose your profile you created above. Once complete, click the “Get OAuth Token” related link and make sure the OAuth2.0 flow completes. If it fails, you will need to double check your configuration in the registry you made.</li><li>After you have received the OAuth token, you can now test your REST message. Scroll down to HTTP Methods and open your Default GET record (you shouldn’t have to change anything on this record, but make sure it is a GET request). Scroll down and click the Test related link.</li></ul><p><div class=image><figure><a href=image-11.png target=_blank><img src=image-11.png alt=Screenshot></a></figure></div><div class=image><figure><a href=image-12.png target=_blank><img src=image-12.png alt=Screenshot></a></figure></div></p><h2 id=prepare-for-import>Prepare for import</h2><p>Once we have the JSON payload, we will need to create an import set table for these objects to import into. Copy/paste the payload(from the “test” link you just clicked in to any online <a href=https://codebeautify.org/jsonviewer>JSON beautifier</a> tool, then convert one of the objects in the payload in to a CSV file. Here is an example of what your payload should look like.</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-1> 1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-2> 2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-3> 3</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-4> 4</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-5> 5</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-6> 6</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-7> 7</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-8> 8</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-9> 9</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-10>10</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-11>11</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-12>12</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-13>13</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-14>14</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-15>15</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-16>16</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-17>17</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>      <span style=color:navy>&#34;id&#34;</span>: <span style=color:#d14>&#34;&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:navy>&#34;userId&#34;</span>: <span style=color:#d14>&#34;&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:navy>&#34;deviceName&#34;</span>: <span style=color:#d14>&#34;&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:navy>&#34;managedDeviceOwnerType&#34;</span>: <span style=color:#d14>&#34;&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:navy>&#34;enrolledDateTime&#34;</span>: <span style=color:#d14>&#34;&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:navy>&#34;lastSyncDateTime&#34;</span>: <span style=color:#d14>&#34;&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:navy>&#34;operatingSystem&#34;</span>: <span style=color:#d14>&#34;&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:navy>&#34;complianceState&#34;</span>: <span style=color:#d14>&#34;&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:navy>&#34;jailBroken&#34;</span>: <span style=color:#d14>&#34;&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:navy>&#34;managementAgent&#34;</span>: <span style=color:#d14>&#34;&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:navy>&#34;osVersion&#34;</span>: <span style=color:#d14>&#34;&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:navy>&#34;easActivated&#34;</span>: ,
</span></span><span style=display:flex><span>      <span style=color:navy>&#34;easDeviceId&#34;</span>: <span style=color:#d14>&#34;&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:navy>&#34;easActivationDateTime&#34;</span>: <span style=color:#d14>&#34;&#34;</span> 
</span></span><span style=display:flex><span>      <span style=color:#a61717;background-color:#e3d2d2>...etc</span>
</span></span><span style=display:flex><span> }
</span></span></code></pre></td></tr></table></div></div><p><a href=intune_import.csv>Intune Import Download</a></p><p>Now we will <a href=https://json-csv.com/>convert this to a CSV file</a>. The point to this step is so the import set table has the correct fields for us to map to.</p><p>Once you have the CSV file, go to <strong>Load Data</strong> in the navigator and create a new table. Name it whatever you’d like, but remember it. Upload the CSV file you made and make sure the import set table has all the fields you want to map to from the payload.</p><h2 id=import-the-devices>Import the devices</h2><p>Create a scheduled job to run the REST message.</p><p>You can decide on how you want to classify your CI’s in your CMDB. In my payload, I only have one class (Windows) however if you have more than one class, you will need to create additional jobs to those respectful classes. There are alternative ways of classifying your devices into ServiceNow, this is just the way I went about it.</p><p>Go to <strong>System Definition > Scheduled Jobs</strong> and create a new scheduled job. I have it set to run daily and I’ve named it “Get Windows devices from Intune”. Here is the script for the scheduled job:</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-1> 1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-2> 2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-3> 3</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-4> 4</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-5> 5</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-6> 6</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-7> 7</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-8> 8</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-9> 9</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-10>10</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-11>11</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-12>12</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-13>13</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-14>14</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-15>15</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-16>16</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-17>17</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-18>18</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-19>19</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-20>20</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-21>21</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-22>22</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-23>23</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-24>24</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-25>25</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-26>26</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-27>27</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-28>28</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-29>29</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-30>30</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-31>31</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-32>32</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-33>33</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-34>34</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-35>35</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-36>36</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-37>37</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-38>38</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-39>39</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-40><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-40>40</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-41><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-41>41</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-42><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-42>42</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-43><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-43>43</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-44><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-44>44</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-45><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-45>45</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-46><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-46>46</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-47><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-47>47</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-48><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-48>48</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-49><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-49>49</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-50><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-50>50</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-51><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-51>51</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-52><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-52>52</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-53><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-53>53</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-54><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-54>54</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-55><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-55>55</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-56><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-56>56</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-57><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-57>57</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-58><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-58>58</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-59><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-59>59</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-60><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-60>60</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-61><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-61>61</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-62><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-62>62</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-63><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-63>63</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-64><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-64>64</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-65><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-65>65</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-66><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-66>66</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-67><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-67>67</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-68><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-68>68</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-69><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-69>69</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#000;font-weight:700>try</span> {
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>var</span> machines <span style=color:#000;font-weight:700>=</span> [];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>function</span> getMachines(endpoint, machines) {
</span></span><span style=display:flex><span>        gs.info(<span style=color:#d14>&#39;in getMachines with endpoint: &#39;</span> <span style=color:#000;font-weight:700>+</span> endpoint);
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>var</span> pagedR <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>new</span> sn_ws.RESTMessageV2(<span style=color:#d14>&#39;CHA_Intune_RestAPI&#39;</span>, <span style=color:#d14>&#39;Get All Devices&#39;</span>); <span style=color:#998;font-style:italic>// Replace the first parameter with the name of your REST message.
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span>        <span style=color:#000;font-weight:700>if</span> (endpoint <span style=color:#000;font-weight:700>!==</span> <span style=color:#000;font-weight:700>null</span>) {
</span></span><span style=display:flex><span>            pagedR.setEndpoint(endpoint);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>var</span> pagedResponse <span style=color:#000;font-weight:700>=</span> pagedR.execute();
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>var</span> pagedResponseBody <span style=color:#000;font-weight:700>=</span> pagedResponse.getBody();
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>var</span> pagedhttpStatus <span style=color:#000;font-weight:700>=</span> pagedResponse.getStatusCode();
</span></span><span style=display:flex><span>        gs.info(<span style=color:#d14>&#39;windowsMachine response Status: &#39;</span> <span style=color:#000;font-weight:700>+</span> pagedResponseBody);
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>var</span> pagedObj <span style=color:#000;font-weight:700>=</span> JSON.parse(pagedResponseBody);
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>var</span> newMachines <span style=color:#000;font-weight:700>=</span> pagedObj.value.filter(<span style=color:#000;font-weight:700>function</span>(device) {
</span></span><span style=display:flex><span>            <span style=color:#998;font-style:italic>//This is the snippet that filters out only Windows devices. Hence the Windows only shceduled job.
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span>            <span style=color:#000;font-weight:700>if</span> (device.operatingSystem <span style=color:#000;font-weight:700>==</span> <span style=color:#d14>&#34;Windows&#34;</span>) {
</span></span><span style=display:flex><span>                <span style=color:#000;font-weight:700>return</span> <span style=color:#000;font-weight:700>true</span>;
</span></span><span style=display:flex><span>            } <span style=color:#000;font-weight:700>else</span> {
</span></span><span style=display:flex><span>                <span style=color:#000;font-weight:700>return</span> <span style=color:#000;font-weight:700>false</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>        gs.info(endpoint <span style=color:#000;font-weight:700>+</span> <span style=color:#d14>&#39; : &#39;</span> <span style=color:#000;font-weight:700>+</span> newMachines.length);
</span></span><span style=display:flex><span>        machines <span style=color:#000;font-weight:700>=</span> machines.concat(newMachines);
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>if</span> (pagedObj[<span style=color:#d14>&#34;@odata.nextLink&#34;</span>]) { <span style=color:#998;font-style:italic>// if it has paged results
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span>            getMachines(pagedObj[<span style=color:#d14>&#34;@odata.nextLink&#34;</span>], machines);
</span></span><span style=display:flex><span>        } <span style=color:#000;font-weight:700>else</span> {
</span></span><span style=display:flex><span>            gs.info(<span style=color:#d14>&#39;machines.length: &#39;</span> <span style=color:#000;font-weight:700>+</span> machines.length);
</span></span><span style=display:flex><span>            machines.forEach(<span style=color:#000;font-weight:700>function</span>(machine) {
</span></span><span style=display:flex><span>                gs.info(<span style=color:#d14>&#39;in foreach&#39;</span>);
</span></span><span style=display:flex><span>                <span style=color:#000;font-weight:700>var</span> intuneImport <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>new</span> GlideRecord(<span style=color:#d14>&#39;u_cha_intune_import_data&#39;</span>); <span style=color:#998;font-style:italic>// Replace with your Import set table name
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span>                intuneImport.initialize();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#998;font-style:italic>//Set each field in the table to the correct data from payload
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span>                <span style=color:#000;font-weight:700>for</span> (<span style=color:#000;font-weight:700>var</span> key <span style=color:#000;font-weight:700>in</span> machine) {
</span></span><span style=display:flex><span>                    <span style=color:#000;font-weight:700>if</span> (machine.hasOwnProperty(key)) {
</span></span><span style=display:flex><span>                        <span style=color:#000;font-weight:700>var</span> field <span style=color:#000;font-weight:700>=</span> key.toLowerCase();
</span></span><span style=display:flex><span>                        <span style=color:#000;font-weight:700>var</span> value <span style=color:#000;font-weight:700>=</span> (<span style=color:#000;font-weight:700>function</span>() {
</span></span><span style=display:flex><span>                            <span style=color:#000;font-weight:700>if</span> (<span style=color:#000;font-weight:700>typeof</span> machine[key] <span style=color:#000;font-weight:700>===</span> <span style=color:#d14>&#34;number&#34;</span>) {
</span></span><span style=display:flex><span>                                <span style=color:#000;font-weight:700>return</span> machine[key].toString();
</span></span><span style=display:flex><span>                            } <span style=color:#000;font-weight:700>else</span> {
</span></span><span style=display:flex><span>                                <span style=color:#000;font-weight:700>return</span> machine[key];
</span></span><span style=display:flex><span>                            }
</span></span><span style=display:flex><span>                        })()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                        <span style=color:#000;font-weight:700>var</span> actualField <span style=color:#000;font-weight:700>=</span> <span style=color:#d14>&#39;u_&#39;</span> <span style=color:#000;font-weight:700>+</span> field;
</span></span><span style=display:flex><span>                        <span style=color:#000;font-weight:700>if</span> (intuneImport.isValidField(actualField)) {
</span></span><span style=display:flex><span>                            gs.info(<span style=color:#d14>&#39;setting (short)[&#39;</span> <span style=color:#000;font-weight:700>+</span> actualField <span style=color:#000;font-weight:700>+</span> <span style=color:#d14>&#39;]:&#39;</span> <span style=color:#000;font-weight:700>+</span> value);
</span></span><span style=display:flex><span>                            intuneImport.setValue(actualField, value);
</span></span><span style=display:flex><span>                        } <span style=color:#000;font-weight:700>else</span> {
</span></span><span style=display:flex><span>                            <span style=color:#000;font-weight:700>var</span> begin <span style=color:#000;font-weight:700>=</span> field.substring(<span style=color:#099>0</span>, <span style=color:#099>12</span>);
</span></span><span style=display:flex><span>                            <span style=color:#000;font-weight:700>var</span> end <span style=color:#000;font-weight:700>=</span> field.substring(field.length <span style=color:#000;font-weight:700>-</span> <span style=color:#099>14</span>, field.length);
</span></span><span style=display:flex><span>                            <span style=color:#000;font-weight:700>var</span> calculatedField <span style=color:#000;font-weight:700>=</span> <span style=color:#d14>&#39;u_&#39;</span> <span style=color:#000;font-weight:700>+</span> begin <span style=color:#000;font-weight:700>+</span> <span style=color:#d14>&#39;_&#39;</span> <span style=color:#000;font-weight:700>+</span> end;
</span></span><span style=display:flex><span>                            gs.info(<span style=color:#d14>&#39;setting (long)[&#39;</span> <span style=color:#000;font-weight:700>+</span> calculatedField <span style=color:#000;font-weight:700>+</span> <span style=color:#d14>&#39;]:&#39;</span> <span style=color:#000;font-weight:700>+</span> value);
</span></span><span style=display:flex><span>                            intuneImport.setValue(calculatedField, value);
</span></span><span style=display:flex><span>                        }
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                intuneImport.insert();
</span></span><span style=display:flex><span>            });
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    getMachines(<span style=color:#000;font-weight:700>null</span>, machines);
</span></span><span style=display:flex><span>} <span style=color:#000;font-weight:700>catch</span> (ex) {
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>var</span> message <span style=color:#000;font-weight:700>=</span> ex.message;
</span></span><span style=display:flex><span>    gs.info(<span style=color:#d14>&#39;ERROR: &#39;</span> <span style=color:#000;font-weight:700>+</span> message);
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p><strong>Make sure you replace line 6 with your REST message, and line 31 with your import set table name. In my case:</strong></p><blockquote><p>Line 6: CHA_Intune_RestAPI</p><p>Line 31: u_cha_intune_import_data</p></blockquote><p>This script is essentially calling the REST message you created, parsing the payload, creating a record for each device from your payload, and finally importing them into your import set table.</p><h2 id=transforming-your-cis-into-the-cmdb>TRANSFORMING YOUR CIS INTO THE CMDB</h2><p>Finally, you will need to create a transform map for your import set table. Navigate to <strong>System Import Sets > Create Transform Map</strong>. Name it anything you’d like and choose your import set table as the source table. The target table should be the CMDB table you want to import the devices into. Map the appropriate fields from the import set table to the CMDB table and make sure you set a coalesce on a field that is unique to each device. I used serial_number.</p><p><div class=image><figure><a href=image-13.png target=_blank><img src=image-13.png alt=Screenshot></a></figure></div></p><p>Hopefully some of this made sense and you were able to piece together a working solution to grab these assets. This is my first entry so forgive me if anything was missing. Always feel free to reach out on the WinAdmins discord (<a href=https://discord.gg/winadmins)or>https://discord.gg/winadmins)or</a> you can PM me directly on Discord (Deemer#1337)</p><h2 id=credit>Credit:</h2><ul><li><a href=https://mavembry.info/post/intune-servicenow-integration/>Integrating Microsoft Intune with ServiceNow | (mavembry.info)</a></li><li><a href=https://docs.microsoft.com/en-us/mem/intune/developer/intune-graph-apis>How to use Azure AD to access Intune APIs in Microsoft Graph – Microsoft Intune | Microsoft Docs</a></li></ul><img src=/authors/jeremy/avatar.png alt="Photo of Jeremy Hamilton"><br><strong>Jeremy Hamilton</strong>
<em>Contributor</em><div><a href=https://www.linkedin.com/in/jeremy-hamilton><img src=/img/social/linkedin.png></a></div><p>Senior Systems Administrator from the Kansas City area, specializing in cloud infrastructure as well as all things O365.</p><hr></div><comments id=comments><script src=https://utteranc.es/client.js repo=SysManSquad/sysmansquadblog issue-term=title label="blog comment" theme=github-light crossorigin=anonymous async></script></comments></article></div></div></div><footer id=footer><div class=container><div id=footer-copyright><p class=copyright>&copy; 2022 WinAdmins - https://sysmansquad.com - Systems Management Squad</a></p></div></div></footer></div></body></html>